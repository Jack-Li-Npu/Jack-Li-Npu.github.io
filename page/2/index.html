
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>KING!BOB!</title>
    <meta name="author" content="KING BOB" />
    <meta name="description" content="LET'S MAKE IT HAPPEN" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/pic.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>





<script src="/js/lib/home.js"></script>

<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜ æµè§ˆå™¨é»˜è®¤å¼€å¯</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>KING!BOB!</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;KING!BOB!</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div id="home-head">
    <div
        id="home-background"
        ref="homeBackground"
        data-images="/images/background2.jpg"
    ></div>
    <div id="home-info" @click="homeClick">
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="info">
            <div class="wrap">
                <h1>KING!BOB!</h1>
                <h3></h3>
                <h5>LET&#39;S MAKE IT HAPPEN</h5>
            </div>
        </span>
    </div>
</div>
<div
    id="home-posts-wrap"
    ref="homePostsWrap"
    true
>
    <div id="home-posts">
        

<div class="post">
    <a href="/2022/05/26/Leetcode%20%20sql%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95/">
        <h2 class="post-title">Leetcode sqlé¢˜ç›®è®°å½•</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/Leetcode/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Leetcode
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2022/5/26
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="Leetcode-sqlé¢˜ç›®è®°å½•"><a href="#Leetcode-sqlé¢˜ç›®è®°å½•" class="headerlink" title="Leetcode  sqlé¢˜ç›®è®°å½•"></a>Leetcode  sqlé¢˜ç›®è®°å½•</h2><p>æœ¬åšå®¢ä»…è®°å½•**é«˜é¢‘ SQL 50 é¢˜ï¼ˆåŸºç¡€ç‰ˆï¼‰**ä¸­çš„ä¸­ç­‰éš¾åº¦é¢˜ç›®ï¼Œåç»­ä¸å®šæœŸæ›´æ–°</p>
<h3 id="570-è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†"><a href="#570-è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†" class="headerlink" title="570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†"></a>570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†</h3><p>è¡¨: <code>Employee</code></p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| name        | varchar |
| department  | varchar |
| managerId   | int     |
+-------------+---------+
id æ˜¯æ­¤è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºé›‡å‘˜çš„åå­—ã€ä»–ä»¬çš„éƒ¨é—¨å’Œä»–ä»¬çš„ç»ç†çš„idã€‚
å¦‚æœmanagerIdä¸ºç©ºï¼Œåˆ™è¯¥å‘˜å·¥æ²¡æœ‰ç»ç†ã€‚
æ²¡æœ‰å‘˜å·¥ä¼šæˆä¸ºè‡ªå·±çš„ç®¡ç†è€…ã€‚
</code></pre>
<p>ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºè‡³å°‘æœ‰<strong>äº”ä¸ªç›´æ¥ä¸‹å±</strong>çš„ç»ç†ã€‚</p>
<p>ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥: 
Employee è¡¨:
+-----+-------+------------+-----------+
| id  | name  | department | managerId |
+-----+-------+------------+-----------+
| 101 | John  | A          | Null      |
| 102 | Dan   | A          | 101       |
| 103 | James | A          | 101       |
| 104 | Amy   | A          | 101       |
| 105 | Anne  | A          | 101       |
| 106 | Ron   | B          | 101       |
+-----+-------+------------+-----------+
è¾“å‡º: 
+------+
| name |
+------+
| John |
+------+
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">select a.name from Employee a join Employee b on a.id = b.managerId group by a.id having count(*) &gt;= 5;
</code></pre>
<p>æ²¡æœ‰ <code>GROUP BY</code><br> <code>HAVING</code> æ˜¯å¯¹<strong>åˆ†ç»„åçš„ç»“æœ</strong>è¿‡æ»¤çš„ã€‚ä½ æ²¡åˆ†ç»„æ—¶ï¼ŒMySQLæŠŠæ•´å¼ ç»“æœé›†å½“æˆ<strong>ä¸€ä¸ªå¤§ç»„</strong>ï¼Œ<code>COUNT(a.id)</code> ç»Ÿè®¡çš„æ˜¯<strong>æ‰€æœ‰ç»ç†â€“ä¸‹å±é…å¯¹çš„æ€»è¡Œæ•°</strong>ï¼Œä¸æ˜¯â€œæ¯ä¸ªç»ç†çš„ä¸‹å±æ•°â€ã€‚å› æ­¤å½“æµ‹è¯•æ•°æ®é‡Œåªæœ‰ä¸€ä¸ªç»ç†ä¸”åˆšå¥½æœ‰ 5 ä¸ªä¸‹å±æ—¶çœ‹èµ·æ¥â€œæ­£ç¡®â€ï¼Œä½†åªè¦æœ‰ä¸¤ä¸ªç»ç†ï¼Œåˆè®¡è¡Œæ•° â‰¥5ï¼Œä½ è¿™å¥å°±ä¼šæŠŠä¸¤ä½ç»ç†éƒ½æ”¾è¿›ç»“æœé‡Œï¼Œç”šè‡³è¿˜ä¼šé‡å¤å¤šè¡Œã€‚</p>
<hr>
<h3 id="1934-ç¡®è®¤ç‡"><a href="#1934-ç¡®è®¤ç‡" class="headerlink" title="1934. ç¡®è®¤ç‡"></a>1934. ç¡®è®¤ç‡</h3><p>è¡¨: <code>Signups</code></p>
<pre><code>+----------------+----------+
| Column Name    | Type     |
+----------------+----------+
| user_id        | int      |
| time_stamp     | datetime |
+----------------+----------+
User_idæ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
æ¯ä¸€è¡Œéƒ½åŒ…å«IDä¸ºuser_idçš„ç”¨æˆ·çš„æ³¨å†Œæ—¶é—´ä¿¡æ¯ã€‚
</code></pre>
<p>è¡¨: <code>Confirmations</code></p>
<pre><code>+----------------+----------+
| Column Name    | Type     |
+----------------+----------+
| user_id        | int      |
| time_stamp     | datetime |
| action         | ENUM     |
+----------------+----------+
(user_id, time_stamp)æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
user_idæ˜¯ä¸€ä¸ªå¼•ç”¨åˆ°æ³¨å†Œè¡¨çš„å¤–é”®ã€‚
actionæ˜¯ç±»å‹ä¸º(&#39;confirmed&#39;ï¼Œ &#39;timeout&#39;)çš„ENUM
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºIDä¸ºuser_idçš„ç”¨æˆ·åœ¨time_stampè¯·æ±‚äº†ä¸€æ¡ç¡®è®¤æ¶ˆæ¯ï¼Œè¯¥ç¡®è®¤æ¶ˆæ¯è¦ä¹ˆè¢«ç¡®è®¤(&#39;confirmed&#39;)ï¼Œè¦ä¹ˆè¢«è¿‡æœŸ(&#39;timeout&#39;)ã€‚
</code></pre>
<p>ç”¨æˆ·çš„ <strong>ç¡®è®¤ç‡</strong> æ˜¯ <code>&#39;confirmed&#39;</code> æ¶ˆæ¯çš„æ•°é‡é™¤ä»¥è¯·æ±‚çš„ç¡®è®¤æ¶ˆæ¯çš„æ€»æ•°ã€‚æ²¡æœ‰è¯·æ±‚ä»»ä½•ç¡®è®¤æ¶ˆæ¯çš„ç”¨æˆ·çš„ç¡®è®¤ç‡ä¸º <code>0</code> ã€‚ç¡®è®¤ç‡å››èˆäº”å…¥åˆ° <strong>å°æ•°ç‚¹åä¸¤ä½</strong> ã€‚</p>
<p>ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªç”¨æˆ·çš„ ç¡®è®¤ç‡ ã€‚</p>
<p>ä»¥ ä»»æ„é¡ºåº è¿”å›ç»“æœè¡¨ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Signups è¡¨:
+---------+---------------------+
| user_id | time_stamp          |
+---------+---------------------+
| 3       | 2020-03-21 10:16:13 |
| 7       | 2020-01-04 13:57:59 |
| 2       | 2020-07-29 23:09:44 |
| 6       | 2020-12-09 10:39:37 |
+---------+---------------------+
Confirmations è¡¨:
+---------+---------------------+-----------+
| user_id | time_stamp          | action    |
+---------+---------------------+-----------+
| 3       | 2021-01-06 03:30:46 | timeout   |
| 3       | 2021-07-14 14:00:00 | timeout   |
| 7       | 2021-06-12 11:57:29 | confirmed |
| 7       | 2021-06-13 12:58:28 | confirmed |
| 7       | 2021-06-14 13:59:27 | confirmed |
| 2       | 2021-01-22 00:00:00 | confirmed |
| 2       | 2021-02-28 23:59:59 | timeout   |
+---------+---------------------+-----------+
è¾“å‡º: 
+---------+-------------------+
| user_id | confirmation_rate |
+---------+-------------------+
| 6       | 0.00              |
| 3       | 0.00              |
| 7       | 1.00              |
| 2       | 0.50              |
+---------+-------------------+
è§£é‡Š:
ç”¨æˆ· 6 æ²¡æœ‰è¯·æ±‚ä»»ä½•ç¡®è®¤æ¶ˆæ¯ã€‚ç¡®è®¤ç‡ä¸º 0ã€‚
ç”¨æˆ· 3 è¿›è¡Œäº† 2 æ¬¡è¯·æ±‚ï¼Œéƒ½è¶…æ—¶äº†ã€‚ç¡®è®¤ç‡ä¸º 0ã€‚
ç”¨æˆ· 7 æå‡ºäº† 3 ä¸ªè¯·æ±‚ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¾—åˆ°äº†ç¡®è®¤ã€‚ç¡®è®¤ç‡ä¸º 1ã€‚
ç”¨æˆ· 2 åšäº† 2 ä¸ªè¯·æ±‚ï¼Œå…¶ä¸­ä¸€ä¸ªè¢«ç¡®è®¤ï¼Œå¦ä¸€ä¸ªè¶…æ—¶ã€‚ç¡®è®¤ç‡ä¸º 1 / 2 = 0.5ã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">WITH base AS (
  SELECT 
    user_id,
    COUNT(*) AS total,
    SUM(CASE WHEN action = &#39;confirmed&#39; THEN 1 ELSE 0 END) AS confirmed
  FROM Confirmations
  GROUP BY user_id
)
SELECT 
  s.user_id,
  ROUND(IFNULL(b.confirmed / b.total, 0), 2) AS confirmation_rate
FROM Signups s
LEFT JOIN base b
  ON s.user_id = b.user_id;
</code></pre>
<hr>
<h3 id="1193-æ¯æœˆäº¤æ˜“I"><a href="#1193-æ¯æœˆäº¤æ˜“I" class="headerlink" title="1193. æ¯æœˆäº¤æ˜“I"></a>1193. æ¯æœˆäº¤æ˜“I</h3><p>è¡¨ï¼š<code>Transactions</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| country       | varchar |
| state         | enum    |
| amount        | int     |
| trans_date    | date    |
+---------------+---------+
id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨åŒ…å«æœ‰å…³ä¼ å…¥äº‹åŠ¡çš„ä¿¡æ¯ã€‚
state åˆ—ç±»å‹ä¸º [&quot;approved&quot;, &quot;declined&quot;] ä¹‹ä¸€ã€‚
</code></pre>
<p>ç¼–å†™ä¸€ä¸ª sql æŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªæœˆå’Œæ¯ä¸ªå›½å®¶&#x2F;åœ°åŒºçš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€å·²æ‰¹å‡†çš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€‚</p>
<p>ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Transactions table:
+------+---------+----------+--------+------------+
| id   | country | state    | amount | trans_date |
+------+---------+----------+--------+------------+
| 121  | US      | approved | 1000   | 2018-12-18 |
| 122  | US      | declined | 2000   | 2018-12-19 |
| 123  | US      | approved | 2000   | 2019-01-01 |
| 124  | DE      | approved | 2000   | 2019-01-07 |
+------+---------+----------+--------+------------+
è¾“å‡ºï¼š
+----------+---------+-------------+----------------+--------------------+-----------------------+
| month    | country | trans_count | approved_count | trans_total_amount | approved_total_amount |
+----------+---------+-------------+----------------+--------------------+-----------------------+
| 2018-12  | US      | 2           | 1              | 3000               | 1000                  |
| 2019-01  | US      | 1           | 1              | 2000               | 2000                  |
| 2019-01  | DE      | 1           | 1              | 2000               | 2000                  |
+----------+---------+-------------+----------------+--------------------+-----------------------+
</code></pre>
<p>è§£ç­”ï¼š</p>
<p>å¤šä¸ª CTE ç”¨ <code>WITH a AS (...), b AS (...)</code>ã€‚</p>
<p>æŒ‰ <code>monthã€country</code> åˆ†ç»„ï¼›<code>approved</code> ç›¸å…³ç”¨ <code>CASE WHEN</code> è®¡æ•°&#x2F;æ±‚å’Œã€‚</p>
<p>å–æœˆä»½ç”¨ <code>DATE_FORMAT(trans_date, &#39;%Y-%m&#39;)</code> æ›´ç¨³å¦¥ã€‚</p>
<p><strong>DATE_FORMAT(â€¦, â€˜%y-%mâ€™)ï¼šç»“æœæ˜¯20-02ï¼Œè‹¥æ˜¯â€™%Y-%mï¼Œç»“æœæ˜¯2020-02ï¼Œè‹¥æ˜¯â€™%Y-%Mï¼Œç»“æœæ˜¯2020-Febraryâ€™</strong></p>
<pre><code class="language-sql">WITH base AS (
  SELECT
    DATE_FORMAT(trans_date, &#39;%Y-%m&#39;) AS month,
    country,
    state,
    amount
  FROM Transactions
),
seq AS (
  SELECT
    month,
    country,
    COUNT(*) AS trans_count,
    SUM(CASE WHEN state = &#39;approved&#39; THEN 1 ELSE 0 END) AS approved_count,
    SUM(amount) AS trans_total_amount,
    SUM(CASE WHEN state = &#39;approved&#39; THEN amount ELSE 0 END) AS approved_total_amount
  FROM base
  GROUP BY month, country
)
SELECT *
FROM seq;
</code></pre>
<hr>
<h3 id="1174-å³æ—¶é£Ÿç‰©é…é€II"><a href="#1174-å³æ—¶é£Ÿç‰©é…é€II" class="headerlink" title="1174. å³æ—¶é£Ÿç‰©é…é€II"></a>1174. å³æ—¶é£Ÿç‰©é…é€II</h3><p>é…é€è¡¨: <code>Delivery</code></p>
<pre><code>+-----------------------------+---------+
| Column Name                 | Type    |
+-----------------------------+---------+
| delivery_id                 | int     |
| customer_id                 | int     |
| order_date                  | date    |
| customer_pref_delivery_date | date    |
+-----------------------------+---------+
delivery_id æ˜¯è¯¥è¡¨ä¸­å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
è¯¥è¡¨ä¿å­˜ç€é¡¾å®¢çš„é£Ÿç‰©é…é€ä¿¡æ¯ï¼Œé¡¾å®¢åœ¨æŸä¸ªæ—¥æœŸä¸‹äº†è®¢å•ï¼Œå¹¶æŒ‡å®šäº†ä¸€ä¸ªæœŸæœ›çš„é…é€æ—¥æœŸï¼ˆå’Œä¸‹å•æ—¥æœŸç›¸åŒæˆ–è€…åœ¨é‚£ä¹‹åï¼‰ã€‚
</code></pre>
<p>å¦‚æœé¡¾å®¢æœŸæœ›çš„é…é€æ—¥æœŸå’Œä¸‹å•æ—¥æœŸç›¸åŒï¼Œåˆ™è¯¥è®¢å•ç§°ä¸º ã€Œ<strong>å³æ—¶è®¢å•</strong>ã€ï¼Œå¦åˆ™ç§°ä¸ºã€Œ<strong>è®¡åˆ’è®¢å•</strong>ã€ã€‚</p>
<p>ã€Œ<strong>é¦–æ¬¡è®¢å•</strong>ã€æ˜¯é¡¾å®¢æœ€æ—©åˆ›å»ºçš„è®¢å•ã€‚æˆ‘ä»¬ä¿è¯ä¸€ä¸ªé¡¾å®¢åªä¼šæœ‰ä¸€ä¸ªã€Œé¦–æ¬¡è®¢å•ã€ã€‚</p>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆä»¥è·å–å³æ—¶è®¢å•åœ¨æ‰€æœ‰ç”¨æˆ·çš„é¦–æ¬¡è®¢å•ä¸­çš„æ¯”ä¾‹ã€‚<strong>ä¿ç•™ä¸¤ä½å°æ•°ã€‚</strong></p>
<p>ç»“æœç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Delivery è¡¨ï¼š
+-------------+-------------+------------+-----------------------------+
| delivery_id | customer_id | order_date | customer_pref_delivery_date |
+-------------+-------------+------------+-----------------------------+
| 1           | 1           | 2019-08-01 | 2019-08-02                  |
| 2           | 2           | 2019-08-02 | 2019-08-02                  |
| 3           | 1           | 2019-08-11 | 2019-08-12                  |
| 4           | 3           | 2019-08-24 | 2019-08-24                  |
| 5           | 3           | 2019-08-21 | 2019-08-22                  |
| 6           | 2           | 2019-08-11 | 2019-08-13                  |
| 7           | 4           | 2019-08-09 | 2019-08-09                  |
+-------------+-------------+------------+-----------------------------+
è¾“å‡ºï¼š
+----------------------+
| immediate_percentage |
+----------------------+
| 50.00                |
+----------------------+
è§£é‡Šï¼š
1 å·é¡¾å®¢çš„ 1 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯è®¡åˆ’è®¢å•ã€‚
2 å·é¡¾å®¢çš„ 2 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯å³æ—¶è®¢å•ã€‚
3 å·é¡¾å®¢çš„ 5 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯è®¡åˆ’è®¢å•ã€‚
4 å·é¡¾å®¢çš„ 7 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯å³æ—¶è®¢å•ã€‚
å› æ­¤ï¼Œä¸€åŠé¡¾å®¢çš„é¦–æ¬¡è®¢å•æ˜¯å³æ—¶çš„ã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">with base as (
select *, row_number() over(partition by customer_id order by order_date) as rn 
from Delivery),
seq as (
    select round((sum(case when customer_pref_delivery_date = order_date then 1 else 0 end) / count(*)) * 100, 2) as immediate_percentage from base where rn = 1
)
select * from seq;
</code></pre>
<hr>
<h3 id="176-ç¬¬äºŒé«˜çš„è–ªæ°´"><a href="#176-ç¬¬äºŒé«˜çš„è–ªæ°´" class="headerlink" title="176. ç¬¬äºŒé«˜çš„è–ªæ°´"></a>176. ç¬¬äºŒé«˜çš„è–ªæ°´</h3><p><code>Employee</code> è¡¨ï¼š</p>
<pre><code>+-------------+------+
| Column Name | Type |
+-------------+------+
| id          | int  |
| salary      | int  |
+-------------+------+
id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«å‘˜å·¥çš„å·¥èµ„ä¿¡æ¯ã€‚
</code></pre>
<p>æŸ¥è¯¢å¹¶è¿”å› <code>Employee</code> è¡¨ä¸­ç¬¬äºŒé«˜çš„ <strong>ä¸åŒ</strong> è–ªæ°´ ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬äºŒé«˜çš„è–ªæ°´ï¼ŒæŸ¥è¯¢åº”è¯¥è¿”å› <code>null(Pandas åˆ™è¿”å› None)</code> ã€‚</p>
<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Employee è¡¨ï¼š
+----+--------+
| id | salary |
+----+--------+
| 1  | 100    |
| 2  | 200    |
| 3  | 300    |
+----+--------+
è¾“å‡ºï¼š
+---------------------+
| SecondHighestSalary |
+---------------------+
| 200                 |
+---------------------+
</code></pre>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Employee è¡¨ï¼š
+----+--------+
| id | salary |
+----+--------+
| 1  | 100    |
+----+--------+
è¾“å‡ºï¼š
+---------------------+
| SecondHighestSalary |
+---------------------+
| null                |
+---------------------+
</code></pre>
<p>è§£ç­”</p>
<pre><code class="language-sql">SELECT MAX(salary) AS SecondHighestSalary
FROM (
  SELECT DISTINCT salary,
         DENSE_RANK() OVER (ORDER BY salary DESC) AS rk
  FROM Employee
) t
WHERE rk = 2;
</code></pre>
<h4 id="ï¼ˆ1ï¼‰-å­æŸ¥è¯¢ä¸ºç©ºä½†å¤–å±‚ç”¨äº†èšåˆå‡½æ•°"><a href="#ï¼ˆ1ï¼‰-å­æŸ¥è¯¢ä¸ºç©ºä½†å¤–å±‚ç”¨äº†èšåˆå‡½æ•°" class="headerlink" title="ï¼ˆ1ï¼‰ å­æŸ¥è¯¢ä¸ºç©ºä½†å¤–å±‚ç”¨äº†èšåˆå‡½æ•°"></a>ï¼ˆ1ï¼‰ å­æŸ¥è¯¢ä¸ºç©ºä½†å¤–å±‚ç”¨äº†èšåˆå‡½æ•°</h4><p>SQL çš„å®šä¹‰æ˜¯ï¼šèšåˆå‡½æ•°å¯¹ç©ºè¾“å…¥æ—¶ï¼Œè¿”å› <strong>NULL</strong>ã€‚<br> ä¾‹å­ï¼š</p>
<pre><code class="language-sql">SELECT MAX(salary) FROM (SELECT 1 AS salary WHERE 1=0) t;
</code></pre>
<p><code>(SELECT 1 WHERE 1=0)</code> ä¸ºç©ºè¡¨ â†’ <code>MAX</code> æ²¡æœ‰ä»»ä½•å€¼å¯æ¯”è¾ƒ â†’ è¿”å› <code>NULL</code>ã€‚</p>
<p>æ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆâ€œç¬¬äºŒé«˜è–ªæ°´ä¸å­˜åœ¨â€æ—¶ <code>MAX</code> å¯ä»¥å¸®æˆ‘ä»¬è‡ªåŠ¨è¿”å› <code>NULL</code>ã€‚</p>
<hr>
<h4 id="ï¼ˆ2ï¼‰å­æŸ¥è¯¢ä¸ºç©ºè€Œå¤–å±‚æ²¡æœ‰èšåˆå‡½æ•°"><a href="#ï¼ˆ2ï¼‰å­æŸ¥è¯¢ä¸ºç©ºè€Œå¤–å±‚æ²¡æœ‰èšåˆå‡½æ•°" class="headerlink" title="ï¼ˆ2ï¼‰å­æŸ¥è¯¢ä¸ºç©ºè€Œå¤–å±‚æ²¡æœ‰èšåˆå‡½æ•°"></a>ï¼ˆ2ï¼‰å­æŸ¥è¯¢ä¸ºç©ºè€Œå¤–å±‚æ²¡æœ‰èšåˆå‡½æ•°</h4><p>å¦‚æœä½ ç›´æ¥ï¼š</p>
<pre><code class="language-sql">SELECT salary 
FROM (SELECT salary WHERE 1=0) t;
</code></pre>
<p>é‚£ç»“æœå°±æ˜¯ <strong>0 è¡Œ</strong>ï¼ˆå³ç›´æ¥è¿”å›ç©ºç»“æœé›†ï¼Œä¸ä¼šè‡ªåŠ¨ç»™ä½ ä¸€è¡Œ <code>NULL</code>ï¼‰ã€‚</p>
<hr>
<h3 id="550-æ¸¸æˆç©æ³•åˆ†æIV"><a href="#550-æ¸¸æˆç©æ³•åˆ†æIV" class="headerlink" title="550. æ¸¸æˆç©æ³•åˆ†æIV"></a>550. æ¸¸æˆç©æ³•åˆ†æIV</h3><p>Table: <code>Activity</code></p>
<pre><code>+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| player_id    | int     |
| device_id    | int     |
| event_date   | date    |
| games_played | int     |
+--------------+---------+
ï¼ˆplayer_idï¼Œevent_dateï¼‰æ˜¯æ­¤è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆï¼‰ã€‚
è¿™å¼ è¡¨æ˜¾ç¤ºäº†æŸäº›æ¸¸æˆçš„ç©å®¶çš„æ´»åŠ¨æƒ…å†µã€‚
æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç©å®¶çš„è®°å½•ï¼Œä»–åœ¨æŸä¸€å¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡æ³¨é”€ä¹‹å‰ç™»å½•å¹¶ç©äº†å¾ˆå¤šæ¸¸æˆï¼ˆå¯èƒ½æ˜¯ 0ï¼‰ã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼ŒæŠ¥å‘Šåœ¨é¦–æ¬¡ç™»å½•çš„ç¬¬äºŒå¤©å†æ¬¡ç™»å½•çš„ç©å®¶çš„ <strong>æ¯”ç‡</strong>ï¼Œ<strong>å››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½</strong>ã€‚æ¢å¥è¯è¯´ï¼Œä½ éœ€è¦è®¡ç®—ä»é¦–æ¬¡ç™»å½•åçš„ç¬¬äºŒå¤©ç™»å½•çš„ç©å®¶æ•°é‡ï¼Œå¹¶å°†å…¶é™¤ä»¥æ€»ç©å®¶æ•°ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Activity table:
+-----------+-----------+------------+--------------+
| player_id | device_id | event_date | games_played |
+-----------+-----------+------------+--------------+
| 1         | 2         | 2016-03-01 | 5            |
| 1         | 2         | 2016-03-02 | 6            |
| 2         | 3         | 2017-06-25 | 1            |
| 3         | 1         | 2016-03-02 | 0            |
| 3         | 4         | 2018-07-03 | 5            |
+-----------+-----------+------------+--------------+
è¾“å‡ºï¼š
+-----------+
| fraction  |
+-----------+
| 0.33      |
+-----------+
è§£é‡Šï¼š
åªæœ‰ ID ä¸º 1 çš„ç©å®¶åœ¨ç¬¬ä¸€å¤©ç™»å½•åæ‰é‡æ–°ç™»å½•ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ 1/3 = 0.33
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql"># Write your MySQL query statement below
with base as(
    select *,min(event_date) over(partition by player_id)as first from Activity
),
seq as(
    select player_id, sum(case when datediff(event_date, first) = 1 then 1 else 0 end) as rn from base
    group by player_id
)
select round(IFNULL((sum(rn) / count(distinct player_id)), 0), 2) as fraction from seq;
</code></pre>
<p>æ³¨æ„ï¼š</p>
<ol>
<li>åœ¨ä½¿ç”¨with base as(), seq as() select from seqæ—¶ï¼Œè¦è®°å¾—æ¯ä¸ªåµŒå¥—å†…éƒ¨çš„selectå¾ˆé‡è¦ï¼Œå‰ä¸€ä¸ªselectéœ€è¦åŒ…å«åä¸€ä¸ªselectçš„å†…å®¹ã€‚</li>
<li>ä½¿ç”¨èšåˆå‡½æ•°min,max,countåç»“æœä¼šè¢«å‹ç¼©ï¼Œå¦‚æœåç»­è¦åŒè¡Œå¯¹æœ€å¤§ã€æœ€å°è¿›è¡Œæ¯”è¾ƒï¼Œè¦ä½¿ç”¨çª—å£å‡½æ•°å½¢å¼çš„max,minâ€¦</li>
</ol>
<hr>
<h3 id="1045-ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·"><a href="#1045-ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·" class="headerlink" title="1045. ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·"></a>1045. ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·</h3><p><code>Customer</code> è¡¨ï¼š</p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| customer_id | int     |
| product_key | int     |
+-------------+---------+
è¯¥è¡¨å¯èƒ½åŒ…å«é‡å¤çš„è¡Œã€‚
customer_id ä¸ä¸º NULLã€‚
product_key æ˜¯ Product è¡¨çš„å¤–é”®(reference åˆ—)ã€‚
</code></pre>
<p><code>Product</code> è¡¨ï¼š</p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| product_key | int     |
+-------------+---------+
product_key æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼ŒæŠ¥å‘Š <code>Customer</code> è¡¨ä¸­è´­ä¹°äº† <code>Product</code> è¡¨ä¸­æ‰€æœ‰äº§å“çš„å®¢æˆ·çš„ idã€‚</p>
<p>è¿”å›ç»“æœè¡¨ <strong>æ— é¡ºåºè¦æ±‚</strong> ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Customer è¡¨ï¼š
+-------------+-------------+
| customer_id | product_key |
+-------------+-------------+
| 1           | 5           |
| 2           | 6           |
| 3           | 5           |
| 3           | 6           |
| 1           | 6           |
+-------------+-------------+
Product è¡¨ï¼š
+-------------+
| product_key |
+-------------+
| 5           |
| 6           |
+-------------+
è¾“å‡ºï¼š
+-------------+
| customer_id |
+-------------+
| 1           |
| 3           |
+-------------+
è§£é‡Šï¼š
è´­ä¹°äº†æ‰€æœ‰äº§å“ï¼ˆ5 å’Œ 6ï¼‰çš„å®¢æˆ·çš„ id æ˜¯ 1 å’Œ 3 ã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<ol>
<li><strong><code>WHERE DISTINCT</code> æ˜¯éæ³•è¯­æ³•</strong>ã€‚<code>DISTINCT</code> åªèƒ½æ”¾åœ¨ <code>SELECT</code> æˆ– <code>COUNT(DISTINCT ...)</code> é‡Œé¢ï¼Œä¸èƒ½ç›´æ¥æ”¾åœ¨ <code>WHERE</code>ã€‚</li>
<li>é¢˜ç›®è¦æ±‚çš„æ˜¯â€œä¹°äº†æ‰€æœ‰äº§å“çš„é¡¾å®¢â€ï¼Œæ‰€ä»¥åº”è¯¥æ¯”è¾ƒé¡¾å®¢ä¹°åˆ°çš„ <strong>å»é‡åäº§å“æ•°</strong> å’Œ <strong>Product è¡¨é‡Œçš„äº§å“æ€»æ•°</strong>ã€‚</li>
</ol>
<pre><code class="language-sql">SELECT customer_id
FROM Customer
GROUP BY customer_id
HAVING COUNT(DISTINCT product_key) = (
    SELECT COUNT(*) FROM Product
);
</code></pre>
<p>è§£é‡Šä¸€ä¸‹ï¼š</p>
<ul>
<li><code>GROUP BY customer_id</code>ï¼šæŒ‰é¡¾å®¢åˆ†ç»„ã€‚</li>
<li><code>COUNT(DISTINCT product_key)</code>ï¼šç»Ÿè®¡è¯¥é¡¾å®¢ä¹°äº†å¤šå°‘ç§ä¸åŒçš„äº§å“ã€‚</li>
<li>å­æŸ¥è¯¢ <code>(SELECT COUNT(*) FROM Product)</code>ï¼šç»Ÿè®¡æ€»å…±æœ‰å¤šå°‘ç§äº§å“ã€‚</li>
<li><code>HAVING ... = ...</code>ï¼šç­›é€‰å‡ºä¹°å…¨æ‰€æœ‰äº§å“çš„é¡¾å®¢ã€‚</li>
</ul>
<hr>
<h3 id="180-è¿ç»­å‡ºç°çš„æ•°å­—"><a href="#180-è¿ç»­å‡ºç°çš„æ•°å­—" class="headerlink" title="180. è¿ç»­å‡ºç°çš„æ•°å­—"></a>180. è¿ç»­å‡ºç°çš„æ•°å­—</h3><p>è¡¨ï¼š<code>Logs</code></p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| num         | varchar |
+-------------+---------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
id æ˜¯ä¸€ä¸ªè‡ªå¢åˆ—ã€‚
</code></pre>
<p>æ‰¾å‡ºæ‰€æœ‰è‡³å°‘è¿ç»­å‡ºç°ä¸‰æ¬¡çš„æ•°å­—ã€‚</p>
<p>è¿”å›çš„ç»“æœè¡¨ä¸­çš„æ•°æ®å¯ä»¥æŒ‰ <strong>ä»»æ„é¡ºåº</strong> æ’åˆ—ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼š</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Logs è¡¨ï¼š
+----+-----+
| id | num |
+----+-----+
| 1  | 1   |
| 2  | 1   |
| 3  | 1   |
| 4  | 2   |
| 5  | 1   |
| 6  | 2   |
| 7  | 2   |
+----+-----+
è¾“å‡ºï¼š
Result è¡¨ï¼š
+-----------------+
| ConsecutiveNums |
+-----------------+
| 1               |
+-----------------+
è§£é‡Šï¼š1 æ˜¯å”¯ä¸€è¿ç»­å‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æ•°å­—ã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">with base as(
    select *, row_number() over(partition by num order by id) as rn from Logs
),
seq as(
    select *, id - rn as diff from base 
),
rpq as (
    select num, count(*) as ct from seq group by num, diff having count(*) &gt;= 3
)
select distinct num as ConsecutiveNums from rpq;
</code></pre>
<p><strong>æœ‰æ—¶å€™ä¸è¦å¿˜è®°distinct</strong></p>
<hr>
<h3 id="1164-æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼"><a href="#1164-æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼" class="headerlink" title="1164. æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼"></a>1164. æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼</h3><p>äº§å“æ•°æ®è¡¨: <code>Products</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| product_id    | int     |
| new_price     | int     |
| change_date   | date    |
+---------------+---------+
(product_id, change_date) æ˜¯æ­¤è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ç»„åˆï¼‰ã€‚
è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œåˆ†åˆ«è®°å½•äº† æŸäº§å“ åœ¨æŸä¸ªæ—¥æœŸ æ›´æ”¹å çš„æ–°ä»·æ ¼ã€‚
</code></pre>
<p>ä¸€å¼€å§‹ï¼Œæ‰€æœ‰äº§å“ä»·æ ¼éƒ½ä¸º 10ã€‚</p>
<p>ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºåœ¨ <code>2019-08-16</code> æ‰€æœ‰äº§å“çš„ä»·æ ¼ã€‚</p>
<p>ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Products è¡¨:
+------------+-----------+-------------+
| product_id | new_price | change_date |
+------------+-----------+-------------+
| 1          | 20        | 2019-08-14  |
| 2          | 50        | 2019-08-14  |
| 1          | 30        | 2019-08-15  |
| 1          | 35        | 2019-08-16  |
| 2          | 65        | 2019-08-17  |
| 3          | 20        | 2019-08-18  |
+------------+-----------+-------------+
è¾“å‡ºï¼š
+------------+-------+
| product_id | price |
+------------+-------+
| 2          | 50    |
| 1          | 35    |
| 3          | 10    |
+------------+-------+
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">with base as(
    select *, row_number()over (partition by product_id order by change_date DESC) as rn from Products where change_date &lt;= &#39;2019-08-16&#39;
),
seq as (
    select product_id, new_price as price from base where rn = 1
)
select product_id, price from seq union all select distinct product_id, 10 as price from (
    select product_id, min(change_date) as mi from Products group by product_id
)t  where mi &gt; &#39;2019-08-16&#39;;
</code></pre>
<p>å½’çº³ï¼š<br>æƒ³è¦å¾—åˆ°æŸä¸€åˆ—çš„æœ€å¤§æœ€å°å€¼ï¼Œå¹¶ç”¨å…¶ä¸æŸä¸ªæ•°è¿›è¡Œæ¯”è¾ƒï¼Œéœ€è¦å…ˆmaxã€minï¼ˆçª—å£æˆ–è€…èšåˆå‡½æ•°ï¼‰ï¼Œç„¶åå†ç­‰å€¼æŸ¥è¯¢ï¼Œæˆ–è€…rownumberé…åˆASCã€DESCï¼Œç„¶åå†åç»­æŸ¥è¯¢ä¸­ä½¿ç”¨rn&#x3D;1ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨order by+limit</p>
<h4 id="ï¼ˆ1ï¼‰éç›¸å…³å­æŸ¥è¯¢-ç­‰å€¼æ¯”è¾ƒ"><a href="#ï¼ˆ1ï¼‰éç›¸å…³å­æŸ¥è¯¢-ç­‰å€¼æ¯”è¾ƒ" class="headerlink" title="ï¼ˆ1ï¼‰éç›¸å…³å­æŸ¥è¯¢ + ç­‰å€¼æ¯”è¾ƒ"></a>ï¼ˆ1ï¼‰éç›¸å…³å­æŸ¥è¯¢ + ç­‰å€¼æ¯”è¾ƒ</h4><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<strong>å…¨å±€åªæœ‰ä¸€ä¸ªæœ€å€¼</strong>ï¼ˆæ•´ä¸ªè¡¨çš„æœ€å¤§å€¼&#x2F;æœ€å°å€¼ï¼‰ï¼Œä¸ä¾èµ–åˆ†ç»„ã€‚</p>
<ul>
<li>ç‰¹ç‚¹ï¼šå­æŸ¥è¯¢è¿”å›å•è¡Œï¼Œå¯ä»¥ç›´æ¥ç”¨ <code>=</code> æ¯”è¾ƒã€‚</li>
<li>ç¤ºä¾‹ï¼šæ‰¾å‡ºå·¥èµ„æœ€é«˜çš„å‘˜å·¥</li>
</ul>
<pre><code class="language-sql">select *
from Employee
where salary = (select max(salary) from Employee);
</code></pre>
<hr>
<h4 id="ï¼ˆ2ï¼‰ç›¸å…³å­æŸ¥è¯¢"><a href="#ï¼ˆ2ï¼‰ç›¸å…³å­æŸ¥è¯¢" class="headerlink" title="ï¼ˆ2ï¼‰ç›¸å…³å­æŸ¥è¯¢"></a>ï¼ˆ2ï¼‰ç›¸å…³å­æŸ¥è¯¢</h4><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<strong>åˆ†ç»„åçš„æœ€å€¼</strong>ï¼ˆæ¯ä¸ªå®¢æˆ·&#x2F;éƒ¨é—¨çš„æœ€å°&#x2F;æœ€å¤§æ—¥æœŸï¼‰ï¼Œå¤–å±‚è¡¨çš„æ¡ä»¶ä¾èµ–å­æŸ¥è¯¢ã€‚</p>
<ul>
<li>ç‰¹ç‚¹ï¼šå­æŸ¥è¯¢é‡Œéœ€è¦å¼•ç”¨å¤–å±‚çš„åˆ—ï¼Œæ¯è¡Œæ‰§è¡Œä¸€æ¬¡ï¼Œä¿è¯è¿”å›å•è¡Œã€‚</li>
<li>ç¤ºä¾‹ï¼šæ‰¾æ¯ä¸ªå®¢æˆ·çš„é¦–å•</li>
</ul>
<pre><code class="language-sql">select *
from Delivery d1
where order_date = (
  select min(order_date)
  from Delivery d2
  where d2.customer_id = d1.customer_id
);
</code></pre>
<p>è¿™é‡Œå­æŸ¥è¯¢é‡Œçš„ <code>d2.customer_id = d1.customer_id</code> ç»‘å®šäº†å¤–å±‚æŸ¥è¯¢çš„ <code>d1.customer_id</code>ã€‚</p>
<p>æ¯æ¬¡å¤–å±‚å–ä¸€è¡Œï¼Œå­æŸ¥è¯¢å°±åªè®¡ç®—è¯¥å®¢æˆ·çš„æœ€å°è®¢å•æ—¥æœŸã€‚</p>
<p>ä¹Ÿå¯ä»¥å†™æˆè¿™ç§å½¢å¼ï¼š</p>
<pre><code class="language-sql">select *
from (
  select customer_id, min(order_date)
  from Delivery 
  group by customer_id
)t ;
</code></pre>
<hr>
<h4 id="ï¼ˆ3ï¼‰çª—å£å‡½æ•°-æ¡ä»¶ç­›é€‰"><a href="#ï¼ˆ3ï¼‰çª—å£å‡½æ•°-æ¡ä»¶ç­›é€‰" class="headerlink" title="ï¼ˆ3ï¼‰çª—å£å‡½æ•° + æ¡ä»¶ç­›é€‰"></a>ï¼ˆ3ï¼‰çª—å£å‡½æ•° + æ¡ä»¶ç­›é€‰</h4><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæ•°æ®åº“æ”¯æŒçª—å£å‡½æ•°ï¼ˆMySQL 8+ &#x2F; PostgreSQL &#x2F; Oracle &#x2F; SQL Serverï¼‰ï¼Œ<strong>éœ€è¦æŒ‰ç»„å–å‰å‡ å&#x2F;æœ€å€¼ã€‚</strong></p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨maxã€minçš„çª—å£å‡½æ•°å½¢å¼æ¥è·å–æ¯ä¸ªç»„åˆ«çš„æœ€å€¼</p>
<ul>
<li>ç‰¹ç‚¹ï¼šå†™æ³•ç®€æ´ï¼Œå¯åŒæ—¶ä¿ç•™åˆ†ç»„å†…æ’åºä¿¡æ¯ã€‚</li>
<li>ç¤ºä¾‹ï¼šæ‰¾æ¯ä¸ªå®¢æˆ·çš„é¦–å•</li>
</ul>
<pre><code class="language-sql">with t as (
  select *,
         row_number() over(partition by customer_id order by order_date) as rn
  from Delivery
)
select *
from t
where rn = 1;
</code></pre>
<ul>
<li>å¦‚æœè¦å¤„ç†å¹¶åˆ—æƒ…å†µï¼Œå¯ä»¥ç”¨ <code>rank()</code> æˆ– <code>dense_rank()</code>ã€‚</li>
</ul>
<hr>
<h4 id="ï¼ˆ4ï¼‰ORDER-BY-LIMIT"><a href="#ï¼ˆ4ï¼‰ORDER-BY-LIMIT" class="headerlink" title="ï¼ˆ4ï¼‰ORDER BY + LIMIT"></a>ï¼ˆ4ï¼‰ORDER BY + LIMIT</h4><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<strong>åªéœ€è¦å…¨è¡¨èŒƒå›´å†…çš„æœ€å€¼</strong>ï¼Œä¸”åªå–å‰ N æ¡ï¼ˆä¸åˆ†ç»„ï¼‰ã€‚</p>
<ul>
<li>ç‰¹ç‚¹ï¼šç®€å•é«˜æ•ˆï¼Œä½†æ— æ³•ç›´æ¥åº”å¯¹ã€Œæ¯ç»„æœ€å€¼ã€é—®é¢˜ã€‚</li>
<li>ç¤ºä¾‹ï¼šæ‰¾å·¥èµ„æœ€é«˜çš„å‘˜å·¥ï¼ˆTop 1ï¼‰</li>
</ul>
<pre><code class="language-sql">select *
from Employee
order by salary desc
limit 1;
</code></pre>
<ul>
<li>å¦‚æœéœ€è¦æ¯ç»„æœ€å€¼ï¼Œå°±ä¸é€‚åˆï¼Œåªèƒ½é…åˆçª—å£å‡½æ•°æˆ–å­æŸ¥è¯¢ã€‚</li>
</ul>
<hr>
<h4 id="å¯¹æ¯”æ€»ç»“"><a href="#å¯¹æ¯”æ€»ç»“" class="headerlink" title="å¯¹æ¯”æ€»ç»“"></a>å¯¹æ¯”æ€»ç»“</h4><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>ä¼˜ç‚¹</th>
<th>å±€é™</th>
</tr>
</thead>
<tbody><tr>
<td><strong>éç›¸å…³å­æŸ¥è¯¢</strong></td>
<td>å…¨è¡¨å”¯ä¸€æœ€å€¼</td>
<td>ç®€å•</td>
<td>åªèƒ½å¤„ç†å•ä¸ªå…¨å±€æœ€å€¼</td>
</tr>
<tr>
<td><strong>ç›¸å…³å­æŸ¥è¯¢</strong></td>
<td>æ¯ç»„æœ€å€¼ï¼ˆéœ€è¦ä¾èµ–å¤–å±‚æ¡ä»¶ï¼‰</td>
<td>é€šç”¨ï¼Œä¸è¦æ±‚çª—å£å‡½æ•°</td>
<td>å­æŸ¥è¯¢å¤šæ¬¡æ‰§è¡Œï¼Œæ€§èƒ½è¾ƒå·®</td>
</tr>
<tr>
<td><strong>çª—å£å‡½æ•°</strong></td>
<td>æ¯ç»„æœ€å€¼&#x2F;å‰ N ä¸ª</td>
<td>é«˜æ•ˆç®€æ´ï¼Œç°ä»£ SQL æ¨è</td>
<td>éœ€è¦æ•°æ®åº“æ”¯æŒçª—å£å‡½æ•°</td>
</tr>
<tr>
<td><strong>ORDER BY + LIMIT</strong></td>
<td>å…¨è¡¨å‰ N ä¸ª</td>
<td>ç®€æ´é«˜æ•ˆ</td>
<td>ä¸èƒ½åˆ†ç»„ï¼Œåªèƒ½å¤„ç†å…¨å±€æœ€å€¼</td>
</tr>
</tbody></table>
<hr>
<p>ğŸ‘‰ å¿«é€Ÿè®°å¿†ï¼š</p>
<ul>
<li><strong>å…¨å±€æœ€å€¼</strong> â†’ éç›¸å…³å­æŸ¥è¯¢ æˆ– <code>order by + limit</code></li>
<li><strong>åˆ†ç»„æœ€å€¼</strong> â†’ ç›¸å…³å­æŸ¥è¯¢ æˆ– çª—å£å‡½æ•°</li>
<li><strong>è¦å‰ N å&#x2F;å¹¶åˆ—æƒ…å†µ</strong> â†’ çª—å£å‡½æ•°æœ€ä½³</li>
</ul>
<hr>
<h3 id="1204-æœ€åä¸€ä¸ªèƒ½è¿›å…¥å·´å£«çš„äºº"><a href="#1204-æœ€åä¸€ä¸ªèƒ½è¿›å…¥å·´å£«çš„äºº" class="headerlink" title="1204.æœ€åä¸€ä¸ªèƒ½è¿›å…¥å·´å£«çš„äºº"></a>1204.æœ€åä¸€ä¸ªèƒ½è¿›å…¥å·´å£«çš„äºº</h3><p>è¡¨: <code>Queue</code></p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| person_id   | int     |
| person_name | varchar |
| weight      | int     |
| turn        | int     |
+-------------+---------+
person_id æ˜¯è¿™ä¸ªè¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
è¯¥è¡¨å±•ç¤ºäº†æ‰€æœ‰å€™è½¦ä¹˜å®¢çš„ä¿¡æ¯ã€‚
è¡¨ä¸­ person_id å’Œ turn åˆ—å°†åŒ…å«ä» 1 åˆ° n çš„æ‰€æœ‰æ•°å­—ï¼Œå…¶ä¸­ n æ˜¯è¡¨ä¸­çš„è¡Œæ•°ã€‚
turn å†³å®šäº†å€™è½¦ä¹˜å®¢ä¸Šå·´å£«çš„é¡ºåºï¼Œå…¶ä¸­ turn=1 è¡¨ç¤ºç¬¬ä¸€ä¸ªä¸Šå·´å£«ï¼Œturn=n è¡¨ç¤ºæœ€åä¸€ä¸ªä¸Šå·´å£«ã€‚
weight è¡¨ç¤ºå€™è½¦ä¹˜å®¢çš„ä½“é‡ï¼Œä»¥åƒå…‹ä¸ºå•ä½ã€‚
</code></pre>
<p>æœ‰ä¸€é˜Ÿä¹˜å®¢åœ¨ç­‰ç€ä¸Šå·´å£«ã€‚ç„¶è€Œï¼Œå·´å£«æœ‰<code>1000</code> <strong>åƒå…‹</strong> çš„é‡é‡é™åˆ¶ï¼Œæ‰€ä»¥å…¶ä¸­ä¸€éƒ¨åˆ†ä¹˜å®¢å¯èƒ½æ— æ³•ä¸Šå·´å£«ã€‚</p>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡º <strong>æœ€åä¸€ä¸ª</strong> ä¸Šå·´å£«ä¸”ä¸è¶…è¿‡é‡é‡é™åˆ¶çš„ä¹˜å®¢ï¼Œå¹¶æŠ¥å‘Š <code>person_name</code> ã€‚é¢˜ç›®æµ‹è¯•ç”¨ä¾‹ç¡®ä¿é¡ºä½ç¬¬ä¸€çš„äººå¯ä»¥ä¸Šå·´å£«ä¸”ä¸ä¼šè¶…é‡ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Queue è¡¨
+-----------+-------------+--------+------+
| person_id | person_name | weight | turn |
+-----------+-------------+--------+------+
| 5         | Alice       | 250    | 1    |
| 4         | Bob         | 175    | 5    |
| 3         | Alex        | 350    | 2    |
| 6         | John Cena   | 400    | 3    |
| 1         | Winston     | 500    | 6    |
| 2         | Marie       | 200    | 4    |
+-----------+-------------+--------+------+
è¾“å‡ºï¼š
+-------------+
| person_name |
+-------------+
| John Cena   |
+-------------+
è§£é‡Šï¼š
ä¸ºäº†ç®€åŒ–ï¼ŒQueue è¡¨æŒ‰ turn åˆ—ç”±å°åˆ°å¤§æ’åºã€‚
+------+----+-----------+--------+--------------+
| Turn | ID | Name      | Weight | Total Weight |
+------+----+-----------+--------+--------------+
| 1    | 5  | Alice     | 250    | 250          |
| 2    | 3  | Alex      | 350    | 600          |
| 3    | 6  | John Cena | 400    | 1000         | (æœ€åä¸€ä¸ªä¸Šå·´å£«)
| 4    | 2  | Marie     | 200    | 1200         | (æ— æ³•ä¸Šå·´å£«)
| 5    | 4  | Bob       | 175    | ___          |
| 6    | 1  | Winston   | 500    | ___          |
+------+----+-----------+--------+--------------+
</code></pre>
<p>è§£ç­”ï¼š</p>
<p><strong>PSï¼šSQL èšåˆå‡½æ•°ï¼ˆå¦‚ <code>MAX()</code>ï¼‰å’Œæ™®é€šåˆ—ä¹‹é—´æ²¡æœ‰è‡ªåŠ¨çš„â€œè¡Œå¯¹é½â€å…³ç³»ã€‚</strong></p>
<p>ä¸èƒ½ç›´æ¥å†™æˆï¼ï¼š</p>
<pre><code class="language-sql">select person_name, max(total_weight) from (
    select * , sum(weight)over (order by turn) as total_weight from Queue
)t where total_weight &lt;= 1000;

-- ç»“æœåªä¼šè¿”å›
| person_id | person_name | weight | turn |
| --------- | ----------- | ------ | ---- |
| 5         | Alice       | 250    | 1    |
| 4         | Bob         | 175    | 5    |
| 3         | Alex        | 350    | 2    |
| 6         | John Cena   | 400    | 3    |
| 1         | Winston     | 500    | 6    |
| 2         | Marie       | 200    | 4    |

| person_name | max(total_weight) |
| ----------- | ----------------- |
| Alice       | 1000              |

-- è€Œä¸æ˜¯æ­£ç¡®è¾“å‡º
| person_name |
| ----------- |
| John Cena   |
</code></pre>
<h4 id="ï¼ˆ1ï¼‰å­æŸ¥è¯¢-ç­‰å€¼è¿‡æ»¤"><a href="#ï¼ˆ1ï¼‰å­æŸ¥è¯¢-ç­‰å€¼è¿‡æ»¤" class="headerlink" title="ï¼ˆ1ï¼‰å­æŸ¥è¯¢+ç­‰å€¼è¿‡æ»¤"></a>ï¼ˆ1ï¼‰å­æŸ¥è¯¢+ç­‰å€¼è¿‡æ»¤</h4><pre><code class="language-sql"># Write your MySQL query statement below
with base as(
    select * , sum(weight)over (order by turn) as total_weight from Queue
)
select person_name from base where total_weight = (
    select max(total_weight) as mx from base where total_weight &lt;= 1000
);
</code></pre>
<hr>
<h4 id="ï¼ˆ2ï¼‰ORDER-BY-LIMIT"><a href="#ï¼ˆ2ï¼‰ORDER-BY-LIMIT" class="headerlink" title="ï¼ˆ2ï¼‰ORDER BY+LIMIT"></a>ï¼ˆ2ï¼‰ORDER BY+LIMIT</h4><pre><code class="language-sql"># Write your MySQL query statement below
select person_name from (
    select * , sum(weight)over (order by turn) as total_weight from Queue
)t where total_weight &lt;= 1000 order by total_weight DESC limit 1;
</code></pre>
<hr>
<h3 id="1907-æŒ‰åˆ†ç±»ç»Ÿè®¡è–ªæ°´"><a href="#1907-æŒ‰åˆ†ç±»ç»Ÿè®¡è–ªæ°´" class="headerlink" title="1907. æŒ‰åˆ†ç±»ç»Ÿè®¡è–ªæ°´"></a>1907. æŒ‰åˆ†ç±»ç»Ÿè®¡è–ªæ°´</h3><p>è¡¨: <code>Accounts</code></p>
<pre><code>+-------------+------+
| åˆ—å        | ç±»å‹  |
+-------------+------+
| account_id  | int  |
| income      | int  |
+-------------+------+
åœ¨ SQL ä¸­ï¼Œaccount_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€ä¸ªé“¶è¡Œå¸æˆ·çš„æœˆæ”¶å…¥çš„ä¿¡æ¯ã€‚
</code></pre>
<p>æŸ¥è¯¢æ¯ä¸ªå·¥èµ„ç±»åˆ«çš„é“¶è¡Œè´¦æˆ·æ•°é‡ã€‚ å·¥èµ„ç±»åˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>&quot;Low Salary&quot;</code>ï¼šæ‰€æœ‰å·¥èµ„ <strong>ä¸¥æ ¼ä½äº</strong> <code>20000</code> ç¾å…ƒã€‚</li>
<li><code>&quot;Average Salary&quot;</code>ï¼š <strong>åŒ…å«</strong> èŒƒå›´å†…çš„æ‰€æœ‰å·¥èµ„ <code>[$20000, $50000]</code> ã€‚</li>
<li><code>&quot;High Salary&quot;</code>ï¼šæ‰€æœ‰å·¥èµ„ <strong>ä¸¥æ ¼å¤§äº</strong> <code>50000</code> ç¾å…ƒã€‚</li>
</ul>
<p>ç»“æœè¡¨ <strong>å¿…é¡»</strong> åŒ…å«æ‰€æœ‰ä¸‰ä¸ªç±»åˆ«ã€‚ å¦‚æœæŸä¸ªç±»åˆ«ä¸­æ²¡æœ‰å¸æˆ·ï¼Œåˆ™æŠ¥å‘Š <code>0</code> ã€‚</p>
<p>æŒ‰ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ç¤ºä¾‹ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Accounts è¡¨:
+------------+--------+
| account_id | income |
+------------+--------+
| 3          | 108939 |
| 2          | 12747  |
| 8          | 87709  |
| 6          | 91796  |
+------------+--------+
è¾“å‡ºï¼š
+----------------+----------------+
| category       | accounts_count |
+----------------+----------------+
| Low Salary     | 1              |
| Average Salary | 0              |
| High Salary    | 3              |
+----------------+----------------+
è§£é‡Šï¼š
ä½è–ª: æœ‰ä¸€ä¸ªè´¦æˆ· 2.
ä¸­ç­‰è–ªæ°´: æ²¡æœ‰.
é«˜è–ª: æœ‰ä¸‰ä¸ªè´¦æˆ·ï¼Œä»–ä»¬æ˜¯ 3, 6å’Œ 8.
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">select &#39;Low Salary&#39; as category, sum(case when income &lt; 20000 then 1 else 0 end) as accounts_count
from Accounts
Union all
select &#39;Average Salary&#39; as category, sum(case when income &gt;= 20000 and income &lt;= 50000 then 1 else 0 end) as accounts_count
from Accounts
Union all
select &#39;High Salary&#39; as category, sum(case when income &gt; 50000 then 1 else 0 end) as accounts_count
from Accounts;
</code></pre>
<hr>
<h3 id="626-æ¢åº§ä½"><a href="#626-æ¢åº§ä½" class="headerlink" title="626. æ¢åº§ä½"></a>626. æ¢åº§ä½</h3><p>è¡¨: <code>Seat</code></p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| student     | varchar |
+-------------+---------+
id æ˜¯è¯¥è¡¨çš„ä¸»é”®ï¼ˆå”¯ä¸€å€¼ï¼‰åˆ—ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºå­¦ç”Ÿçš„å§“åå’Œ IDã€‚
ID åºåˆ—å§‹ç»ˆä» 1 å¼€å§‹å¹¶è¿ç»­å¢åŠ ã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆæ¥äº¤æ¢æ¯ä¸¤ä¸ªè¿ç»­çš„å­¦ç”Ÿçš„åº§ä½å·ã€‚å¦‚æœå­¦ç”Ÿçš„æ•°é‡æ˜¯å¥‡æ•°ï¼Œåˆ™æœ€åä¸€ä¸ªå­¦ç”Ÿçš„idä¸äº¤æ¢ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥: 
Seat è¡¨:
+----+---------+
| id | student |
+----+---------+
| 1  | Abbot   |
| 2  | Doris   |
| 3  | Emerson |
| 4  | Green   |
| 5  | Jeames  |
+----+---------+
è¾“å‡º: 
+----+---------+
| id | student |
+----+---------+
| 1  | Doris   |
| 2  | Abbot   |
| 3  | Green   |
| 4  | Emerson |
| 5  | Jeames  |
+----+---------+
è§£é‡Š:
è¯·æ³¨æ„ï¼Œå¦‚æœå­¦ç”Ÿäººæ•°ä¸ºå¥‡æ•°ï¼Œåˆ™ä¸éœ€è¦æ›´æ¢æœ€åä¸€åå­¦ç”Ÿçš„åº§ä½ã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<h4 id="ï¼ˆ1ï¼‰åµŒå¥—æŸ¥è¯¢"><a href="#ï¼ˆ1ï¼‰åµŒå¥—æŸ¥è¯¢" class="headerlink" title="ï¼ˆ1ï¼‰åµŒå¥—æŸ¥è¯¢"></a>ï¼ˆ1ï¼‰åµŒå¥—æŸ¥è¯¢</h4><pre><code class="language-sql"># Write your MySQL query statement below
with base as(
    select *, lead(student, 1)over (order by id) as exchange_nxt, lag(student, 1)over (order by id) as exchange_pre from Seat
)
select id, IFNULL((case when (id % 2) != 0 then exchange_nxt else exchange_pre end), student) as student from base;
</code></pre>
<h4 id="ï¼ˆ2ï¼‰CASE-WHEN"><a href="#ï¼ˆ2ï¼‰CASE-WHEN" class="headerlink" title="ï¼ˆ2ï¼‰CASE WHEN"></a>ï¼ˆ2ï¼‰CASE WHEN</h4><pre><code class="language-sql"># Write your MySQL query statement below
select case 
        when id % 2 = 1 and id &lt; (select max(id) from Seat)
            then id + 1
        when id % 2 = 0 
            then id - 1
        else id
        end as id, student
    from Seat
order by id;
</code></pre>
<p>åœ¨ SQL é‡Œï¼Œ<code>CASE</code> å¯ä»¥å†™ä¸¤ç§å½¢å¼ï¼š</p>
<h5 id="a-ç®€å•-CASE"><a href="#a-ç®€å•-CASE" class="headerlink" title="a. ç®€å• CASE"></a>a. ç®€å• CASE</h5><p>ç›´æ¥å¯¹æŸä¸ªè¡¨è¾¾å¼çš„å€¼åšåŒ¹é…ï¼š</p>
<pre><code class="language-sql">CASE column_name
    WHEN &#39;A&#39; THEN &#39;ç±»å‹1&#39;
    WHEN &#39;B&#39; THEN &#39;ç±»å‹2&#39;
    ELSE &#39;å…¶ä»–&#39;
END
</code></pre>
<h5 id="b-æœç´¢-CASE-ï¼ˆæœ€å¸¸ç”¨ï¼‰"><a href="#b-æœç´¢-CASE-ï¼ˆæœ€å¸¸ç”¨ï¼‰" class="headerlink" title="b. æœç´¢ CASE ï¼ˆæœ€å¸¸ç”¨ï¼‰"></a>b. æœç´¢ CASE ï¼ˆæœ€å¸¸ç”¨ï¼‰</h5><p>æ¡ä»¶åˆ¤æ–­çµæ´»ï¼Œå¯ä»¥å†™æ¯”è¾ƒã€èŒƒå›´ç­‰ï¼š</p>
<pre><code class="language-sql">CASE
    WHEN score &gt;= 90 THEN &#39;ä¼˜ç§€&#39;
    WHEN score &gt;= 60 THEN &#39;åŠæ ¼&#39;
    ELSE &#39;ä¸åŠæ ¼&#39;
END
</code></pre>
<h5 id="c-ä½œä¸ºä¸€ä¸ªå­—æ®µè¾“å‡º"><a href="#c-ä½œä¸ºä¸€ä¸ªå­—æ®µè¾“å‡º" class="headerlink" title="c. ä½œä¸ºä¸€ä¸ªå­—æ®µè¾“å‡º"></a>c. ä½œä¸ºä¸€ä¸ªå­—æ®µè¾“å‡º</h5><pre><code class="language-sql">SELECT name,
       CASE WHEN age &lt; 18 THEN &#39;æœªæˆå¹´&#39;
            WHEN age &lt; 60 THEN &#39;æˆå¹´äºº&#39;
            ELSE &#39;è€å¹´äºº&#39;
       END AS age_group
FROM users;
</code></pre>
<h5 id="d-åœ¨èšåˆå‡½æ•°é‡Œåšæ¡ä»¶ç»Ÿè®¡"><a href="#d-åœ¨èšåˆå‡½æ•°é‡Œåšæ¡ä»¶ç»Ÿè®¡" class="headerlink" title="d. åœ¨èšåˆå‡½æ•°é‡Œåšæ¡ä»¶ç»Ÿè®¡"></a>d. åœ¨èšåˆå‡½æ•°é‡Œåšæ¡ä»¶ç»Ÿè®¡</h5><pre><code class="language-sql">SELECT
    SUM(CASE WHEN status = &#39;success&#39; THEN 1 ELSE 0 END) AS success_count,
    SUM(CASE WHEN status = &#39;fail&#39; THEN 1 ELSE 0 END)    AS fail_count
FROM logs;
</code></pre>
<p>å¸¸ç”¨äº <strong>æ¡ä»¶è®¡æ•°</strong>ã€‚</p>
<h5 id="e-æ’åºï¼ˆORDER-BYï¼‰"><a href="#e-æ’åºï¼ˆORDER-BYï¼‰" class="headerlink" title="e. æ’åºï¼ˆORDER BYï¼‰"></a>e. æ’åºï¼ˆORDER BYï¼‰</h5><pre><code class="language-sql">SELECT *
FROM orders
ORDER BY
  CASE 
    WHEN status = &#39;vip&#39; THEN 1
    WHEN status = &#39;normal&#39; THEN 2
    ELSE 3
  END;
</code></pre>
<hr>
<h3 id="1341-ç”µå½±è¯„åˆ†"><a href="#1341-ç”µå½±è¯„åˆ†" class="headerlink" title="1341. ç”µå½±è¯„åˆ†"></a>1341. ç”µå½±è¯„åˆ†</h3><p>è¡¨ï¼š<code>Movies</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| movie_id      | int     |
| title         | varchar |
+---------------+---------+
movie_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
title æ˜¯ç”µå½±çš„åå­—ã€‚
</code></pre>
<p>è¡¨ï¼š<code>Users</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| user_id       | int     |
| name          | varchar |
+---------------+---------+
user_id æ˜¯è¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
&#39;name&#39; åˆ—å…·æœ‰å”¯ä¸€å€¼ã€‚
</code></pre>
<p>è¡¨ï¼š<code>MovieRating</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| movie_id      | int     |
| user_id       | int     |
| rating        | int     |
| created_at    | date    |
+---------------+---------+
(movie_id, user_id) æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆ)ã€‚
è¿™ä¸ªè¡¨åŒ…å«ç”¨æˆ·åœ¨å…¶è¯„è®ºä¸­å¯¹ç”µå½±çš„è¯„åˆ† rating ã€‚
created_at æ˜¯ç”¨æˆ·çš„ç‚¹è¯„æ—¥æœŸã€‚ 
</code></pre>
<p>è¯·ä½ ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>æŸ¥æ‰¾è¯„è®ºç”µå½±æ•°é‡æœ€å¤šçš„ç”¨æˆ·åã€‚å¦‚æœå‡ºç°å¹³å±€ï¼Œè¿”å›å­—å…¸åºè¾ƒå°çš„ç”¨æˆ·åã€‚</li>
<li>æŸ¥æ‰¾åœ¨ <code>February 2020</code> <strong>å¹³å‡è¯„åˆ†æœ€é«˜</strong> çš„ç”µå½±åç§°ã€‚å¦‚æœå‡ºç°å¹³å±€ï¼Œè¿”å›å­—å…¸åºè¾ƒå°çš„ç”µå½±åç§°ã€‚</li>
</ul>
<p><strong>å­—å…¸åº</strong> ï¼Œå³æŒ‰å­—æ¯åœ¨å­—å…¸ä¸­å‡ºç°é¡ºåºå¯¹å­—ç¬¦ä¸²æ’åºï¼Œå­—å…¸åºè¾ƒå°åˆ™æ„å‘³ç€æ’åºé å‰ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Movies è¡¨ï¼š
+-------------+--------------+
| movie_id    |  title       |
+-------------+--------------+
| 1           | Avengers     |
| 2           | Frozen 2     |
| 3           | Joker        |
+-------------+--------------+
Users è¡¨ï¼š
+-------------+--------------+
| user_id     |  name        |
+-------------+--------------+
| 1           | Daniel       |
| 2           | Monica       |
| 3           | Maria        |
| 4           | James        |
+-------------+--------------+
MovieRating è¡¨ï¼š
+-------------+--------------+--------------+-------------+
| movie_id    | user_id      | rating       | created_at  |
+-------------+--------------+--------------+-------------+
| 1           | 1            | 3            | 2020-01-12  |
| 1           | 2            | 4            | 2020-02-11  |
| 1           | 3            | 2            | 2020-02-12  |
| 1           | 4            | 1            | 2020-01-01  |
| 2           | 1            | 5            | 2020-02-17  | 
| 2           | 2            | 2            | 2020-02-01  | 
| 2           | 3            | 2            | 2020-03-01  |
| 3           | 1            | 3            | 2020-02-22  | 
| 3           | 2            | 4            | 2020-02-25  | 
+-------------+--------------+--------------+-------------+
è¾“å‡ºï¼š
Result è¡¨ï¼š
+--------------+
| results      |
+--------------+
| Daniel       |
| Frozen 2     |
+--------------+
è§£é‡Šï¼š
Daniel å’Œ Monica éƒ½ç‚¹è¯„äº† 3 éƒ¨ç”µå½±ï¼ˆ&quot;Avengers&quot;, &quot;Frozen 2&quot; å’Œ &quot;Joker&quot;ï¼‰ ä½†æ˜¯ Daniel å­—å…¸åºæ¯”è¾ƒå°ã€‚
Frozen 2 å’Œ Joker åœ¨ 2 æœˆçš„è¯„åˆ†éƒ½æ˜¯ 3.5ï¼Œä½†æ˜¯ Frozen 2 çš„å­—å…¸åºæ¯”è¾ƒå°ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">with base as(
    select *, avg(rating) as avg_rate from (
        select *, date_format(created_at, &#39;%Y-%m&#39;) as created_month from MovieRating 
        where date_format(created_at, &#39;%Y-%m&#39;) = &#39;2020-02&#39;
    )a group by movie_id
),
seq as (
    select movie_id from base where avg_rate = (
        select max(avg_rate) from base 
    )
),
base2 as(
    select s.user_id from(
        select t.user_id, rank() over(order by ct DESC) as rk from(
            select user_id, count(*) as ct from  MovieRating group by user_id
        )t
    )s where s.rk = 1
)
select min(a.name) as results from Users a join base2 b on a.user_id = b.user_id union all
    select min(a.title) as results from Movies a join seq b on a.movie_id = b.movie_id;
</code></pre>
<p><strong>PS:</strong></p>
<p>ï¼ˆ1ï¼‰å¦‚æœéœ€è¦è·å–æŸä¸€åˆ—ä¸­ä¸åŒå€¼çš„æ€»æ•°ï¼Œeg:idåˆ—1,2,3å‡ºç°çš„æ¬¡æ•°ï¼Œå¯ä»¥</p>
<pre><code class="language-sql">select count(*) from emp group by id
</code></pre>
<p>ï¼ˆ2ï¼‰ç­‰å€¼å­æŸ¥è¯¢åªèƒ½è¿”å›ä¸€ä¸ªç»“æœï¼Œå­æŸ¥è¯¢é‡Œselectçš„æ•°å€¼ä¸èƒ½è¶…è¿‡ä¸€è¡Œ</p>
<hr>
<h3 id="1321-é¤å…è¥ä¸šé¢å˜åŒ–å¢é•¿"><a href="#1321-é¤å…è¥ä¸šé¢å˜åŒ–å¢é•¿" class="headerlink" title="1321. é¤å…è¥ä¸šé¢å˜åŒ–å¢é•¿"></a>1321. é¤å…è¥ä¸šé¢å˜åŒ–å¢é•¿</h3><p>è¡¨: <code>Customer</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| customer_id   | int     |
| name          | varchar |
| visited_on    | date    |
| amount        | int     |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œ(customer_id, visited_on) æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨åŒ…å«ä¸€å®¶é¤é¦†çš„é¡¾å®¢äº¤æ˜“æ•°æ®ã€‚
visited_on è¡¨ç¤º (customer_id) çš„é¡¾å®¢åœ¨ visited_on é‚£å¤©è®¿é—®äº†é¤é¦†ã€‚
amount æ˜¯ä¸€ä¸ªé¡¾å®¢æŸä¸€å¤©çš„æ¶ˆè´¹æ€»é¢ã€‚
</code></pre>
<p>ä½ æ˜¯é¤é¦†çš„è€æ¿ï¼Œç°åœ¨ä½ æƒ³åˆ†æä¸€ä¸‹å¯èƒ½çš„è¥ä¸šé¢å˜åŒ–å¢é•¿ï¼ˆæ¯å¤©è‡³å°‘æœ‰ä¸€ä½é¡¾å®¢ï¼‰ã€‚</p>
<p>è®¡ç®—ä»¥ 7 å¤©ï¼ˆæŸæ—¥æœŸ + è¯¥æ—¥æœŸå‰çš„ 6 å¤©ï¼‰ä¸ºä¸€ä¸ªæ—¶é—´æ®µçš„é¡¾å®¢æ¶ˆè´¹å¹³å‡å€¼ã€‚<code>average_amount</code> è¦ <strong>ä¿ç•™ä¸¤ä½å°æ•°ã€‚</strong></p>
<p>ç»“æœæŒ‰ <code>visited_on</code> <strong>å‡åºæ’åº</strong>ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼çš„ä¾‹å­å¦‚ä¸‹ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Customer è¡¨:
+-------------+--------------+--------------+-------------+
| customer_id | name         | visited_on   | amount      |
+-------------+--------------+--------------+-------------+
| 1           | Jhon         | 2019-01-01   | 100         |
| 2           | Daniel       | 2019-01-02   | 110         |
| 3           | Jade         | 2019-01-03   | 120         |
| 4           | Khaled       | 2019-01-04   | 130         |
| 5           | Winston      | 2019-01-05   | 110         | 
| 6           | Elvis        | 2019-01-06   | 140         | 
| 7           | Anna         | 2019-01-07   | 150         |
| 8           | Maria        | 2019-01-08   | 80          |
| 9           | Jaze         | 2019-01-09   | 110         | 
| 1           | Jhon         | 2019-01-10   | 130         | 
| 3           | Jade         | 2019-01-10   | 150         | 
+-------------+--------------+--------------+-------------+
è¾“å‡ºï¼š
+--------------+--------------+----------------+
| visited_on   | amount       | average_amount |
+--------------+--------------+----------------+
| 2019-01-07   | 860          | 122.86         |
| 2019-01-08   | 840          | 120            |
| 2019-01-09   | 840          | 120            |
| 2019-01-10   | 1000         | 142.86         |
+--------------+--------------+----------------+
è§£é‡Šï¼š
ç¬¬ä¸€ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-01 åˆ° 2019-01-07 æ˜¯restaurant-growth/restaurant-growth/ (100 + 110 + 120 + 130 + 110 + 140 + 150)/7 = 122.86
ç¬¬äºŒä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-02 åˆ° 2019-01-08 æ˜¯ (110 + 120 + 130 + 110 + 140 + 150 + 80)/7 = 120
ç¬¬ä¸‰ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-03 åˆ° 2019-01-09 æ˜¯ (120 + 130 + 110 + 140 + 150 + 80 + 110)/7 = 120
ç¬¬å››ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-04 åˆ° 2019-01-10 æ˜¯ (130 + 110 + 140 + 150 + 80 + 110 + 130 + 150)/7 = 142.86
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">select visited_on, total_amount as amount, round(total_amount / 7, 2) as average_amount from( 
    select visited_on, sum(new_amount)over (order by visited_on ROWS 6 PRECEDING) total_amount from (
        select visited_on, sum(amount) new_amount from Customer group by visited_on
    )s
)t where visited_on &gt;= (
    select min(visited_on) + 6 from Customer
);
</code></pre>
<p>çª—å£å‡½æ•°å¯ä»¥é€‰æ‹©æ“ä½œæ•°æ®çš„èŒƒå›´</p>
<p>egï¼š</p>
<pre><code class="language-sql">å–å½“å‰è¡Œå’Œå‰äº”è¡Œï¼šROWS between 5 preceding and current row --å…±6è¡Œ
å–å½“å‰è¡Œå’Œåäº”è¡Œï¼šROWS between current row and 5 following --å…±6è¡Œ
å–å‰äº”è¡Œå’Œåäº”è¡Œï¼šROWS between 5 preceding and 5 folowing --å…±11è¡Œ
</code></pre>
<hr>
<h3 id="602-å¥½å‹ç”³è¯·llï¼šè°æœ‰æœ€å¤šçš„å¥½å‹"><a href="#602-å¥½å‹ç”³è¯·llï¼šè°æœ‰æœ€å¤šçš„å¥½å‹" class="headerlink" title="602.å¥½å‹ç”³è¯·llï¼šè°æœ‰æœ€å¤šçš„å¥½å‹"></a>602.å¥½å‹ç”³è¯·llï¼šè°æœ‰æœ€å¤šçš„å¥½å‹</h3><p><code>RequestAccepted</code> è¡¨ï¼š</p>
<pre><code>+----------------+---------+
| Column Name    | Type    |
+----------------+---------+
| requester_id   | int     |
| accepter_id    | int     |
| accept_date    | date    |
+----------------+---------+
(requester_id, accepter_id) æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆ)ã€‚
è¿™å¼ è¡¨åŒ…å«å‘é€å¥½å‹è¯·æ±‚çš„äººçš„ ID ï¼Œæ¥æ”¶å¥½å‹è¯·æ±‚çš„äººçš„ ID ï¼Œä»¥åŠå¥½å‹è¯·æ±‚é€šè¿‡çš„æ—¥æœŸã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ‹¥æœ‰æœ€å¤šçš„å¥½å‹çš„äººå’Œä»–æ‹¥æœ‰çš„å¥½å‹æ•°ç›®ã€‚</p>
<p>ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ä¿è¯æ‹¥æœ‰æœ€å¤šå¥½å‹æ•°ç›®çš„åªæœ‰ 1 ä¸ªäººã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
RequestAccepted è¡¨ï¼š
+--------------+-------------+-------------+
| requester_id | accepter_id | accept_date |
+--------------+-------------+-------------+
| 1            | 2           | 2016/06/03  |
| 1            | 3           | 2016/06/08  |
| 2            | 3           | 2016/06/08  |
| 3            | 4           | 2016/06/09  |
+--------------+-------------+-------------+
è¾“å‡ºï¼š
+----+-----+
| id | num |
+----+-----+
| 3  | 3   |
+----+-----+
è§£é‡Šï¼š
ç¼–å·ä¸º 3 çš„äººæ˜¯ç¼–å·ä¸º 1 ï¼Œ2 å’Œ 4 çš„äººçš„å¥½å‹ï¼Œæ‰€ä»¥ä»–æ€»å…±æœ‰ 3 ä¸ªå¥½å‹ï¼Œæ¯”å…¶ä»–äººéƒ½å¤šã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">with base as (
    select accepter_id, count(*) as accepted_num 
    from RequestAccepted 
    group by accepter_id
),
seq as (
    select requester_id, count(*) as requested_num 
    from RequestAccepted 
    group by requester_id
),
seq1 as (
    -- å·¦è¿æ¥
    select a.accepter_id as id, 
           ifnull(a.accepted_num,0) + ifnull(b.requested_num,0) as num
    from base a 
    left join seq b on a.accepter_id = b.requester_id
    
    union
    
    -- å³è¿æ¥ï¼ˆè¡¥é½å³è¾¹ç‹¬æœ‰çš„è¡Œï¼‰
    select b.requester_id as id, 
           ifnull(a.accepted_num,0) + ifnull(b.requested_num,0) as num
    from base a 
    right join seq b on a.accepter_id = b.requester_id
)
select id, num
from seq1
where num = (select max(num) from seq1);
</code></pre>
<ul>
<li><code>union</code> ä¿è¯æŠŠä¸¤è¾¹ç‹¬æœ‰çš„ id éƒ½ä¿ç•™ä¸‹æ¥ï¼Œç­‰ä»·äº FULL OUTER JOINã€‚</li>
<li><code>ifnull(...,0)</code> æ˜¯é¿å… NULL ç›¸åŠ å¯¼è‡´ç»“æœä¸º NULLã€‚</li>
<li>æœ€åå–æœ€å¤§å€¼å³å¯ã€‚</li>
</ul>
<hr>
<h3 id="585-2016å¹´çš„æŠ•èµ„"><a href="#585-2016å¹´çš„æŠ•èµ„" class="headerlink" title="585.2016å¹´çš„æŠ•èµ„"></a>585.2016å¹´çš„æŠ•èµ„</h3><p><code>Insurance</code> è¡¨ï¼š</p>
<pre><code>+-------------+-------+
| Column Name | Type  |
+-------------+-------+
| pid         | int   |
| tiv_2015    | float |
| tiv_2016    | float |
| lat         | float |
| lon         | float |
+-------------+-------+
pid æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
è¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€æ¡ä¿é™©ä¿¡æ¯ï¼Œå…¶ä¸­ï¼š
pid æ˜¯æŠ•ä¿äººçš„æŠ•ä¿ç¼–å·ã€‚
tiv_2015 æ˜¯è¯¥æŠ•ä¿äººåœ¨ 2015 å¹´çš„æ€»æŠ•ä¿é‡‘é¢ï¼Œtiv_2016 æ˜¯è¯¥æŠ•ä¿äººåœ¨ 2016 å¹´çš„æ€»æŠ•ä¿é‡‘é¢ã€‚
lat æ˜¯æŠ•ä¿äººæ‰€åœ¨åŸå¸‚çš„çº¬åº¦ã€‚é¢˜ç›®æ•°æ®ç¡®ä¿ lat ä¸ä¸ºç©ºã€‚
lon æ˜¯æŠ•ä¿äººæ‰€åœ¨åŸå¸‚çš„ç»åº¦ã€‚é¢˜ç›®æ•°æ®ç¡®ä¿ lon ä¸ä¸ºç©ºã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆæŠ¥å‘Š 2016 å¹´ (<code>tiv_2016</code>) æ‰€æœ‰æ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„æŠ•ä¿äººçš„æŠ•ä¿é‡‘é¢ä¹‹å’Œï¼š</p>
<ul>
<li>ä»–åœ¨ 2015 å¹´çš„æŠ•ä¿é¢ (<code>tiv_2015</code>) è‡³å°‘è·Ÿä¸€ä¸ªå…¶ä»–æŠ•ä¿äººåœ¨ 2015 å¹´çš„æŠ•ä¿é¢ç›¸åŒã€‚</li>
<li>ä»–æ‰€åœ¨çš„åŸå¸‚å¿…é¡»ä¸å…¶ä»–æŠ•ä¿äººéƒ½ä¸åŒï¼ˆä¹Ÿå°±æ˜¯è¯´ (<code>lat, lon</code>) ä¸èƒ½è·Ÿå…¶ä»–ä»»ä½•ä¸€ä¸ªæŠ•ä¿äººå®Œå…¨ç›¸åŒï¼‰ã€‚</li>
</ul>
<p><code>tiv_2016</code> å››èˆäº”å…¥çš„ <strong>ä¸¤ä½å°æ•°</strong> ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Insurance è¡¨ï¼š
+-----+----------+----------+-----+-----+
| pid | tiv_2015 | tiv_2016 | lat | lon |
+-----+----------+----------+-----+-----+
| 1   | 10       | 5        | 10  | 10  |
| 2   | 20       | 20       | 20  | 20  |
| 3   | 10       | 30       | 20  | 20  |
| 4   | 10       | 40       | 40  | 40  |
+-----+----------+----------+-----+-----+
è¾“å‡ºï¼š
+----------+
| tiv_2016 |
+----------+
| 45.00    |
+----------+
è§£é‡Šï¼š
è¡¨ä¸­çš„ç¬¬ä¸€æ¡è®°å½•å’Œæœ€åä¸€æ¡è®°å½•éƒ½æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ã€‚
tiv_2015 å€¼ä¸º 10 ä¸ç¬¬ä¸‰æ¡å’Œç¬¬å››æ¡è®°å½•ç›¸åŒï¼Œä¸”å…¶ä½ç½®æ˜¯å”¯ä¸€çš„ã€‚

ç¬¬äºŒæ¡è®°å½•ä¸ç¬¦åˆä»»ä½•ä¸€ä¸ªæ¡ä»¶ã€‚å…¶ tiv_2015 ä¸å…¶ä»–æŠ•ä¿äººä¸åŒï¼Œå¹¶ä¸”ä½ç½®ä¸ç¬¬ä¸‰æ¡è®°å½•ç›¸åŒï¼Œè¿™ä¹Ÿå¯¼è‡´äº†ç¬¬ä¸‰æ¡è®°å½•ä¸ç¬¦åˆé¢˜ç›®è¦æ±‚ã€‚
å› æ­¤ï¼Œç»“æœæ˜¯ç¬¬ä¸€æ¡è®°å½•å’Œæœ€åä¸€æ¡è®°å½•çš„ tiv_2016 ä¹‹å’Œï¼Œå³ 45 ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">select round(sum(tiv_2016), 2) as tiv_2016 from (
    select a.pid, a.tiv_2016 from Insurance a where a.tiv_2015 in (
        select b.tiv_2015 from Insurance b where a.pid &lt;&gt; b.pid
    ) and not exists (
        select 1 
        from Insurance b 
        where a.pid &lt;&gt; b.pid 
        and a.lat = b.lat 
        and a.lon = b.lon
    )
)t;
</code></pre>
<p><strong>ç”¨ <code>in</code> æ›¿ä»£ <code>=</code></strong></p>
<ul>
<li>ä¿è¯å¯ä»¥åŒ¹é…å¤šè¡Œ <code>tiv_2015</code>ï¼Œé¿å…è¯­æ³•é”™è¯¯ã€‚</li>
<li>é€»è¾‘ï¼šåªè¦ <code>a.tiv_2015</code> åœ¨åˆ«çš„è®°å½•ä¸­å‡ºç°è¿‡ï¼Œå°±ç¬¦åˆã€‚</li>
</ul>
<p><strong>ç”¨ <code>not exists</code> æ›¿ä»£ <code>lat != ... or lon != ...</code></strong></p>
<ul>
<li>è‹¥å†™æ³•æ˜¯â€œåªè¦æŸä¸ªçº¬åº¦ä¸åŒå°±é€šè¿‡â€ï¼Œä¼šè¯¯åˆ¤ã€‚</li>
<li><strong><code>not exists</code> çš„é€»è¾‘æ˜¯â€œä¸èƒ½å­˜åœ¨ä¸€æ¡è®°å½•è·Ÿæˆ‘çº¬åº¦å’Œç»åº¦éƒ½ç›¸åŒâ€ã€‚</strong></li>
</ul>
<p><strong>é€»è¾‘æ¸…æ™°ä¸”æ— æ­§ä¹‰</strong></p>
<ul>
<li>ä¿è¯æœ‰ç›¸åŒ <code>tiv_2015</code>ï¼›</li>
<li>ä¿è¯æ²¡æœ‰ç›¸åŒ <code>(lat, lon)</code>ã€‚</li>
</ul>
<hr>
<p>è¡¥å……ï¼š</p>
<p>SQLæ‰§è¡Œé¡ºåºï¼š</p>
<ul>
<li><strong>FROM</strong> Employee</li>
<li><strong>WHERE</strong> salary &gt; 5000 ï¼ˆå…ˆç­›æ‰å·¥èµ„ä¸å¤Ÿçš„è¡Œï¼‰</li>
<li><strong>GROUP BY</strong> dept ï¼ˆæŒ‰éƒ¨é—¨åˆ†ç»„ï¼‰</li>
<li><strong>COUNT(*)</strong> ç»Ÿè®¡æ¯ç»„äººæ•°</li>
<li><strong>HAVING</strong> è¿‡æ»¤å‡ºäººæ•° â‰¥3 çš„éƒ¨é—¨</li>
<li><strong>SELECT</strong> è¾“å‡º dept, cnt</li>
<li><strong>ORDER BY</strong> æŒ‰ cnt é™åº</li>
<li><strong>LIMIT</strong> å–å‰ 5 ä¸ªéƒ¨é—¨</li>
</ul>
<p>char_length(col)è¿”å›è¯¥åˆ—çš„å­—ç¬¦æ•°</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/Leetcode/" style="color: #00a596">Leetcode</a>
        </span>
        
        <span class="tag">
            
            <a href="/tags/SQL/" style="color: #ffa2c4">SQL</a>
        </span>
        
    </div>
    <a href="/2022/05/26/Leetcode%20%20sql%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%95/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2021/12/13/%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1/">
        <h2 class="post-title">æ•°æ®å»ºæ¨¡</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                æ•°æ®å»ºæ¨¡
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2021/12/13
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="1-æ•°æ®é¢„å¤„ç†"><a href="#1-æ•°æ®é¢„å¤„ç†" class="headerlink" title="1. æ•°æ®é¢„å¤„ç†"></a>1. æ•°æ®é¢„å¤„ç†</h2><h3 id="ï¼ˆ1ï¼‰æ•°æ®æ¸…æ´—"><a href="#ï¼ˆ1ï¼‰æ•°æ®æ¸…æ´—" class="headerlink" title="ï¼ˆ1ï¼‰æ•°æ®æ¸…æ´—"></a>ï¼ˆ1ï¼‰æ•°æ®æ¸…æ´—</h3><h4 id="1-1-ç¼ºå¤±å€¼å¤„ç†"><a href="#1-1-ç¼ºå¤±å€¼å¤„ç†" class="headerlink" title="1.1 ç¼ºå¤±å€¼å¤„ç†"></a>1.1 ç¼ºå¤±å€¼å¤„ç†</h4><h4 id="1-2-å¼‚å¸¸å€¼å¤„ç†"><a href="#1-2-å¼‚å¸¸å€¼å¤„ç†" class="headerlink" title="1.2 å¼‚å¸¸å€¼å¤„ç†"></a>1.2 å¼‚å¸¸å€¼å¤„ç†</h4><h4 id="1-3-æ•°æ®è§„çº¦"><a href="#1-3-æ•°æ®è§„çº¦" class="headerlink" title="1.3 æ•°æ®è§„çº¦"></a>1.3 æ•°æ®è§„çº¦</h4><h4 id="1-4-æ•°æ®å˜æ¢"><a href="#1-4-æ•°æ®å˜æ¢" class="headerlink" title="1.4 æ•°æ®å˜æ¢"></a>1.4 æ•°æ®å˜æ¢</h4><h2 id="1-æ•°æ®åˆ†æ"><a href="#1-æ•°æ®åˆ†æ" class="headerlink" title="1. æ•°æ®åˆ†æ"></a>1. æ•°æ®åˆ†æ</h2><h3 id="ï¼ˆ1ï¼‰åˆæ­¥åˆ†æ"><a href="#ï¼ˆ1ï¼‰åˆæ­¥åˆ†æ" class="headerlink" title="ï¼ˆ1ï¼‰åˆæ­¥åˆ†æ"></a>ï¼ˆ1ï¼‰åˆæ­¥åˆ†æ</h3><h5 id="æŸ¥çœ‹æ ·ä¾‹æ•°æ®"><a href="#æŸ¥çœ‹æ ·ä¾‹æ•°æ®" class="headerlink" title="æŸ¥çœ‹æ ·ä¾‹æ•°æ®"></a>æŸ¥çœ‹æ ·ä¾‹æ•°æ®</h5><p>data.head(5)</p>
<h5 id="æŸ¥çœ‹å½¢çŠ¶"><a href="#æŸ¥çœ‹å½¢çŠ¶" class="headerlink" title="æŸ¥çœ‹å½¢çŠ¶"></a>æŸ¥çœ‹å½¢çŠ¶</h5><p>data.shape()</p>
<h3 id="ï¼ˆ2ï¼‰è´¨é‡åˆ†æ"><a href="#ï¼ˆ2ï¼‰è´¨é‡åˆ†æ" class="headerlink" title="ï¼ˆ2ï¼‰è´¨é‡åˆ†æ"></a>ï¼ˆ2ï¼‰è´¨é‡åˆ†æ</h3><h5 id="åˆ¤æ–­å”¯ä¸€ç´¢å¼•æ˜¯å¦æœ‰é‡å¤å€¼"><a href="#åˆ¤æ–­å”¯ä¸€ç´¢å¼•æ˜¯å¦æœ‰é‡å¤å€¼" class="headerlink" title="åˆ¤æ–­å”¯ä¸€ç´¢å¼•æ˜¯å¦æœ‰é‡å¤å€¼"></a>åˆ¤æ–­å”¯ä¸€ç´¢å¼•æ˜¯å¦æœ‰é‡å¤å€¼</h5><p>data[â€˜ . â€˜].nunique() &#x3D;&#x3D; data.shape[0]</p>
<h5 id="ç¼ºå¤±å€¼æ£€éªŒ"><a href="#ç¼ºå¤±å€¼æ£€éªŒ" class="headerlink" title="ç¼ºå¤±å€¼æ£€éªŒ"></a>ç¼ºå¤±å€¼æ£€éªŒ</h5><p>data.isnull().sum()</p>
<h5 id="å¼‚å¸¸å€¼æ£€æµ‹"><a href="#å¼‚å¸¸å€¼æ£€æµ‹" class="headerlink" title="å¼‚å¸¸å€¼æ£€æµ‹"></a>å¼‚å¸¸å€¼æ£€æµ‹</h5><p>â€‹	æ‰“å°å„ä¸ªå±æ€§çš„ç›´æ–¹å›¾</p>
<pre><code class="language-python">sns.set()
for col in cols:
    statistic = data.describe()
    plt.figure(figsize=(6,6))
    sns.hisplot(data[col], kde=True) # kdeæ ¸å¯†åº¦æ›²çº¿ï¼Œè‹¥ä¸ç›´æ–¹å›¾èµ°å‘ä¸€è‡´åˆ™è¯´æ˜æ²¡æœ‰å¼‚å¸¸å€¼
    plt.title...
    plt.show()
</code></pre>
<h5 id="è§„å¾‹ä¸€è‡´æ€§æ£€æµ‹"><a href="#è§„å¾‹ä¸€è‡´æ€§æ£€æµ‹" class="headerlink" title="è§„å¾‹ä¸€è‡´æ€§æ£€æµ‹"></a>è§„å¾‹ä¸€è‡´æ€§æ£€æµ‹</h5><p>å¯¹äºå•å˜é‡ä¸”ç¦»æ•£æ•°æ®ï¼Œå¯ä»¥ç”¨ä»¥ä¸‹çš„æ–¹æ³•è¿›è¡Œç®€è¦åˆ¤æ–­</p>
<p>â€‹	åˆ¤æ–­trainè¡¨ä¸testè¡¨æ˜¯å¦å‡ºè‡ªåŒä¸€åˆ†å¸ƒ</p>
<pre><code class="language-python">train_count = train.shape[0]
test_count = test.shape[0]
features = [&#39;Pclass&#39;, &#39;Sex&#39;, &#39;Age&#39;, &#39;SibSp&#39;, &#39;Parch&#39;, &#39;Fare&#39;, &#39;Cabin&#39;, &#39;Embarked&#39;]

i = 1
plt.figure(figsize=(18, 18))
for feature in features:
    plt.subplot(3, 3, i)
    (train[feature].value_counts().sort_index()/train_count).plot()
    (test[feature].value_counts().sort_index()/test_count).plot()
    plt.legend([&#39;train&#39;, &#39;test&#39;])
    plt.xlabel(feature)
    plt.ylabel(&#39;radio&#39;)
    plt.show
    i+=1
</code></pre>
<p>åŒæ—¶è¿˜å¯ä»¥è¿›è¡Œå¤šå˜é‡è”åˆåˆ†å¸ƒ</p>
<p>æŒ‡çš„æ˜¯å°†ç¦»æ•£å˜é‡ä¸¤ä¸¤ç»„åˆï¼Œç„¶åæŸ¥çœ‹è¿™ä¸ªæ–°å˜é‡çš„ç›¸å¯¹å æ¯”åˆ†å¸ƒã€‚ä¾‹å¦‚ç‰¹å¾1æœ‰0&#x2F;1ä¸¤ä¸ªå–å€¼æ°´å¹³ï¼Œç‰¹å¾2æœ‰A&#x2F;Bä¸¤ä¸ªå–å€¼æ°´å¹³ï¼Œåˆ™è”åˆåˆ†å¸ƒä¸­å°±å°†å­˜åœ¨0Aã€0Bã€1Aã€1Bå››ç§ä¸åŒå–å€¼æ°´å¹³ï¼Œç„¶åè¿›ä¸€æ­¥æŸ¥çœ‹è¿™å››ç§ä¸åŒå–å€¼æ°´å¹³å‡ºç°çš„åˆ†å¸ƒæƒ…å†µã€‚</p>
<pre><code class="language-python">def combine_feature(df):
    cols = df.columns
    feature1 = df[cols[0]].astype(str).values.tolist()
    feature2 = df[cols[1]].astype(str).values.tolist()
    return pd.Series([feature1[i]+&#39;&amp;&#39;+feature2[i] for i in range(df.shape[0])])

cols = [features[0], features[1]]

# æŸ¥çœ‹åˆå¹¶åç»“æœ
train_com = combine_feature(train[cols])

train_dis = train_com.value_counts().sort_index()/train_count
test_dis = combine_feature(test[cols]).value_counts().sort_index()/test_count

# åˆ›å»ºæ–°çš„index
index_dis = pd.Series(train_dis.index.tolist() + test_dis.index.tolist()).drop_duplicates().sort_values()

# å¯¹ç¼ºå¤±å€¼å¡«è¡¥ä¸º0
(index_dis.map(train_dis).fillna(0)).plot()
(index_dis.map(train_dis).fillna(0)).plot()

# ç»˜å›¾
plt.legend([&#39;train&#39;,&#39;test&#39;])
plt.xlabel(&#39;&amp;&#39;.join(cols))
plt.ylabel(&#39;ratio&#39;)
plt.show()
</code></pre>
<h2 id="2-æ•°æ®é¢„å¤„ç†"><a href="#2-æ•°æ®é¢„å¤„ç†" class="headerlink" title="2. æ•°æ®é¢„å¤„ç†"></a>2. æ•°æ®é¢„å¤„ç†</h2><h3 id="ï¼ˆ1ï¼‰ç¼ºå¤±å€¼å¡«å……"><a href="#ï¼ˆ1ï¼‰ç¼ºå¤±å€¼å¡«å……" class="headerlink" title="ï¼ˆ1ï¼‰ç¼ºå¤±å€¼å¡«å……"></a>ï¼ˆ1ï¼‰ç¼ºå¤±å€¼å¡«å……</h3><p>åˆ†åˆ«ä¾æ®æƒ…å†µå°†ç¼ºå¤±å€¼å¡«å……ä¸ºå‡å€¼æˆ–ä¼—æ•°ï¼ˆå¯¹äºç¦»æ•£å‹æ•°æ®ï¼‰æˆ–å‰å‘åå‘å€¼ï¼ˆå¯¹äºè¿ç»­å‹æ•°æ®ï¼‰</p>
<pre><code class="language-python">data[col] = data[col].fillna(data[col].mean()/data[col].mode()[0])

data[col].ffill(inplcae=True)# å‰å‘å¡«å……
data[col].bfill(inplace=True)# åå‘å¡«å……
</code></pre>
<h3 id="ï¼ˆ2ï¼‰å°†objectç±»å‹è½¬æ¢ä¸ºå­—å…¸ç¼–ç "><a href="#ï¼ˆ2ï¼‰å°†objectç±»å‹è½¬æ¢ä¸ºå­—å…¸ç¼–ç " class="headerlink" title="ï¼ˆ2ï¼‰å°†objectç±»å‹è½¬æ¢ä¸ºå­—å…¸ç¼–ç "></a>ï¼ˆ2ï¼‰å°†objectç±»å‹è½¬æ¢ä¸ºå­—å…¸ç¼–ç </h3><p>data.info()æŸ¥çœ‹æ•°æ®ç±»å‹</p>
<pre><code class="language-python">def change_object_cols(se):
    # 1. è·å–è¯¥åˆ—çš„å”¯ä¸€å€¼ï¼Œå¹¶è½¬æˆåˆ—è¡¨
    value = se.unique().tolist()
    
    # 2. å¯¹å”¯ä¸€å€¼æ’åºï¼Œä¿è¯ç¼–ç çš„é¡ºåºå›ºå®šï¼ˆä»å°åˆ°å¤§ï¼‰
    value.sort()
    
    # 3. æ„é€ ä¸€ä¸ªæ˜ å°„è¡¨ï¼šå”¯ä¸€å€¼ â†’ æ•°å­—ç´¢å¼•
    #    ä¾‹å¦‚ï¼š[&#39;C&#39;, &#39;Q&#39;, &#39;S&#39;] â†’ &#123; &#39;C&#39;:0, &#39;Q&#39;:1, &#39;S&#39;:2 &#125;
    mapping = pd.Series(range(len(value)), index=value)
    
    # 4. å°†åŸå§‹åºåˆ— se æ˜ å°„æˆæ•°å€¼åºåˆ—
    return se.map(mapping).values


for col in cols:
    data[col] = change_object_cols(col)
</code></pre>
<h2 id="3-ç‰¹å¾å·¥ç¨‹"><a href="#3-ç‰¹å¾å·¥ç¨‹" class="headerlink" title="3. ç‰¹å¾å·¥ç¨‹"></a>3. ç‰¹å¾å·¥ç¨‹</h2><h3 id="ï¼ˆ1ï¼‰ç¡®å®šç¦»æ•£ã€è¿ç»­å˜é‡"><a href="#ï¼ˆ1ï¼‰ç¡®å®šç¦»æ•£ã€è¿ç»­å˜é‡" class="headerlink" title="ï¼ˆ1ï¼‰ç¡®å®šç¦»æ•£ã€è¿ç»­å˜é‡"></a>ï¼ˆ1ï¼‰ç¡®å®šç¦»æ•£ã€è¿ç»­å˜é‡</h3><p>è¿™æ˜¯ä¸ªå¾ˆå¥½çš„é—®é¢˜ ğŸ‘ã€‚åœ¨ Kaggle è¿™ç§å»ºæ¨¡æ¯”èµ›é‡Œï¼ŒåŒºåˆ† <strong>ç¦»æ•£å­—æ®µï¼ˆcategorical featuresï¼‰</strong> å’Œ <strong>è¿ç»­å­—æ®µï¼ˆnumerical featuresï¼‰</strong> æ˜¯ç‰¹å¾å·¥ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œç›´æ¥å½±å“åç»­çš„ç¼–ç æ–¹å¼ã€ç‰¹å¾è¡ç”Ÿã€æ¨¡å‹æ•ˆæœã€‚ä¸€èˆ¬çš„ç»éªŒå¦‚ä¸‹ï¼š</p>
<hr>
<ol>
<li><strong>ç¦»æ•£å­—æ®µï¼ˆCategorical Featuresï¼‰çš„åˆ¤å®š</strong></li>
</ol>
<p>å¸¸è§ç‰¹å¾ç±»å‹ï¼š</p>
<ul>
<li><strong>å­—ç¬¦ä¸²å‹</strong>ï¼šæ¯”å¦‚æ€§åˆ«ï¼ˆSexï¼‰ã€èŒä¸šï¼ˆjob_titleï¼‰ã€‚</li>
<li><strong>æ•´æ•°å‹ä½†å–å€¼æœ‰é™</strong>ï¼šä¾‹å¦‚èˆ±ä½ç­‰çº§ï¼ˆPclass: 1&#x2F;2&#x2F;3ï¼‰ã€æ˜ŸæœŸå‡ ï¼ˆ1â€“7ï¼‰ã€åœ°åŒºç¼–å·ã€‚</li>
<li><strong>IDç±»ç‰¹å¾</strong>ï¼šå¦‚ PassengerIdã€è®¢å•å·ï¼Œè™½ç„¶æ˜¯å­—ç¬¦ä¸²&#x2F;æ•°å­—ï¼Œä½†æ¯ä¸ªå–å€¼éƒ½å”¯ä¸€ â†’ é€šå¸¸ä¸¢å¼ƒæˆ–è½¬åŒ–ä¸ºè®¡æ•°ç‰¹å¾ã€‚</li>
</ul>
<p>ğŸ“Œ ç»éªŒï¼š</p>
<ul>
<li><strong>å”¯ä¸€å€¼æ•°é‡è¿œå°äºæ ·æœ¬æ•°</strong>ï¼ˆå¦‚å‡ ç§ç±»åˆ«ï¼Œè€Œä¸æ˜¯å‡ åƒä¸Šä¸‡ï¼‰ï¼ŒåŸºæœ¬éƒ½ç®—ç¦»æ•£å˜é‡ã€‚</li>
<li><strong>æ•´æ•°å‹å˜é‡</strong>è¦å°å¿ƒï¼Œæ¯”å¦‚é‚®ç¼–ã€ç¼–å·ï¼Œå®ƒä»¬è¡¨é¢æ˜¯æ•°å­—ï¼Œå…¶å®æ˜¯åˆ†ç±»ç‰¹å¾ã€‚</li>
<li><strong>é«˜åŸºæ•°ç‰¹å¾</strong>ï¼ˆç±»åˆ«æ•°å¤ªå¤šï¼‰ï¼š<ul>
<li>å¯ä»¥å°è¯• <strong>é¢‘ç‡ç¼–ç ï¼ˆfrequency encodingï¼‰</strong></li>
<li>æˆ– <strong>target encoding &#x2F; mean encoding</strong>ï¼ˆæ¯”èµ›é‡Œå¸¸ç”¨ï¼Œä½†è¦æ³¨æ„æ³„éœ²ï¼Œè¦äº¤å‰éªŒè¯ç¼–ç ï¼‰</li>
</ul>
</li>
</ul>
<hr>
<ol start="2">
<li><strong>è¿ç»­å­—æ®µï¼ˆNumerical Featuresï¼‰çš„åˆ¤å®š</strong></li>
</ol>
<p>å¸¸è§ç‰¹å¾ç±»å‹ï¼š</p>
<ul>
<li><strong>å®æ•°å‹</strong>ï¼šèº«é«˜ã€ä½“é‡ã€é‡‘é¢ã€æ—¶é—´å·®ã€‚</li>
<li><strong>å–å€¼èŒƒå›´å¤§ä¸”è¿‘ä¼¼è¿ç»­çš„æ•´æ•°</strong>ï¼šå¹´é¾„ï¼ˆ0â€“100ï¼‰ã€ä¹˜å®¢æ•°é‡ã€æˆ¿ä»·ã€‚</li>
</ul>
<p>ğŸ“Œ ç»éªŒï¼š</p>
<ul>
<li>æ•°å€¼çš„å¤§å° <strong>æœ‰é¡ºåºä¸”å·®å€¼æœ‰æ„ä¹‰</strong>ï¼ˆä¾‹å¦‚ä»·æ ¼ 100 å’Œ 200 ç›¸å·®ä¸€å€ï¼‰ â†’ è¿ç»­ç‰¹å¾ã€‚</li>
<li>å¯¹äºè¿™äº›ç‰¹å¾ï¼Œå¸¸ç”¨çš„å¤„ç†åŒ…æ‹¬ï¼š<ul>
<li>æ ‡å‡†åŒ–ï¼ˆStandardScalerï¼‰ã€å½’ä¸€åŒ–ï¼ˆMinMaxScalerï¼‰</li>
<li>åˆ†ç®±ï¼ˆbinningï¼‰ï¼Œè½¬åŒ–ä¸ºç±»åˆ« â†’ æé«˜æ ‘æ¨¡å‹ç¨³å®šæ€§</li>
</ul>
</li>
</ul>
<hr>
<ol start="3">
<li><strong>æ··åˆæƒ…å†µï¼ˆå®¹æ˜“è¯¯åˆ¤çš„å­—æ®µï¼‰</strong></li>
</ol>
<ul>
<li><strong>Ageï¼ˆå¹´é¾„ï¼‰</strong>ï¼šæ˜¯è¿ç»­çš„ï¼Œä½†å¯ä»¥å°è¯•åˆ†ç®±ï¼ˆå„¿ç«¥&#x2F;é’å¹´&#x2F;ä¸­å¹´&#x2F;è€å¹´ï¼‰ï¼Œå½“åšç¦»æ•£å˜é‡ã€‚</li>
<li><strong>Fareï¼ˆç¥¨ä»·ï¼‰</strong>ï¼šè¿ç»­å‹ï¼Œä½†åˆ†å¸ƒé€šå¸¸é•¿å°¾ï¼Œå¯ä»¥å¯¹æ•°åŒ–ï¼ˆlog transformï¼‰ã€‚</li>
<li><strong>Cabinï¼ˆèˆ¹èˆ±å·ï¼‰</strong>ï¼šåŸå§‹æ˜¯å­—ç¬¦ä¸²ï¼ˆç¦»æ•£ï¼‰ï¼Œä½†å¦‚æœåªå–é¦–å­—æ¯ï¼ˆA&#x2F;B&#x2F;C&#x2F;D&#x2F;E&#x2F;Fï¼‰ï¼Œç›¸å½“äºç±»åˆ«ã€‚</li>
</ul>
<p>ğŸ“Œ Kaggle å¸¸è§æŠ€å·§ï¼š</p>
<ul>
<li><strong>è¿ç»­å˜é‡ç¦»æ•£åŒ–</strong>ï¼ˆbinningï¼‰åæœ‰æ—¶æ¯”ç›´æ¥ç”¨æ•ˆæœæ›´å¥½ï¼Œå°¤å…¶åœ¨æ ‘æ¨¡å‹ä¸­ã€‚</li>
<li>åŒä¸€ä¸ªç‰¹å¾æ—¢ä¿ç•™åŸå§‹æ•°å€¼ï¼ŒåˆåŠ ä¸€ä¸ªåˆ†ç®±ç±»åˆ«ç‰¹å¾ï¼Œè®©æ¨¡å‹è‡ªå·±é€‰æ‹©ã€‚</li>
</ul>
<hr>
<ol start="4">
<li><strong>æ¯”èµ›ç»éªŒæ€»ç»“</strong></li>
</ol>
<ul>
<li><strong>EDAï¼ˆæ¢ç´¢æ€§æ•°æ®åˆ†æï¼‰ä¼˜å…ˆ</strong>ï¼šå…ˆç”¨ <code>describe()</code>ã€<code>value_counts()</code>ã€ç›´æ–¹å›¾ã€ç®±çº¿å›¾ï¼Œç›´è§‚åˆ¤æ–­åˆ†å¸ƒã€‚</li>
<li><strong>çœ‹å”¯ä¸€å€¼ä¸ªæ•°ï¼ˆnuniqueï¼‰</strong>ï¼š<ul>
<li>nunique â‰ª æ ·æœ¬æ•° â†’ å€¾å‘ç¦»æ•£</li>
<li>nunique â‰ˆ æ ·æœ¬æ•° â†’ å¯èƒ½æ˜¯ IDï¼Œç›´æ¥èˆå¼ƒæˆ–åš count encoding</li>
</ul>
</li>
<li><strong>æ ‘æ¨¡å‹ vs çº¿æ€§æ¨¡å‹çš„ä¸åŒ</strong>ï¼š<ul>
<li>æ ‘æ¨¡å‹ï¼ˆLightGBMã€XGBoostã€CatBoostï¼‰ï¼šä¸å¤ªæ€•ç¦»æ•£ç¼–ç ï¼ˆç”šè‡³ CatBoost å¯ä»¥ç›´æ¥å¤„ç†ç±»åˆ«ï¼‰ã€‚</li>
<li>çº¿æ€§æ¨¡å‹ã€ç¥ç»ç½‘ç»œï¼šæ›´ä¾èµ–æ ‡å‡†åŒ–å’Œ One-Hotã€‚</li>
</ul>
</li>
<li><strong>æ¯”èµ› Top é€‰æ‰‹ä¹ æƒ¯</strong>ï¼šåŒä¸€ä¸ªç‰¹å¾ä¼šåšå¤šç§å¤„ç†æ–¹å¼ï¼ˆåŸå§‹è¿ç»­ &#x2F; åˆ†ç®±ç±»åˆ« &#x2F; å¹³æ»‘ç¼–ç ï¼‰ï¼Œè®©æ¨¡å‹é€‰æ‹©ã€‚</li>
</ul>
<hr>
<p>âœ… <strong>ä¸€å¥è¯ç»éªŒ</strong>ï¼š</p>
<ul>
<li>â€œå€¼çš„å¤§å°æœ‰é¡ºåºå’Œé—´è·æ„ä¹‰ â†’ è¿ç»­ç‰¹å¾â€</li>
<li>â€œå€¼åªæ˜¯æ ‡ç­¾ã€æ²¡æœ‰æ•°å€¼å«ä¹‰ â†’ ç¦»æ•£ç‰¹å¾â€</li>
<li>æ¨¡å‹å‰æœŸï¼šå¤šåšå‡ ç§å¤„ç†æ–¹å¼ï¼ˆè¿ç»­ &#x2F; ç¦»æ•£åŒ– &#x2F; target encodingï¼‰ï¼Œäº¤ç»™æ¨¡å‹å’Œ CV å»ç­›é€‰ã€‚</li>
</ul>
<h3 id="ï¼ˆ2ï¼‰è¿ç»­å˜é‡å¤„ç†ï¼š"><a href="#ï¼ˆ2ï¼‰è¿ç»­å˜é‡å¤„ç†ï¼š" class="headerlink" title="ï¼ˆ2ï¼‰è¿ç»­å˜é‡å¤„ç†ï¼š"></a>ï¼ˆ2ï¼‰è¿ç»­å˜é‡å¤„ç†ï¼š</h3><h4 id="æ— ç©·å€¼å¤„ç†ï¼š"><a href="#æ— ç©·å€¼å¤„ç†ï¼š" class="headerlink" title="æ— ç©·å€¼å¤„ç†ï¼š"></a>æ— ç©·å€¼å¤„ç†ï¼š</h4><p>å¤©èŠ±æ¿ç›–å¸½æ³•ï¼šå³å°†infæ”¹ä¸ºæœ€å¤§çš„æ˜¾å¼æ•°å€¼</p>
<pre><code class="language-python">inf_cols = [&#39;avg_purchases_lag3&#39;, &#39;avg_purchases_lag6&#39;, &#39;avg_purchases_lag12&#39;]
merchant[inf_cols] = merchant[inf_cols].replace(np.inf, merchant[inf_cols].replace(np.inf, -99).max().max())
</code></pre>
<p>æ•´ä½“æµç¨‹</p>
<ol>
<li>æ‹¿åˆ°æ•°æ®åŠå…¶å¯¹åº”çš„è§£é‡Šï¼Œåˆ’åˆ†è¿ç»­å‹å­—æ®µä¸ç¦»æ•£å‹å­—æ®µï¼Œé‡ç‚¹å…³æ³¨objectç±»å‹ï¼Œæ˜¯å¦å­˜åœ¨æ—¶åºç±»å‹ã€æ–‡æœ¬ç±»å‹å­—æ®µ</li>
<li>æ­£ç¡®æ€§æ ¡éªŒï¼šæ˜¯å¦unique</li>
<li>ç‰¹å¾å˜åŒ–ï¼šè¿ç»­å˜é‡ï¼šè€ƒè™‘æ˜¯å¦å½’ä¸€åŒ–ã€åˆ†ç®±ï¼Œç¦»æ•£å‹å˜é‡ï¼šè€ƒè™‘æ˜¯å¦è¦ç‹¬çƒ­ç¼–ç ã€è‡ªç„¶æ•°ç¼–ç </li>
<li>è€ƒè™‘ç¼ºå¤±å€¼ï¼šï¼ˆ1ï¼‰numpy.NANï¼›ï¼ˆ2ï¼‰noneï¼›ï¼ˆ3ï¼‰ç‰¹æ®Šç¼ºå¤±å€¼ï¼šç©ºæ ¼ï¼ˆå¯èƒ½ä¼šè¢«è¯†åˆ«è½¬æ¢æˆå­—ç¬¦ä¸²ï¼‰â€”â€”&gt;ä¸šåŠ¡æ–¹é¢çš„åˆ¤æ–­ã€‚</li>
</ol>
<p>ç”¨å‡å€¼ã€ä¼—æ•°ã€é¢„æµ‹å€¼è¿›è¡Œå¡«å……ã€‚æˆ–è€…å¯ä»¥å…ˆç”¨ç‰¹æ®Šå­—ç¬¦ä»£è¡¨ï¼Œæ¯”å¦‚è¯´ç¦»æ•£æ€§æ•°æ®è¿›è¡Œç‹¬çƒ­ç¼–ç åå¯ä»¥ç”¨-1è¡¨ç¤ºç¼ºå¤±å€¼</p>
<ol start="5">
<li>å¼‚å¸¸å€¼åˆ†æï¼šè¯†åˆ«æ–¹å¼ï¼šï¼ˆ1ï¼‰ä¸‰å€æ ‡å‡†å·®ï¼ˆå¯¹äºè¶‹è¿‘äºæ ‡å‡†æ­£æ€åˆ†å¸ƒçš„æ•°æ®ï¼‰ã€ï¼ˆ2ï¼‰ç®±çº¿å›¾æ³•ï¼›å¤„ç†æ–¹æ³•ï¼šï¼ˆ1ï¼‰å¤©èŠ±æ¿ç›–å¸½æ³•ï¼›ï¼ˆ2ï¼‰å•ç‹¬è¯†åˆ«å¼‚å¸¸å€¼ä¸ºæŸä¸€ç±»</li>
</ol>
<p>ç‰¹å¾å·¥ç¨‹ï¼š</p>
<p>ï¼ˆ2ï¼‰æ ¹æ®ä¸šåŠ¡è¿›è¡Œæ‰©å±•ï¼šegï¼šé‡‘é¢è¿ç»­å‹â€”â€”&gt;å‡å€¼ã€æ€»é¢ã€æ–¹å·®ã€ååº¦ã€ç¦»æ•£å‹â€”â€”&gt;ä¼—æ•°â€¦</p>
<p>æ ¹æ®ä¸šåŠ¡å«ä¹‰åˆ’åˆ†ç¦»æ•£å­—æ®µcategory_colsä¸è¿ç»­å­—æ®µnumeric_colsã€‚</p>
<p>å¯¹éæ•°å€¼å‹çš„ç¦»æ•£å­—æ®µè¿›è¡Œå­—å…¸æ’åºç¼–ç ã€‚</p>
<p>ä¸ºäº†èƒ½å¤Ÿæ›´æ–¹ä¾¿ç»Ÿè®¡ï¼Œè¿›è¡Œç¼ºå¤±å€¼çš„å¤„ç†ï¼Œå¯¹ç¦»æ•£å­—æ®µç»Ÿä¸€ç”¨-1è¿›è¡Œå¡«å……ã€‚</p>
<p>å¯¹ç¦»æ•£å‹å­—æ®µæ¢æŸ¥å‘ç°æœ‰æ­£æ— ç©·å€¼ï¼Œè¿™æ˜¯ç‰¹å¾æå–ä»¥åŠæ¨¡å‹æ‰€ä¸èƒ½æ¥å—çš„ï¼Œå› æ­¤éœ€è¦å¯¹æ— é™å€¼è¿›è¡Œå¤„ç†ï¼Œæ­¤å¤„é‡‡ç”¨æœ€å¤§å€¼è¿›è¡Œæ›¿æ¢ã€‚</p>
<p>å»é™¤ä¸transactionäº¤æ˜“è®°å½•è¡¨æ ¼é‡å¤çš„åˆ—ï¼Œä»¥åŠmerchant_idçš„é‡å¤è®°å½•ã€‚</p>
<p>ç‰¹å¾å·¥ç¨‹</p>
<p>é€šè¿‡ç‰¹å¾å·¥ç¨‹æ–°å»ºäº†å¾ˆå¤šç‰¹å¾ï¼ŒåŒ…å«äº†ä¸€äº›å†—ä½™ã€ç¨€ç–ç‰¹å¾ï¼Œè™½ç„¶æœ€ç»ˆé€‰ç”¨æ ‘æ¨¡å‹æ—¶éƒ½å¯ä»¥ç­›é€‰å‡ºæœ€æœ‰æ•ˆçš„ç‰¹å¾ï¼Œä½†æ˜¯è¿‡å¤šçš„ç‰¹å¾ä¼šå½±å“åˆ°å»ºæ¨¡çš„æ•ˆç‡ã€‚å› æ­¤éœ€è¦æˆ‘ä»¬æå‰è¿›è¡Œç‰¹å¾ç­›é€‰ï¼Œæ ¹æ®ä¸æ ‡ç­¾ç›¸å…³æ€§åˆç­›å‡ºç‰¹å¾ã€‚</p>
<p>åˆç­›ï¼š<br>Filterç›¸å…³ç³»æ•°ç‰¹å¾ç­›é€‰æ–¹æ³•</p>
<p>ä½¿ç”¨corrï¼Œå¾—å‡ºå‰300ä¸ªç‰¹å¾</p>
<p>æ¨¡å‹è®­ç»ƒéœ€è¦ä¸è¶…å‚æ•°çš„é€‰å®šè¿‡ç¨‹ç»‘å®šåœ¨ä¸€èµ·ï¼ˆä½¿æ¨¡å‹å…·æœ‰ä¸€å®šçš„æ³›åŒ–èƒ½åŠ›ï¼‰</p>
<p><strong>Filter ç‰¹å¾ç­›é€‰</strong>ï¼šé€šè¿‡ç»Ÿè®¡æŒ‡æ ‡ï¼ˆç›¸å…³æ€§ã€å¡æ–¹æ£€éªŒã€äº’ä¿¡æ¯ç­‰ï¼‰å…ˆå¯¹åŸå§‹ç‰¹å¾è¿›è¡Œâ€œç²—ç­›â€ï¼Œå»æ‰æ˜æ˜¾æ— å…³æˆ–å†—ä½™çš„ç‰¹å¾ã€‚</p>
<p><strong>éšæœºæ£®æ—å»ºæ¨¡</strong>ï¼šç”¨ç­›é€‰åçš„ç‰¹å¾è®­ç»ƒä¸€ä¸ªéšæœºæ£®æ—æ¨¡å‹ï¼Œå¾—åˆ°åŸºå‡†æ€§èƒ½ã€‚</p>
<p><strong>ç½‘æ ¼æœç´¢è°ƒä¼˜</strong>ï¼šåœ¨ç­›é€‰åçš„ç‰¹å¾é›†ä¸Šï¼Œç”¨äº¤å‰éªŒè¯å’Œç½‘æ ¼æœç´¢å¯»æ‰¾éšæœºæ£®æ—çš„æœ€ä½³è¶…å‚æ•°ç»„åˆã€‚</p>
<p>Wrapperæ–¹æ³•</p>
<p><strong>Wrapper ç‰¹å¾ç­›é€‰</strong>ï¼šåˆ©ç”¨æ¨¡å‹æ€§èƒ½ä½œä¸ºè¯„ä»·æ ‡å‡†ï¼Œé€æ­¥é€‰æ‹©æˆ–å‰”é™¤ç‰¹å¾ï¼ˆä¾‹å¦‚é€’å½’ç‰¹å¾æ¶ˆé™¤ RFEï¼‰ã€‚</p>
<p><strong>LightGBM å»ºæ¨¡</strong>ï¼šç”¨ç­›é€‰å‡ºçš„ç‰¹å¾è®­ç»ƒ LightGBM æ¨¡å‹ï¼Œä½œä¸ºåŸºå‡†æ¨¡å‹ã€‚</p>
<p><strong>TPE è°ƒä¼˜</strong>ï¼šé€šè¿‡è´å¶æ–¯ä¼˜åŒ–ï¼ˆTPE ç®—æ³•ï¼‰é«˜æ•ˆæœç´¢ LightGBM çš„è¶…å‚æ•°ï¼Œæå‡æ€§èƒ½ã€‚</p>
<p>ä½¿ç”¨tpeè°ƒä¼˜å‰ï¼Œæœ€å¥½å…ˆç”¨warpperæ–¹æ³•è®­ç»ƒä¸€æ¬¡lgbå…ˆ</p>
<p><strong>Voting æ˜¯ä¸€ç§å›ºå®šè§„åˆ™çš„é›†æˆæ–¹æ³•ï¼Œé€šè¿‡å¯¹å¤šä¸ªåŸºæ¨¡å‹çš„é¢„æµ‹ç»“æœç›´æ¥åšå¤šæ•°æŠ•ç¥¨ï¼ˆåˆ†ç±»ï¼‰æˆ–å¹³å‡ï¼ˆå›å½’ï¼‰æ¥å¾—åˆ°æœ€ç»ˆè¾“å‡ºï¼›è€Œ Stacking åˆ™æ˜¯æ›´çµæ´»çš„å †å æ–¹æ³•ï¼Œå®ƒæŠŠå¤šä¸ªåŸºæ¨¡å‹çš„é¢„æµ‹ç»“æœä½œä¸ºæ–°çš„ç‰¹å¾ï¼Œå†è®­ç»ƒä¸€ä¸ªâ€œå…ƒå­¦ä¹ å™¨â€å»è‡ªåŠ¨å­¦ä¹ æœ€ä¼˜çš„åŠ æƒç»„åˆæ–¹å¼ï¼Œä»è€Œé€šå¸¸èƒ½æ¯”ç®€å•æŠ•ç¥¨è·å¾—æ›´å¼ºçš„æ³›åŒ–æ€§èƒ½ã€‚</strong></p>
<p>Stackingæµç¨‹ï¼šåœ¨ç¬¬ä¸€å±‚è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€ä¸ªåŸºæ¨¡å‹ç»è¿‡5æŠ˜äº¤å‰éªŒè¯åä¼šå¾—åˆ°5ä¸ªè®­ç»ƒé›†ä¸Šç»“æœæ‹¼æ¥æˆçš„éªŒè¯é›†ç»“æœï¼Œä»¥åŠ5ä¸ªæµ‹è¯•é›†ä¸Šçš„ç»“æœå¹³å‡åçš„æ€»æµ‹è¯•é›†ç»“æœï¼Œä¹‹ååœ¨ç¬¬äºŒå±‚å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰åŸºæ¨¡å‹çš„éªŒè¯é›†ç»“æœä½œä¸ºè®­ç»ƒçš„xï¼Œç›®æ ‡æ˜¯çœŸå®æ ‡ç­¾yï¼Œç„¶åå­¦ä¹ xçš„æƒé‡å‚æ•°aï¼Œæœ€ç»ˆå¯¹æ‰€æœ‰åŸºæ¨¡å‹çš„æ€»æµ‹è¯•é›†ç»“æœåº”ç”¨å­¦ä¹ å®Œæ¯•çš„æƒé‡aè¿›è¡Œç»„åˆå¾—åˆ°æœ€ç»ˆç»“æœ</p>
<hr>
<h4 id="ğŸ”¹-ç¬¬ä¸€å±‚ï¼ˆåŸºæ¨¡å‹è®­ç»ƒï¼‰"><a href="#ğŸ”¹-ç¬¬ä¸€å±‚ï¼ˆåŸºæ¨¡å‹è®­ç»ƒï¼‰" class="headerlink" title="ğŸ”¹ ç¬¬ä¸€å±‚ï¼ˆåŸºæ¨¡å‹è®­ç»ƒï¼‰"></a>ğŸ”¹ ç¬¬ä¸€å±‚ï¼ˆåŸºæ¨¡å‹è®­ç»ƒï¼‰</h4><ul>
<li>æ¯ä¸ªåŸºæ¨¡å‹åš <strong>5 æŠ˜äº¤å‰éªŒè¯</strong>ï¼š<ul>
<li><strong>è®­ç»ƒé›† OOF é¢„æµ‹</strong>ï¼šæ¯ä¸€æŠ˜çš„éªŒè¯é›†é¢„æµ‹æ‹¼æ¥ â†’ å¾—åˆ°å®Œæ•´çš„ OOF é¢„æµ‹ç»“æœï¼ˆå¯¹åº”è®­ç»ƒé›†æ‰€æœ‰æ ·æœ¬ï¼‰ã€‚</li>
<li><strong>æµ‹è¯•é›†é¢„æµ‹</strong>ï¼šæ¯ä¸€æŠ˜åœ¨è®­ç»ƒå®Œæ¯•åå¯¹æµ‹è¯•é›†é¢„æµ‹ â†’ 5 æ¬¡é¢„æµ‹ç»“æœå–å¹³å‡ï¼Œå¾—åˆ°è¯¥åŸºæ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„æœ€ç»ˆé¢„æµ‹ã€‚</li>
</ul>
</li>
</ul>
<p>ğŸ‘‰ è¾“å‡ºï¼š</p>
<ul>
<li><code>OOF_i</code>ï¼šåŸºæ¨¡å‹ i çš„è®­ç»ƒé›†é¢„æµ‹ï¼ˆn è¡Œ 1 åˆ—ï¼‰ã€‚</li>
<li><code>Test_i</code>ï¼šåŸºæ¨¡å‹ i çš„æµ‹è¯•é›†é¢„æµ‹ï¼ˆm è¡Œ 1 åˆ—ï¼‰ã€‚</li>
</ul>
<hr>
<h4 id="ğŸ”¹-ç¬¬äºŒå±‚ï¼ˆå…ƒå­¦ä¹ å™¨ï¼‰"><a href="#ğŸ”¹-ç¬¬äºŒå±‚ï¼ˆå…ƒå­¦ä¹ å™¨ï¼‰" class="headerlink" title="ğŸ”¹ ç¬¬äºŒå±‚ï¼ˆå…ƒå­¦ä¹ å™¨ï¼‰"></a>ğŸ”¹ ç¬¬äºŒå±‚ï¼ˆå…ƒå­¦ä¹ å™¨ï¼‰</h4><ul>
<li><p><strong>è¾“å…¥ç‰¹å¾ X</strong>ï¼šæ‰€æœ‰åŸºæ¨¡å‹çš„ OOF æ‹¼æ¥ â†’ ç»´åº¦ <code>(n, k)</code>ï¼Œk ä¸ºåŸºæ¨¡å‹æ•°é‡ã€‚</p>
</li>
<li><p><strong>ç›®æ ‡ y</strong>ï¼šçœŸå®æ ‡ç­¾ï¼ˆn è¡Œ 1 åˆ—ï¼‰ã€‚</p>
</li>
<li><p><strong>è®­ç»ƒ</strong>ï¼šç”¨è´å¶æ–¯å²­å›å½’ï¼ˆæˆ–åˆ«çš„æ¨¡å‹ï¼‰å­¦ä¹ ä¸€ä¸ªå‡½æ•°ï¼š</p>
<p>y^&#x3D;a1â‹…OOF1+a2â‹…OOF2+â‹¯+akâ‹…OOFk+b\hat{y} &#x3D; a_1 \cdot OOF_1 + a_2 \cdot OOF_2 + \dots + a_k \cdot OOF_k + b</p>
</li>
</ul>
<p>ğŸ‘‰ å…ƒå­¦ä¹ å™¨æœ¬è´¨ä¸Šæ˜¯åœ¨å­¦ä¹ ä¸€ç»„ <strong>æƒé‡å‚æ•° a</strong>ï¼Œå‘Šè¯‰æˆ‘ä»¬â€œæ¯ä¸ªåŸºæ¨¡å‹åœ¨æœ€ç»ˆé¢„æµ‹ä¸­è¯¥å å¤šå¤§æ¯”é‡â€ã€‚</p>
<hr>
<h4 id="ğŸ”¹-æœ€ç»ˆé¢„æµ‹"><a href="#ğŸ”¹-æœ€ç»ˆé¢„æµ‹" class="headerlink" title="ğŸ”¹ æœ€ç»ˆé¢„æµ‹"></a>ğŸ”¹ æœ€ç»ˆé¢„æµ‹</h4><ul>
<li><p>æŠŠå­¦ä¹ åˆ°çš„æƒé‡ a åº”ç”¨åˆ°æµ‹è¯•é›†çš„é¢„æµ‹ï¼š</p>
<p>y^test&#x3D;a1â‹…Test1+a2â‹…Test2+â‹¯+akâ‹…Testk+b\hat{y}_{test} &#x3D; a_1 \cdot Test_1 + a_2 \cdot Test_2 + \dots + a_k \cdot Test_k + b</p>
</li>
</ul>
<p>ğŸ‘‰ æœ€ç»ˆç»“æœå°±æ˜¯ <strong>æµ‹è¯•é›†ä¸Šå„åŸºæ¨¡å‹é¢„æµ‹ç»“æœçš„åŠ æƒç»„åˆ</strong>ã€‚</p>
<p>äº¤å‰éªŒè¯ï¼ˆCross Validationï¼Œç®€ç§° CVï¼‰æ˜¯ä¸€ç§å¸¸ç”¨çš„æ¨¡å‹è¯„ä¼°æ–¹æ³•ï¼Œç”¨æ¥æ£€éªŒæœºå™¨å­¦ä¹ æ¨¡å‹åœ¨<strong>æœªè§è¿‡çš„æ•°æ®ä¸Šçš„æ³›åŒ–èƒ½åŠ›</strong>ã€‚å®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæŠŠå·²æœ‰çš„æ•°æ®é›†åˆ’åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œè½®æµç”¨å…¶ä¸­ä¸€éƒ¨åˆ†åšéªŒè¯é›†ï¼Œå‰©ä½™éƒ¨åˆ†åšè®­ç»ƒé›†ï¼Œæœ€ç»ˆç»¼åˆè¯„ä¼°ç»“æœã€‚</p>
<hr>
<h4 id="ä¸ºä»€ä¹ˆéœ€è¦äº¤å‰éªŒè¯ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦äº¤å‰éªŒè¯ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦äº¤å‰éªŒè¯ï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦äº¤å‰éªŒè¯ï¼Ÿ</h4><p>å¦‚æœåªç”¨ä¸€æ¬¡<strong>è®­ç»ƒé›† &#x2F; æµ‹è¯•é›†åˆ’åˆ†</strong>æ¥è¯„ä¼°æ¨¡å‹ï¼Œç»“æœå¯èƒ½ä¼šå—åˆ°åˆ’åˆ†æ–¹å¼çš„å¶ç„¶æ€§å½±å“ï¼ˆæ¯”å¦‚æŸæ¬¡åˆ’åˆ†åˆšå¥½æµ‹è¯•é›†æ¯”è¾ƒéš¾ï¼‰ã€‚äº¤å‰éªŒè¯é€šè¿‡å¤šæ¬¡åˆ’åˆ†å¹¶å–å¹³å‡ï¼Œå¯ä»¥æ›´ç¨³å®šåœ°åæ˜ æ¨¡å‹çš„çœŸå®æ€§èƒ½ã€‚</p>
<hr>
<h4 id="å¸¸è§çš„äº¤å‰éªŒè¯æ–¹æ³•"><a href="#å¸¸è§çš„äº¤å‰éªŒè¯æ–¹æ³•" class="headerlink" title="å¸¸è§çš„äº¤å‰éªŒè¯æ–¹æ³•"></a>å¸¸è§çš„äº¤å‰éªŒè¯æ–¹æ³•</h4><ol>
<li><strong>k æŠ˜äº¤å‰éªŒè¯ï¼ˆk-Fold CVï¼‰</strong><ul>
<li>å°†æ•°æ®é›†å¹³å‡åˆ†æˆ k ä»½ã€‚</li>
<li>æ¯æ¬¡ç”¨å…¶ä¸­ 1 ä»½ä½œä¸ºéªŒè¯é›†ï¼Œå‰©ä¸‹ k-1 ä»½ä½œä¸ºè®­ç»ƒé›†ã€‚</li>
<li>é‡å¤ k æ¬¡ï¼Œå¾—åˆ° k ä¸ªç»“æœï¼Œå–å¹³å‡å€¼ä½œä¸ºæœ€ç»ˆæ€§èƒ½ã€‚</li>
<li>å¸¸è§é€‰æ‹©ï¼šk &#x3D; 5 æˆ– 10ã€‚</li>
</ul>
</li>
<li><strong>ç•™ä¸€äº¤å‰éªŒè¯ï¼ˆLOOCV, Leave-One-Out CVï¼‰</strong><ul>
<li>ç‰¹æ®Šæƒ…å†µï¼šk ç­‰äºæ ·æœ¬æ•°ã€‚</li>
<li>æ¯æ¬¡åªç•™ 1 ä¸ªæ ·æœ¬åšéªŒè¯ï¼Œå…¶ä½™ä½œä¸ºè®­ç»ƒã€‚</li>
<li>è®¡ç®—é‡å¤§ï¼Œä½†å¯¹å°æ ·æœ¬æ•°æ®å¾ˆæœ‰ç”¨ã€‚</li>
</ul>
</li>
<li><strong>åˆ†å±‚äº¤å‰éªŒè¯ï¼ˆStratified k-Fold CVï¼‰</strong><ul>
<li>ç”¨äºåˆ†ç±»é—®é¢˜ã€‚</li>
<li>ä¿è¯æ¯æŠ˜ä¸­çš„ç±»åˆ«æ¯”ä¾‹ä¸æ•´ä½“æ•°æ®é›†ä¸€è‡´ï¼Œé¿å…æŸäº›ç±»åˆ«åœ¨æŸæŠ˜ä¸­æ¶ˆå¤±ã€‚</li>
</ul>
</li>
<li><strong>é‡å¤äº¤å‰éªŒè¯ï¼ˆRepeated k-Fold CVï¼‰</strong><ul>
<li>åœ¨ k æŠ˜äº¤å‰éªŒè¯çš„åŸºç¡€ä¸Šï¼Œé‡å¤å¤šæ¬¡ï¼ˆæ¯æ¬¡éšæœºåˆ’åˆ†ï¼‰ã€‚</li>
<li>å¯ä»¥è¿›ä¸€æ­¥é™ä½åˆ’åˆ†çš„å¶ç„¶æ€§ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h4 id="äº¤å‰éªŒè¯çš„ä¼˜ç‚¹"><a href="#äº¤å‰éªŒè¯çš„ä¼˜ç‚¹" class="headerlink" title="äº¤å‰éªŒè¯çš„ä¼˜ç‚¹"></a>äº¤å‰éªŒè¯çš„ä¼˜ç‚¹</h4><ul>
<li>æ›´ç¨³å®šå’Œå¯é çš„æ€§èƒ½ä¼°è®¡ã€‚</li>
<li>é¿å…å•æ¬¡åˆ’åˆ†å¯èƒ½é€ æˆçš„é«˜ä¼°æˆ–ä½ä¼°ã€‚</li>
<li>åœ¨æ ·æœ¬è¾ƒå°‘æ—¶èƒ½æ›´å……åˆ†åˆ©ç”¨æ•°æ®ã€‚</li>
</ul>
<hr>
<h4 id="ä¸¾ä¸ªä¾‹å­"><a href="#ä¸¾ä¸ªä¾‹å­" class="headerlink" title="ä¸¾ä¸ªä¾‹å­"></a>ä¸¾ä¸ªä¾‹å­</h4><p>å‡è®¾æœ‰ 100 æ¡æ•°æ®ï¼Œé‡‡ç”¨ <strong>5 æŠ˜äº¤å‰éªŒè¯</strong>ï¼š</p>
<ul>
<li>ç¬¬ä¸€æ¬¡ï¼šç¬¬ 1â€“20 æ¡åšéªŒè¯ï¼Œ21â€“100 æ¡åšè®­ç»ƒã€‚</li>
<li>ç¬¬äºŒæ¬¡ï¼šç¬¬ 21â€“40 æ¡åšéªŒè¯ï¼Œå…¶ä»–åšè®­ç»ƒã€‚</li>
<li>â€¦ä¾æ­¤ç±»æ¨ï¼Œæ€»å…± 5 æ¬¡ã€‚<br> æœ€åå– 5 æ¬¡éªŒè¯ç»“æœçš„å¹³å‡ä½œä¸ºæ¨¡å‹æœ€ç»ˆå¾—åˆ†ã€‚</li>
</ul>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1/" style="color: #00bcd4">æ•°æ®å»ºæ¨¡</a>
        </span>
        
    </div>
    <a href="/2021/12/13/%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2021/11/15/%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%E6%9C%AF%E8%AF%AD/">
        <h2 class="post-title">ç»Ÿè®¡åˆ†ææœ¯è¯­</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                ç»Ÿè®¡åˆ†æ
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2021/11/15
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="ç»Ÿè®¡åˆ†ææœ¯è¯­"><a href="#ç»Ÿè®¡åˆ†ææœ¯è¯­" class="headerlink" title="ç»Ÿè®¡åˆ†ææœ¯è¯­"></a>ç»Ÿè®¡åˆ†ææœ¯è¯­</h2><ol>
<li>äºŒåˆ†ä½æ•°</li>
<li>ç¬¬ä¸€å››åˆ†ä½æ•°</li>
</ol>
<hr>
<p><strong>ç®±å‹å›¾è§£è¯»è¦ç‚¹</strong></p>
<ol>
<li><strong>å¼‚å¸¸å€¼</strong><ul>
<li>å¦‚æœæ•°æ®å­˜åœ¨ç¦»ç¾¤ç‚¹ï¼ˆè¶…å‡º [Q1âˆ’1.5â‹…IQR,Q3+1.5â‹…IQR][Q1-1.5Â·IQR, Q3+1.5Â·IQR] çš„èŒƒå›´ï¼‰ï¼Œä¼šåœ¨ç®±å‹å›¾å¤–ä»¥åœ†ç‚¹æˆ–æ˜Ÿå·æ ‡æ³¨ã€‚</li>
</ul>
</li>
<li><strong>ç®±ä½“é«˜åº¦ï¼ˆIQR &#x3D; Q3 â€“ Q1ï¼‰</strong><ul>
<li><strong>ç®±å­å¾ˆçŸ­</strong>ï¼šæ•°æ®é«˜åº¦é›†ä¸­ï¼Œåˆ†å¸ƒè¾ƒå‡åŒ€ã€‚</li>
<li><strong>ç®±å­å¾ˆé•¿</strong>ï¼šæ•°æ®åˆ†å¸ƒç¦»æ•£ï¼Œå·®å¼‚è¾ƒå¤§ã€‚</li>
</ul>
</li>
<li><strong>ä¸­ä½æ•°ä½ç½®</strong><ul>
<li><strong>ä¸­ä½æ•°æ¥è¿‘ç®±ä½“åº•éƒ¨ï¼ˆQ1ï¼‰</strong>ï¼šè¯´æ˜æ•°æ®åå¤§ï¼ˆå³åï¼Œé•¿å°¾åœ¨é«˜å€¼æ–¹å‘ï¼‰ã€‚</li>
<li><strong>ä¸­ä½æ•°æ¥è¿‘ç®±ä½“é¡¶éƒ¨ï¼ˆQ3ï¼‰</strong>ï¼šè¯´æ˜æ•°æ®åå°ï¼ˆå·¦åï¼Œé•¿å°¾åœ¨ä½å€¼æ–¹å‘ï¼‰ã€‚</li>
<li>ä¸­ä½æ•°æ˜¯å¦å±…ä¸­ï¼Œå¯ä»¥åæ˜ æ•°æ®çš„ <strong>åæ–œç¨‹åº¦</strong>ã€‚</li>
</ul>
</li>
<li><strong>ä¸Šä¸‹é¡»ï¼ˆWhiskersï¼‰é•¿åº¦</strong><ul>
<li>é¡»æ¯”è¾ƒé•¿ï¼šè¯´æ˜å››åˆ†ä½æ•°ä¹‹å¤–çš„æ•°æ®å·®å¼‚è¾ƒå¤§ â†’ <strong>æ–¹å·®ã€æ ‡å‡†å·®å¤§</strong>ã€‚</li>
<li>é¡»æ¯”è¾ƒçŸ­ï¼šè¯´æ˜å››åˆ†ä½æ•°ä¹‹å¤–çš„æ•°æ®è¾ƒé›†ä¸­ã€‚</li>
</ul>
</li>
<li><strong>ç®±å‹å›¾çš„è¾¹ç¼˜å¹¶ä¸æ˜¯æå€¼</strong><ul>
<li>ç®±ä½“çš„è¾¹ç¼˜æ˜¯ <strong>Q1ã€Q3</strong>ï¼Œè€Œä¸æ˜¯æœ€å°å€¼ã€æœ€å¤§å€¼ã€‚</li>
<li>é¡»çš„ç»ˆç‚¹æ‰æ¥è¿‘â€œæœ€å¤§å€¼&#x2F;æœ€å°å€¼â€ï¼Œä½†ä»å¯èƒ½ä¸æ˜¯æå€¼ï¼ˆå› ä¸ºé¡»é•¿åº¦æœ‰é™åˆ¶ï¼‰ã€‚</li>
</ul>
</li>
</ol>
<hr>
<p>ğŸ“Œ <strong>ä¸€å¥è¯è®°å¿†</strong>ï¼š</p>
<ul>
<li><strong>ç®±å­ &#x3D; ä¸­å¿ƒ 50% æ•°æ®</strong>ï¼Œ</li>
<li><strong>çº¿ï¼ˆé¡»ï¼‰ &#x3D; æ›´å¹¿çš„åˆ†å¸ƒèŒƒå›´</strong>ï¼Œ</li>
<li><strong>ç‚¹ &#x3D; å¼‚å¸¸å€¼</strong>ï¼Œ</li>
<li><strong>ä¸­ä½æ•°ä½ç½® &#x3D; åæ–œæ–¹å‘</strong>ã€‚</li>
</ul>
<ol>
<li>å‡è®¾æ£€éªŒ</li>
<li>æ˜¾è‘—æ€§æ°´å¹³ï¼šå½“åŸå‡è®¾ä¸ºçœŸæ—¶ï¼Œæ‹’ç»åŸå‡è®¾çš„æ¦‚ç‡</li>
<li>åŠŸæ•ˆï¼šå½“åŸå‡è®¾ä¸ºå‡æ—¶ï¼Œèƒ½æ£€æµ‹å‡ºè¿™ç§é”™è¯¯å¹¶å¾—å‡ºæ­£ç¡®ç»“è®ºçš„æ¦‚ç‡</li>
<li>ç½®ä¿¡åŒºé—´ï¼šç”¨æ¥ä¼°è®¡æ€»ä½“å‚æ•°å¯èƒ½èŒƒå›´çš„ä¸€ä¸ªåŒºé—´ï¼Œåæ˜ äº†æˆ‘ä»¬å¯¹æ€»ä½“å‚æ•°ä¼°è®¡çš„ä¿¡ä»»åº¦</li>
<li>på€¼ï¼šå‡ºç°æç«¯æƒ…å†µçš„æ¦‚ç‡ï¼Œå½“åŸå‡è®¾ä¸ºçœŸæ—¶ï¼Œå‡ºç°æ¯”å½“å‰æŠ½æ ·åˆ†å¸ƒæ›´åŠ æç«¯çš„æƒ…å†µçš„æ¦‚ç‡</li>
<li>pä¸$\alpha$çš„å…³ç³»ï¼špå°äºaï¼Œåˆ™å°æ¦‚ç‡äº‹ä»¶å‘ç”Ÿï¼Œåˆ™æ‹’ç»H0</li>
<li>ä¸€ç±»é”™è¯¯ï¼šå½“é›¶å‡è®¾ä¸ºçœŸæ—¶ï¼Œæ‹’ç»</li>
<li>äºŒç±»é”™è¯¯ï¼šå½“é›¶å‡è®¾ä¸ºå‡æ—¶ï¼Œæ¥å—</li>
<li>åŸå‡è®¾ä¸å¤‡æ‹©å‡è®¾</li>
<li>ä¸­å¿ƒæé™å®šç†</li>
<li>å¤§æ•°å®šç†ï¼šéšç€è¯•éªŒæ¬¡æ•°çš„å¢åŠ ï¼Œæ ·æœ¬å¹³å‡å€¼è¶‹è¿‘æ€»ä½“çš„æœŸæœ›å€¼</li>
<li>å¡æ–¹æ£€éªŒï¼šåˆ†æå˜é‡ä¹‹é—´æ˜¯å¦ç‹¬ç«‹</li>
<li>æ–¹å·®åˆ†æï¼šæ¯”è¾ƒä¸‰ä¸ªæˆ–æ›´å¤šçš„å‡å€¼æ˜¯å¦å·®å¼‚</li>
<li>zæ£€éªŒé€‚ç”¨äºå¤§æ ·æœ¬ï¼Œæ€»ä½“æ–¹å·®å·²çŸ¥</li>
<li>tæ£€éªŒé€‚ç”¨äºå°æ ·æœ¬ï¼Œæ€»ä½“æ–¹å·®æœªçŸ¥</li>
<li>æœ€å¤§ä¼¼ç„¶ä¼°è®¡</li>
<li>æœ€å°äºŒä¹˜ä¼°è®¡</li>
<li>äº¤å‰éªŒè¯</li>
</ol>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90/" style="color: #ffa2c4">ç»Ÿè®¡åˆ†æ</a>
        </span>
        
    </div>
    <a href="/2021/11/15/%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90%E6%9C%AF%E8%AF%AD/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2021/09/09/Leetcode%20%20sql%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%952/">
        <h2 class="post-title">Leetcode sqlé¢˜ç›®è®°å½•2</h2>
    </a>
    <div class="category-and-date">
        
        <span class="category">
            <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                æ•°æ®åº“
            </a>
        </span>
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2021/9/9
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="Leetcode-sqlé¢˜ç›®è®°å½•2"><a href="#Leetcode-sqlé¢˜ç›®è®°å½•2" class="headerlink" title="Leetcode  sqlé¢˜ç›®è®°å½•2"></a>Leetcode  sqlé¢˜ç›®è®°å½•2</h2><p>æœ¬åšå®¢ä»…è®°å½•**é«˜é¢‘ SQL 50 é¢˜ï¼ˆè¿›é˜¶ç‰ˆï¼‰**ä¸­çš„ä¸­ç­‰éš¾åº¦é¢˜ç›®ï¼Œåç»­ä¸å®šæœŸæ›´æ–°</p>
<h3 id="1398-è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢"><a href="#1398-è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢" class="headerlink" title="1398.è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢"></a>1398.è´­ä¹°äº†äº§å“Aå’Œäº§å“Bå´æ²¡æœ‰è´­ä¹°äº§å“Cçš„é¡¾å®¢</h3><p> <code>Customers</code> è¡¨ï¼š</p>
<pre><code>+---------------------+---------+
| Column Name         | Type    |
+---------------------+---------+
| customer_id         | int     |
| customer_name       | varchar |
+---------------------+---------+
customer_id æ˜¯è¿™å¼ è¡¨ä¸­å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
customer_name æ˜¯é¡¾å®¢çš„åç§°ã€‚
</code></pre>
<p><code>Orders</code> è¡¨ï¼š</p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| order_id      | int     |
| customer_id   | int     |
| product_name  | varchar |
+---------------+---------+
order_id æ˜¯è¿™å¼ è¡¨ä¸­å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
customer_id æ˜¯è´­ä¹°äº†åä¸º &quot;product_name&quot; äº§å“é¡¾å®¢çš„idã€‚
</code></pre>
<p>è¯·ä½ ç¼–å†™è§£å†³æ–¹æ¡ˆï¼ŒæŠ¥å‘Šè´­ä¹°äº†äº§å“ <strong>â€œAâ€</strong>ï¼Œ<strong>â€œBâ€</strong> ä½†æ²¡æœ‰è´­ä¹°äº§å“ <strong>â€œCâ€</strong> çš„å®¢æˆ·çš„ customer_id å’Œ customer_nameï¼Œå› ä¸ºæˆ‘ä»¬æƒ³æ¨èä»–ä»¬è´­ä¹°è¿™æ ·çš„äº§å“ã€‚</p>
<p>è¿”å›æŒ‰ <code>customer_id</code> <strong>æ’åº</strong> çš„ç»“æœè¡¨ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Customers table:
+-------------+---------------+
| customer_id | customer_name |
+-------------+---------------+
| 1           | Daniel        |
| 2           | Diana         |
| 3           | Elizabeth     |
| 4           | Jhon          |
+-------------+---------------+

Orders table:
+------------+--------------+---------------+
| order_id   | customer_id  | product_name  |
+------------+--------------+---------------+
| 10         |     1        |     A         |
| 20         |     1        |     B         |
| 30         |     1        |     D         |
| 40         |     1        |     C         |
| 50         |     2        |     A         |
| 60         |     3        |     A         |
| 70         |     3        |     B         |
| 80         |     3        |     D         |
| 90         |     4        |     C         |
+------------+--------------+---------------+
è¾“å‡ºï¼š
+-------------+---------------+
| customer_id | customer_name |
+-------------+---------------+
| 3           | Elizabeth     |
+-------------+---------------+
è§£é‡Šï¼š
åªæœ‰ customer_id ä¸º 3 çš„é¡¾å®¢è´­ä¹°äº†äº§å“ A å’Œäº§å“ B ï¼Œå´æ²¡æœ‰è´­ä¹°äº§å“ C ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<p><strong>ï¼ˆ1ï¼‰æœ€åŸºç¡€è§£æ³•ï¼Œé€ä¸€å­æŸ¥è¯¢</strong></p>
<pre><code class="language-sql">SELECT c.customer_id, c.customer_name
FROM Customers c
WHERE EXISTS (
    SELECT 1 FROM Orders o WHERE o.customer_id = c.customer_id AND o.product_name = &#39;A&#39;
)
AND EXISTS (
    SELECT 1 FROM Orders o WHERE o.customer_id = c.customer_id AND o.product_name = &#39;B&#39;
)
AND NOT EXISTS (
    SELECT 1 FROM Orders o WHERE o.customer_id = c.customer_id AND o.product_name = &#39;C&#39;
);
</code></pre>
<p>æ³¨æ„ï¼šåœ¨åˆ¤æ–­æŸåˆ—ä¸åœ¨æŸä¸ªå­æŸ¥è¯¢çš„ç»“æœåˆ—è¡¨é‡Œæ—¶ï¼Œå¦‚æœå­æŸ¥è¯¢é‡Œæœ‰nullå€¼ï¼Œåˆ™not inä¼šè¿”å›ç©ºã€‚å› æ­¤éœ€è¦ç”¨not existsã€‚</p>
<p>å½“ <code>NOT IN</code> æ‹†æˆå¤šä¸ªæ¯”è¾ƒåï¼Œå¦‚æœå…¶ä¸­æœ‰ä¸€ä¸ªæ¡ä»¶è¿”å› <code>UNKNOWN</code>ï¼Œæ•´ä¸ª AND ç»“æœå°±ä¸æ˜¯ <code>TRUE</code>ï¼Œè€Œæ˜¯ <strong>UNKNOWN</strong>ï¼Œæœ€ç»ˆè¿™æ¡è®°å½•å°±è¢«è¿‡æ»¤æ‰ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<ul>
<li><code>col1 = 10</code><br> æ£€æŸ¥ <code>10 &lt;&gt; 5</code> â†’ TRUE<br> æ£€æŸ¥ <code>10 &lt;&gt; NULL</code> â†’ UNKNOWN<br> <code>TRUE AND UNKNOWN</code> â†’ UNKNOWN â†’ ä¸è¿”å›</li>
</ul>
<p>æ‰€ä»¥åªè¦å­æŸ¥è¯¢é‡Œæœ‰ <code>NULL</code>ï¼Œæ‰€æœ‰å¤–å±‚è¡Œéƒ½ä¼šå› ä¸ºé‡åˆ° <code>UNKNOWN</code> è¢«æ’é™¤æ‰ï¼Œç»“æœå°±æ˜¯ç©ºé›†</p>
<p><strong>ï¼ˆ2ï¼‰ä¸€æ¬¡æ‰« Orders åšæ¡ä»¶èšåˆï¼Œå†è·Ÿ Customers å…³è”</strong></p>
<pre><code class="language-sql">SELECT c.customer_id, c.customer_name
FROM Customers c
JOIN Orders o ON o.customer_id = c.customer_id
GROUP BY c.customer_id, c.customer_name
HAVING SUM(o.product_name = &#39;A&#39;) &gt; 0
   AND SUM(o.product_name = &#39;B&#39;) &gt; 0
   AND SUM(o.product_name = &#39;C&#39;) = 0
ORDER BY c.customer_id;
</code></pre>
<hr>
<h3 id="1112-æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©"><a href="#1112-æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©" class="headerlink" title="1112.æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©"></a>1112.æ¯ä½å­¦ç”Ÿçš„æœ€é«˜æˆç»©</h3><p>è¡¨ï¼š<code>Enrollments</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| student_id    | int     |
| course_id     | int     |
| grade         | int     |
+---------------+---------+
(student_id, course_id) æ˜¯è¯¥è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆï¼‰ã€‚
grade ä¸ä¼šä¸º NULLã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ¯ä½å­¦ç”Ÿè·å¾—çš„æœ€é«˜æˆç»©å’Œå®ƒæ‰€å¯¹åº”çš„ç§‘ç›®ï¼Œè‹¥ç§‘ç›®æˆç»©å¹¶åˆ—ï¼Œå– <code>course_id</code> æœ€å°çš„ä¸€é—¨ã€‚æŸ¥è¯¢ç»“æœéœ€æŒ‰ <code>student_id</code> å¢åºè¿›è¡Œæ’åºã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Enrollments è¡¨ï¼š
+------------+-------------------+
| student_id | course_id | grade |
+------------+-----------+-------+
| 2          | 2         | 95    |
| 2          | 3         | 95    |
| 1          | 1         | 90    |
| 1          | 2         | 99    |
| 3          | 1         | 80    |
| 3          | 2         | 75    |
| 3          | 3         | 82    |
+------------+-----------+-------+
è¾“å‡ºï¼š
+------------+-------------------+
| student_id | course_id | grade |
+------------+-----------+-------+
| 1          | 2         | 99    |
| 2          | 2         | 95    |
| 3          | 3         | 82    |
+------------+-----------+-------+
</code></pre>
<p><strong>è§£ç­”</strong>ï¼š</p>
<pre><code class="language-sql">select student_id, min(course_id)as course_id, grade from(
    select *, max(grade) over(partition by student_id) as max_score from Enrollments
)t where grade = max_score group by student_id, grade order by student_id;
</code></pre>
<hr>
<h3 id="1440-è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼"><a href="#1440-è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼" class="headerlink" title="1440.è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼"></a>1440.è®¡ç®—å¸ƒå°”è¡¨è¾¾å¼çš„å€¼</h3><p>è¡¨ <code>Variables</code>:</p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| name          | varchar |
| value         | int     |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œname æ˜¯è¯¥è¡¨ä¸»é”®.
è¯¥è¡¨åŒ…å«äº†å­˜å‚¨çš„å˜é‡åŠå…¶å¯¹åº”çš„å€¼.
</code></pre>
<p>è¡¨ <code>Expressions</code>:</p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| left_operand  | varchar |
| operator      | enum    |
| right_operand | varchar |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œ(left_operand, operator, right_operand) æ˜¯è¯¥è¡¨ä¸»é”®.
è¯¥è¡¨åŒ…å«äº†éœ€è¦è®¡ç®—çš„å¸ƒå°”è¡¨è¾¾å¼.
operator æ˜¯æšä¸¾ç±»å‹, å–å€¼äº(&#39;&lt;&#39;, &#39;&gt;&#39;, &#39;=&#39;)
left_operand å’Œ right_operand çš„å€¼ä¿è¯å­˜åœ¨äº Variables è¡¨å•ä¸­.
</code></pre>
<p>è®¡ç®—è¡¨ <code>Expressions</code> ä¸­çš„å¸ƒå°”è¡¨è¾¾å¼ã€‚</p>
<p>è¿”å›çš„ç»“æœè¡¨ <strong>æ— é¡ºåºè¦æ±‚</strong> ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Variables è¡¨:
+------+-------+
| name | value |
+------+-------+
| x    | 66    |
| y    | 77    |
+------+-------+

Expressions è¡¨:
+--------------+----------+---------------+
| left_operand | operator | right_operand |
+--------------+----------+---------------+
| x            | &gt;        | y             |
| x            | &lt;        | y             |
| x            | =        | y             |
| y            | &gt;        | x             |
| y            | &lt;        | x             |
| x            | =        | x             |
+--------------+----------+---------------+

è¾“å‡º:
+--------------+----------+---------------+-------+
| left_operand | operator | right_operand | value |
+--------------+----------+---------------+-------+
| x            | &gt;        | y             | false |
| x            | &lt;        | y             | true  |
| x            | =        | y             | false |
| y            | &gt;        | x             | true  |
| y            | &lt;        | x             | false |
| x            | =        | x             | true  |
+--------------+----------+---------------+-------+
è§£é‡Šï¼š
å¦‚ä¸Šæ‰€ç¤º, ä½ éœ€è¦é€šè¿‡ä½¿ç”¨ Variables è¡¨æ¥æ‰¾åˆ° Expressions è¡¨ä¸­çš„æ¯ä¸€ä¸ªå¸ƒå°”è¡¨è¾¾å¼çš„å€¼.
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">SELECT e.left_operand,
       e.operator,
       e.right_operand,
       CASE
           WHEN e.operator = &#39;&gt;&#39; AND v1.value &gt; v2.value THEN &#39;true&#39;
           WHEN e.operator = &#39;&lt;&#39; AND v1.value &lt; v2.value THEN &#39;true&#39;
           WHEN e.operator = &#39;=&#39; AND v1.value = v2.value THEN &#39;true&#39;
           ELSE &#39;false&#39;
       END AS value
FROM Expressions e
JOIN Variables v1 ON e.left_operand = v1.name
JOIN Variables v2 ON e.right_operand = v2.name;
</code></pre>
<h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><ul>
<li><code>JOIN Variables v1</code> â†’ è·å–å·¦æ“ä½œæ•°çš„å€¼ã€‚</li>
<li><code>JOIN Variables v2</code> â†’ è·å–å³æ“ä½œæ•°çš„å€¼ã€‚</li>
<li><code>CASE</code> é‡Œæ ¹æ®ä¸åŒè¿ç®—ç¬¦è¿›è¡Œæ¯”è¾ƒï¼Œè¿”å› <code>true</code> æˆ– <code>false</code>ã€‚</li>
</ul>
<p>è¿™æ ·å†™å°±èƒ½æ­£ç¡®å¯¹æ¯” <strong>æ•°å€¼</strong>ï¼Œè€Œä¸æ˜¯å¯¹æ¯”å˜é‡åå­—ç¬¦ä¸²ã€‚</p>
<hr>
<h3 id="1212-æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†ï¼ˆåˆ—è½¬è¡Œï¼‰"><a href="#1212-æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†ï¼ˆåˆ—è½¬è¡Œï¼‰" class="headerlink" title="1212.æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†ï¼ˆåˆ—è½¬è¡Œï¼‰"></a>1212.æŸ¥è¯¢çƒé˜Ÿç§¯åˆ†ï¼ˆåˆ—è½¬è¡Œï¼‰</h3><p>è¡¨: <code>Teams</code></p>
<pre><code>+---------------+----------+
| Column Name   | Type     |
+---------------+----------+
| team_id       | int      |
| team_name     | varchar  |
+---------------+----------+
team_id æ˜¯è¯¥è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
è¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€æ”¯ç‹¬ç«‹è¶³çƒé˜Ÿã€‚
</code></pre>
<p>è¡¨: <code>Matches</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| match_id      | int     |
| host_team     | int     |
| guest_team    | int     | 
| host_goals    | int     |
| guest_goals   | int     |
+---------------+---------+
match_id æ˜¯è¯¥è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
è¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½ä»£è¡¨ä¸€åœºå·²ç»“æŸçš„æ¯”èµ›ã€‚
æ¯”èµ›çš„ä¸»å®¢é˜Ÿåˆ†åˆ«ç”±å®ƒä»¬è‡ªå·±çš„ id è¡¨ç¤ºï¼Œä»–ä»¬çš„è¿›çƒç”± host_goals å’Œ guest_goals åˆ†åˆ«è¡¨ç¤ºã€‚
</code></pre>
<p>ä½ å¸Œæœ›åœ¨æ‰€æœ‰æ¯”èµ›ä¹‹åè®¡ç®—æ‰€æœ‰çƒé˜Ÿçš„æ¯”åˆ†ã€‚ç§¯åˆ†å¥–åŠ±æ–¹å¼å¦‚ä¸‹:</p>
<ul>
<li>å¦‚æœçƒé˜Ÿèµ¢äº†æ¯”èµ›(å³æ¯”å¯¹æ‰‹è¿›æ›´å¤šçš„çƒ)ï¼Œå°±å¾— <strong>3</strong> åˆ†ã€‚</li>
<li>å¦‚æœåŒæ–¹æ‰“æˆå¹³æ‰‹(å³ï¼Œä¸å¯¹æ–¹å¾—åˆ†ç›¸åŒ)ï¼Œåˆ™å¾— <strong>1</strong> åˆ†ã€‚</li>
<li>å¦‚æœçƒé˜Ÿè¾“æ‰äº†æ¯”èµ›(ä¾‹å¦‚ï¼Œæ¯”å¯¹æ‰‹å°‘è¿›çƒ)ï¼Œå°± <strong>ä¸å¾—åˆ†</strong> ã€‚</li>
</ul>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œä»¥æ‰¾å‡ºæ¯ä¸ªé˜Ÿçš„ <code>team_id</code>ï¼Œ<code>team_name</code> å’Œ <code>num_points</code>ã€‚</p>
<p>è¿”å›çš„ç»“æœæ ¹æ® <code>num_points</code> <strong>é™åºæ’åº</strong>ï¼Œå¦‚æœæœ‰ä¸¤é˜Ÿç§¯åˆ†ç›¸åŒï¼Œé‚£ä¹ˆè¿™ä¸¤é˜ŸæŒ‰ <code>team_id</code> <strong>å‡åºæ’åº</strong>ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Teams table:
+-----------+--------------+
| team_id   | team_name    |
+-----------+--------------+
| 10        | Leetcode FC  |
| 20        | NewYork FC   |
| 30        | Atlanta FC   |
| 40        | Chicago FC   |
| 50        | Toronto FC   |
+-----------+--------------+
Matches table:
+------------+--------------+---------------+-------------+--------------+
| match_id   | host_team    | guest_team    | host_goals  | guest_goals  |
+------------+--------------+---------------+-------------+--------------+
| 1          | 10           | 20            | 3           | 0            |
| 2          | 30           | 10            | 2           | 2            |
| 3          | 10           | 50            | 5           | 1            |
| 4          | 20           | 30            | 1           | 0            |
| 5          | 50           | 30            | 1           | 0            |
+------------+--------------+---------------+-------------+--------------+
è¾“å‡ºï¼š
+------------+--------------+---------------+
| team_id    | team_name    | num_points    |
+------------+--------------+---------------+
| 10         | Leetcode FC  | 7             |
| 20         | NewYork FC   | 3             |
| 50         | Toronto FC   | 3             |
| 30         | Atlanta FC   | 1             |
| 40         | Chicago FC   | 0             |
+------------+--------------+---------------+
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">
SELECT t.team_id,
       t.team_name,
       IFNULL(SUM(score), 0) AS num_points
FROM Teams t
LEFT JOIN (
    SELECT host_team AS team_id,
           CASE 
               WHEN host_goals &gt; guest_goals THEN 3
               WHEN host_goals = guest_goals THEN 1
               ELSE 0 
           END AS score
    FROM Matches
    UNION ALL
    SELECT guest_team AS team_id,
           CASE 
               WHEN guest_goals &gt; host_goals THEN 3
               WHEN guest_goals = host_goals THEN 1
               ELSE 0 
           END AS score
    FROM Matches
) m ON t.team_id = m.team_id
GROUP BY t.team_id, t.team_name
ORDER BY num_points DESC, t.team_id;
</code></pre>
<ul>
<li><p>æ²¡æœ‰ç»“æœï¼ˆnullï¼‰åˆ™è¿”å›0â€”â€”&gt;IFNULL(col, 0)</p>
</li>
<li><h3 id="æ€è·¯è§£æ"><a href="#æ€è·¯è§£æ" class="headerlink" title="æ€è·¯è§£æ"></a>æ€è·¯è§£æ</h3><ol>
<li><code>UNION ALL</code><ul>
<li>ç¬¬ä¸€æ®µå–ä¸»é˜Ÿï¼ˆ<code>host_team</code>ï¼‰ï¼Œæ ¹æ®æ¯”åˆ†è®¡ç®—ç§¯åˆ†ã€‚</li>
<li>ç¬¬äºŒæ®µå–å®¢é˜Ÿï¼ˆ<code>guest_team</code>ï¼‰ï¼ŒåŒæ ·è®¡ç®—ç§¯åˆ†ã€‚</li>
<li>è¿™æ ·æ¯åœºæ¯”èµ›ä¼šè´¡çŒ®ä¸¤è¡Œæ•°æ®ï¼ˆä¸»é˜Ÿã€å®¢é˜Ÿï¼‰ã€‚</li>
</ul>
</li>
<li>å¤–å±‚å† <code>JOIN Teams</code> â†’ ç¡®ä¿æ‰€æœ‰çƒé˜Ÿéƒ½æ˜¾ç¤ºï¼Œå³ä½¿ä¸€åœºæ²¡æ‰“è¿‡ã€‚</li>
<li><code>GROUP BY</code> èšåˆç§¯åˆ†ï¼Œ<code>ORDER BY num_points DESC, team_id</code> ä¿è¯æ’åºç¬¦åˆè¦æ±‚ã€‚</li>
</ol>
</li>
</ul>
<p><strong>ï¼ˆåˆ—è½¬è¡Œï¼‰åˆ†ç»„ååŒä¸€ç»„çš„ä¸åŒåˆ—æ•°å€¼è¦è¿›è¡Œæ•°å­¦æ“ä½œï¼Œå¯ä»¥ç”¨union allå°†ä¸åŒåˆ—è½¬æ¢ä¸ºåŒä¸€åˆ—åœ¨è¡Œçš„æ–¹å‘æ‹¼æ¥ï¼Œå†ä½¿ç”¨çª—å£å‡½æ•°å¾—åˆ°ç»“æœ</strong></p>
<hr>
<h3 id="1445-è‹¹æœå’Œæ¡”å­ï¼ˆè¡Œè½¬åˆ—ï¼‰"><a href="#1445-è‹¹æœå’Œæ¡”å­ï¼ˆè¡Œè½¬åˆ—ï¼‰" class="headerlink" title="1445. è‹¹æœå’Œæ¡”å­ï¼ˆè¡Œè½¬åˆ—ï¼‰"></a>1445. è‹¹æœå’Œæ¡”å­ï¼ˆè¡Œè½¬åˆ—ï¼‰</h3><p>è¡¨: <code>Sales</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| sale_date     | date    |
| fruit         | enum    | 
| sold_num      | int     | 
+---------------+---------+
(sale_date, fruit) æ˜¯è¯¥è¡¨ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆ)ã€‚
è¯¥è¡¨åŒ…å«äº†æ¯ä¸€å¤©ä¸­&quot;è‹¹æœ&quot; å’Œ &quot;æ¡”å­&quot;çš„é”€å”®æƒ…å†µã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆæŠ¥å‘Šæ¯ä¸€å¤© <strong>è‹¹æœ</strong> å’Œ <strong>æ¡”å­</strong> é”€å”®çš„æ•°ç›®çš„å·®å¼‚.</p>
<p>è¿”å›çš„ç»“æœè¡¨, æŒ‰ç…§æ ¼å¼ä¸º (â€˜YYYY-MM-DDâ€™) çš„ <code>sale_date</code> æ’åº.</p>
<p>è¿”å›ç»“æœè¡¨å¦‚ä¸‹ä¾‹æ‰€ç¤º:</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Sales è¡¨:
+------------+------------+-------------+
| sale_date  | fruit      | sold_num    |
+------------+------------+-------------+
| 2020-05-01 | apples     | 10          |
| 2020-05-01 | oranges    | 8           |
| 2020-05-02 | apples     | 15          |
| 2020-05-02 | oranges    | 15          |
| 2020-05-03 | apples     | 20          |
| 2020-05-03 | oranges    | 0           |
| 2020-05-04 | apples     | 15          |
| 2020-05-04 | oranges    | 16          |
+------------+------------+-------------+
è¾“å‡ºï¼š
+------------+--------------+
| sale_date  | diff         |
+------------+--------------+
| 2020-05-01 | 2            |
| 2020-05-02 | 0            |
| 2020-05-03 | 20           |
| 2020-05-04 | -1           |
+------------+--------------+
è§£é‡Šï¼š
åœ¨ 2020-05-01, å–äº† 10 ä¸ªè‹¹æœ å’Œ 8 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 10 - 8 = 2).
åœ¨ 2020-05-02, å–äº† 15 ä¸ªè‹¹æœ å’Œ 15 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 15 - 15 = 0).
åœ¨ 2020-05-03, å–äº† 20 ä¸ªè‹¹æœ å’Œ 0 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 20 - 0 = 20).
åœ¨ 2020-05-04, å–äº† 15 ä¸ªè‹¹æœ å’Œ 16 ä¸ªæ¡”å­ (å·®å¼‚ä¸º 15 - 16 = -1).
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">select a.sale_date, a.sold_num - b.sold_num as diff
from Sales a left join Sales b
on a.sale_date = b.sale_date 
where a.fruit = &#39;apples&#39; and b.fruit = &#39;oranges&#39;;
</code></pre>
<p><strong>è‡ªè¿æ¥æ•°æ®è¡¨</strong><br> æŠŠ <code>Sales</code> è¡¨å–ä¸¤ä»½ï¼šä¸€ä»½å« <code>a</code>ï¼Œä¸€ä»½å« <code>b</code>ï¼Œç„¶åé€šè¿‡ <code>a.sale_date = b.sale_date</code> æŠŠåŒä¸€å¤©çš„è‹¹æœå’Œæ©˜å­é…å¯¹åˆ°ä¸€èµ·ã€‚</p>
<p><strong>é™å®šæ°´æœç§ç±»</strong><br> åœ¨ <code>where</code> å­å¥é‡Œè§„å®šï¼š<code>a.fruit = &#39;apples&#39;</code>ï¼Œ<code>b.fruit = &#39;oranges&#39;</code>ï¼Œè¿™æ ·å°±ä¿è¯ <code>a</code> è¡¨åªå–è‹¹æœçš„é”€å”®æ•°æ®ï¼Œ<code>b</code> è¡¨åªå–æ©˜å­çš„é”€å”®æ•°æ®ã€‚</p>
<p><strong>è®¡ç®—é”€å”®å·®å€¼</strong><br> åœ¨ <code>select</code> é‡Œå–å‡ºæ—¥æœŸ (<code>a.sale_date</code>)ã€è‹¹æœé”€é‡ (<code>a.sold_num</code>)ã€æ©˜å­é”€é‡ (<code>b.sold_num</code>)ï¼Œå¹¶ä¸”è®¡ç®—å®ƒä»¬çš„å·®å€¼ <code>a.sold_num - b.sold_num</code>ï¼Œå‘½åä¸º <code>diff</code>ã€‚</p>
<p><strong>æ–¹æ³•äºŒï¼šè¡Œè½¬åˆ—</strong></p>
<pre><code class="language-sql">
select sale_date, (apple-orange)as diff from(
    select sale_date, max(case when fruit = &#39;apples&#39; then sold_num else 0 end) as apple, max(case when fruit = &#39;oranges&#39; then sold_num else 0 end)as orange from Sales group by sale_date
    )t;
</code></pre>
<hr>
<h3 id="1699-ä¸¤äººä¹‹é—´çš„é€šè¯æ¬¡æ•°"><a href="#1699-ä¸¤äººä¹‹é—´çš„é€šè¯æ¬¡æ•°" class="headerlink" title="1699.ä¸¤äººä¹‹é—´çš„é€šè¯æ¬¡æ•°"></a>1699.ä¸¤äººä¹‹é—´çš„é€šè¯æ¬¡æ•°</h3><p>è¡¨ï¼š <code>Calls</code></p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| from_id     | int     |
| to_id       | int     |
| duration    | int     |
+-------------+---------+
è¯¥è¡¨æ²¡æœ‰ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ï¼Œå®ƒå¯èƒ½åŒ…å«é‡å¤é¡¹ã€‚
è¯¥è¡¨åŒ…å« from_id ä¸ to_id é—´çš„ä¸€æ¬¡ç”µè¯çš„æ—¶é•¿ã€‚
from_id != to_id
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œç»Ÿè®¡æ¯ä¸€å¯¹ç”¨æˆ· <code>(person1, person2)</code> ä¹‹é—´çš„é€šè¯æ¬¡æ•°å’Œé€šè¯æ€»æ—¶é•¿ï¼Œå…¶ä¸­ <code>person1 &lt; person2</code> ã€‚</p>
<p>ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Calls è¡¨ï¼š
+---------+-------+----------+
| from_id | to_id | duration |
+---------+-------+----------+
| 1       | 2     | 59       |
| 2       | 1     | 11       |
| 1       | 3     | 20       |
| 3       | 4     | 100      |
| 3       | 4     | 200      |
| 3       | 4     | 200      |
| 4       | 3     | 499      |
+---------+-------+----------+
è¾“å‡ºï¼š
+---------+---------+------------+----------------+
| person1 | person2 | call_count | total_duration |
+---------+---------+------------+----------------+
| 1       | 2       | 2          | 70             |
| 1       | 3       | 1          | 20             |
| 3       | 4       | 4          | 999            |
+---------+---------+------------+----------------+
è§£é‡Šï¼š
ç”¨æˆ· 1 å’Œ 2 æ‰“è¿‡ 2 æ¬¡ç”µè¯ï¼Œæ€»æ—¶é•¿ä¸º 70 (59 + 11)ã€‚
ç”¨æˆ· 1 å’Œ 3 æ‰“è¿‡ 1 æ¬¡ç”µè¯ï¼Œæ€»æ—¶é•¿ä¸º 20ã€‚
ç”¨æˆ· 3 å’Œ 4 æ‰“è¿‡ 4 æ¬¡ç”µè¯ï¼Œæ€»æ—¶é•¿ä¸º 999 (100 + 200 + 200 + 499)ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">select a as person1, b as person2, sum(total_count) as call_count, sum(total) as total_duration from(
select from_id as a, to_id as b, count(*) as total_count, sum(duration) as total from Calls group by
from_id, to_id 
union all
select to_id as a, from_id as b, count(*) as total_count, sum(duration) as total from Calls group by
to_id, from_id
)t where a &lt; b group by a, b;
</code></pre>
<p><strong>æ­£åå‘é€šè¯æ‹†å¼€ç»Ÿè®¡</strong><br> å…ˆç”¨ <code>from_id â†’ to_id</code> åˆ†ç»„ç»Ÿè®¡æ¯ä¸€å¯¹é€šè¯çš„æ¬¡æ•°å’Œæ€»æ—¶é•¿ï¼Œå†ç”¨ <code>to_id â†’ from_id</code> åå‘ç»Ÿè®¡ã€‚<br> è¿™æ ·åšçš„ç›®çš„æ˜¯æŠŠåŒæ–¹äº’ç›¸æ‹¨æ‰“çš„æƒ…å†µéƒ½çº³å…¥è€ƒè™‘ã€‚</p>
<p><strong><code>union all</code> åˆå¹¶ç»“æœ</strong><br> æŠŠæ­£å‘å’Œåå‘çš„ç»“æœæ‹¼åœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€å¼ â€œå¯¹ç§°â€çš„ç»“æœé›†ã€‚<br> æ­¤æ—¶ï¼Œæ¯ä¸€å¯¹ç”¨æˆ· (person1, person2) ä¼šå‡ºç°ä¸¤æ¬¡ï¼šä¸€æ¡æ˜¯æ­£å‘ç»Ÿè®¡ï¼Œä¸€æ¡æ˜¯åå‘ç»Ÿè®¡ã€‚</p>
<p><strong>ç»Ÿä¸€é¡ºåºå¹¶å†æ¬¡èšåˆ</strong><br> åœ¨å¤–å±‚æŸ¥è¯¢é‡Œï¼Œç”¨ <code>where a &lt; b</code> ä¿è¯åªä¿ç•™ <code>(å°id, å¤§id)</code> çš„ç»„åˆï¼Œæ¶ˆé™¤é¡ºåºå¸¦æ¥çš„é‡å¤ã€‚<br> ç„¶åå†æŒ‰ <code>(a, b)</code> åˆ†ç»„ï¼Œç”¨ <code>sum(total_count)</code> å’Œ <code>sum(total)</code> æ±‡æ€»åŒæ–¹çš„é€šè¯æ¬¡æ•°å’Œæ€»æ—¶é•¿ã€‚</p>
<hr>
<h3 id="1501-å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶"><a href="#1501-å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶" class="headerlink" title="1501.å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶"></a>1501.å¯ä»¥æ”¾å¿ƒæŠ•èµ„çš„å›½å®¶</h3><p>è¡¨ <code>Person</code>:</p>
<pre><code>+----------------+---------+
| Column Name    | Type    |
+----------------+---------+
| id             | int     |
| name           | varchar |
| phone_number   | varchar |
+----------------+---------+
id æ˜¯è¯¥è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—.
è¯¥è¡¨æ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªäººçš„åå­—å’Œç”µè¯å·ç .
ç”µè¯å·ç çš„æ ¼å¼æ˜¯:&#39;xxx-yyyyyyy&#39;, å…¶ä¸­ xxx æ˜¯å›½å®¶ç (3 ä¸ªå­—ç¬¦), yyyyyyy æ˜¯ç”µè¯å·ç (7 ä¸ªå­—ç¬¦), x å’Œ y éƒ½è¡¨ç¤ºæ•°å­—. åŒæ—¶, å›½å®¶ç å’Œç”µè¯å·ç éƒ½å¯ä»¥åŒ…å«å‰å¯¼ 0.
</code></pre>
<p>è¡¨ <code>Country</code>:</p>
<pre><code>+----------------+---------+
| Column Name    | Type    |
+----------------+---------+
| name           | varchar |
| country_code   | varchar |
+----------------+---------+
country_code æ˜¯è¯¥è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—.
è¯¥è¡¨æ¯ä¸€è¡ŒåŒ…å«å›½å®¶åå’Œå›½å®¶ç . country_code çš„æ ¼å¼æ˜¯&#39;xxx&#39;, x æ˜¯æ•°å­—.
</code></pre>
<p>è¡¨ <code>Calls</code>:</p>
<pre><code>+-------------+------+
| Column Name | Type |
+-------------+------+
| caller_id   | int  |
| callee_id   | int  |
| duration    | int  |
+-------------+------+
è¯¥è¡¨æ— ä¸»é”®, å¯èƒ½åŒ…å«é‡å¤è¡Œ.
æ¯ä¸€è¡ŒåŒ…å«å‘¼å«æ–¹ id, è¢«å‘¼å«æ–¹ id å’Œä»¥åˆ†é’Ÿä¸ºå•ä½çš„é€šè¯æ—¶é•¿. caller_id != callee_id
</code></pre>
<p>ä¸€å®¶ç”µä¿¡å…¬å¸æƒ³è¦æŠ•èµ„æ–°çš„å›½å®¶ã€‚è¯¥å…¬å¸æƒ³è¦æŠ•èµ„çš„å›½å®¶æ˜¯: è¯¥å›½çš„å¹³å‡é€šè¯æ—¶é•¿è¦ä¸¥æ ¼åœ°å¤§äºå…¨çƒå¹³å‡é€šè¯æ—¶é•¿ã€‚</p>
<p>å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ, æ‰¾åˆ°æ‰€æœ‰è¯¥å…¬å¸å¯ä»¥æŠ•èµ„çš„å›½å®¶ã€‚</p>
<p>è¿”å›çš„ç»“æœè¡¨ <strong>æ— é¡ºåºè¦æ±‚</strong>ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Person è¡¨ï¼š
+----+----------+--------------+
| id | name     | phone_number |
+----+----------+--------------+
| 3  | Jonathan | 051-1234567  |
| 12 | Elvis    | 051-7654321  |
| 1  | Moncef   | 212-1234567  |
| 2  | Maroua   | 212-6523651  |
| 7  | Meir     | 972-1234567  |
| 9  | Rachel   | 972-0011100  |
+----+----------+--------------+
Country è¡¨:
+----------+--------------+
| name     | country_code |
+----------+--------------+
| Peru     | 051          |
| Israel   | 972          |
| Morocco  | 212          |
| Germany  | 049          |
| Ethiopia | 251          |
+----------+--------------+
Calls è¡¨:
+-----------+-----------+----------+
| caller_id | callee_id | duration |
+-----------+-----------+----------+
| 1         | 9         | 33       |
| 2         | 9         | 4        |
| 1         | 2         | 59       |
| 3         | 12        | 102      |
| 3         | 12        | 330      |
| 12        | 3         | 5        |
| 7         | 9         | 13       |
| 7         | 1         | 3        |
| 9         | 7         | 1        |
| 1         | 7         | 7        |
+-----------+-----------+----------+
è¾“å‡ºï¼š
+----------+
| country  |
+----------+
| Peru     |
+----------+
è§£é‡Šï¼š
å›½å®¶ Peru çš„å¹³å‡é€šè¯æ—¶é•¿æ˜¯ (102 + 102 + 330 + 330 + 5 + 5) / 6 = 145.666667
å›½å®¶ Israel çš„å¹³å‡é€šè¯æ—¶é•¿æ˜¯ (33 + 4 + 13 + 13 + 3 + 1 + 1 + 7) / 8 = 9.37500
å›½å®¶ Morocco çš„å¹³å‡é€šè¯æ—¶é•¿æ˜¯ (33 + 4 + 59 + 59 + 3 + 7) / 6 = 27.5000 
å…¨çƒå¹³å‡é€šè¯æ—¶é•¿ = (2 * (33 + 4 + 59 + 102 + 330 + 5 + 13 + 3 + 1 + 7)) / 20 = 55.70000
æ‰€ä»¥, Peru æ˜¯å”¯ä¸€çš„å¹³å‡é€šè¯æ—¶é•¿å¤§äºå…¨çƒå¹³å‡é€šè¯æ—¶é•¿çš„å›½å®¶, ä¹Ÿæ˜¯å”¯ä¸€çš„æ¨èæŠ•èµ„çš„å›½å®¶.
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<p><strong>å’Œä¸Šä¸€é¢˜ä¸€ä¸ªæ€è·¯ï¼Œå°†coller_idå’Œcollee_idé€šè¿‡union allè½¬åŒ–åˆ°åŒä¸€ä¸ªè¡¨çš„åŒä¸€åˆ—</strong></p>
<p>ä¸€ä¸ªè¡¨ï¼ˆCallsï¼‰ä¸­å‡ºç°ä¸¤åˆ—ï¼ˆcaller_id ã€callee_idï¼‰éƒ½æ˜¯åŒå±ä¸€ä¸ªè¡¨ï¼ˆPersonï¼‰é‡Œçš„å±æ€§ï¼Œç”¨join+unionå³å¯å…¨éƒ¨å½’çº³</p>
<pre><code class="language-sql">with base as(
    select c1.caller_id as id, c1.duration as phonetime, p1.phone_number as number from Calls c1 join Person p1 on c1.caller_id = p1.id 
    union all
    select c2.callee_id as id, c2.duration as phonetime, p2.phone_number as number from Calls c2 join Person p2 on c2.callee_id = p2.id 
),
seq as(
    select a.id, a.phonetime, b.name as country_name from base a join Country b on substring(a.number, 1, 3) = b.country_code 
),
country_avg as (
    select country_name, avg(phonetime) as avg_time from seq group by country_name
),
global_avg as (
    select avg(phonetime) as avg_global from seq 
)
select country_name as country from country_avg where avg_time &gt; (
    select avg_global from global_avg
</code></pre>
<ol>
<li><strong>æå–å›½å®¶ä»£ç </strong>ï¼šä»<code>Person</code>è¡¨ä¸­æå–æ¯ä¸ªç”¨æˆ·çš„å›½å®¶ä»£ç ï¼ˆç”µè¯å·ç çš„å‰ä¸‰ä¸ªå­—ç¬¦ï¼‰ã€‚</li>
<li><strong>è®¡ç®—æ¯ä¸ªé€šè¯çš„å›½å®¶</strong>ï¼šå¯¹äº<code>Calls</code>è¡¨ä¸­çš„æ¯ä¸ªé€šè¯ï¼Œæ— è®ºæ˜¯å‘¼å«è€…è¿˜æ˜¯è¢«å‘¼å«è€…ï¼Œéƒ½éœ€è¦ç¡®å®šå…¶å›½å®¶ä»£ç ï¼Œä»è€Œå°†é€šè¯æ—¶é•¿åˆ†é…ç»™ç›¸åº”çš„å›½å®¶ã€‚</li>
<li><strong>è®¡ç®—æ¯ä¸ªå›½å®¶çš„å¹³å‡é€šè¯æ—¶é•¿</strong>ï¼šæ±‡æ€»æ¯ä¸ªå›½å®¶çš„æ‰€æœ‰é€šè¯æ—¶é•¿ï¼Œè®¡ç®—å…¶å¹³å‡å€¼ã€‚</li>
<li><strong>è®¡ç®—å…¨çƒå¹³å‡é€šè¯æ—¶é•¿</strong>ï¼šæ±‡æ€»æ‰€æœ‰é€šè¯çš„é€šè¯æ—¶é•¿ï¼Œè®¡ç®—å…¨çƒå¹³å‡å€¼ã€‚</li>
<li><strong>æ¯”è¾ƒå¹¶ç­›é€‰å›½å®¶</strong>ï¼šç­›é€‰å‡ºé‚£äº›å¹³å‡é€šè¯æ—¶é•¿ä¸¥æ ¼å¤§äºå…¨çƒå¹³å‡é€šè¯æ—¶é•¿çš„å›½å®¶ã€‚</li>
</ol>
<hr>
<h3 id="1264-é¡µé¢æè¿°"><a href="#1264-é¡µé¢æè¿°" class="headerlink" title="1264.é¡µé¢æè¿°"></a>1264.é¡µé¢æè¿°</h3><p>æœ‹å‹å…³ç³»åˆ—è¡¨ï¼š <code>Friendship</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| user1_id      | int     |
| user2_id      | int     |
+---------------+---------+
(user1_id, user2_id) æ˜¯è¿™å¼ è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆã€‚
è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨ç€ user1_id å’Œ user2_id ä¹‹é—´å­˜åœ¨ç€æœ‹å‹å…³ç³»ã€‚
</code></pre>
<p>å–œæ¬¢åˆ—è¡¨ï¼š <code>Likes</code></p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| user_id     | int     |
| page_id     | int     |
+-------------+---------+
(user_id, page_id) æ˜¯è¿™å¼ è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆã€‚
è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œä»£è¡¨ç€ user_id å–œæ¬¢ page_idã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œå‘<code>user_id</code> &#x3D; 1 çš„ç”¨æˆ·ï¼Œæ¨èå…¶æœ‹å‹ä»¬å–œæ¬¢çš„é¡µé¢ã€‚ä¸è¦æ¨èè¯¥ç”¨æˆ·å·²ç»å–œæ¬¢çš„é¡µé¢ã€‚</p>
<p>ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœï¼Œå…¶ä¸­ä¸åº”å½“åŒ…å«é‡å¤é¡¹ã€‚</p>
<p>è¿”å›ç»“æœçš„æ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Friendship table:
+----------+----------+
| user1_id | user2_id |
+----------+----------+
| 1        | 2        |
| 1        | 3        |
| 1        | 4        |
| 2        | 3        |
| 2        | 4        |
| 2        | 5        |
| 6        | 1        |
+----------+----------+
 
Likes table:
+---------+---------+
| user_id | page_id |
+---------+---------+
| 1       | 88      |
| 2       | 23      |
| 3       | 24      |
| 4       | 56      |
| 5       | 11      |
| 6       | 33      |
| 2       | 77      |
| 3       | 77      |
| 6       | 88      |
+---------+---------+

è¾“å‡ºï¼š
+------------------+
| recommended_page |
+------------------+
| 23               |
| 24               |
| 56               |
| 33               |
| 77               |
+------------------+
è§£é‡Šï¼š
ç”¨æˆ·1 åŒ ç”¨æˆ·2, 3, 4, 6 æ˜¯æœ‹å‹å…³ç³»ã€‚
æ¨èé¡µé¢ä¸ºï¼š é¡µé¢23 æ¥è‡ªäº ç”¨æˆ·2, é¡µé¢24 æ¥è‡ªäº ç”¨æˆ·3, é¡µé¢56 æ¥è‡ªäº ç”¨æˆ·3 ä»¥åŠ é¡µé¢33 æ¥è‡ªäº ç”¨æˆ·6ã€‚
é¡µé¢77 åŒæ—¶è¢« ç”¨æˆ·2 å’Œ ç”¨æˆ·3 æ¨èã€‚
é¡µé¢88 æ²¡æœ‰è¢«æ¨èï¼Œå› ä¸º ç”¨æˆ·1 å·²ç»å–œæ¬¢äº†å®ƒã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">with base as(
    select case when user1_id = 1 then user2_id 
    when user2_id = 1 then user1_id else null end as friend from Friendship
),
seq as(
    select distinct a.page_id from Likes a join base b on a.user_id = b.friend where b.friend is not null
)
select page_id as recommended_page from seq a where not exists (
    select b.page_id from Likes b where b.user_id = 1 and a.page_id = b.page_id
);
</code></pre>
<p>å¦‚æœç­‰å€¼å­æŸ¥è¯¢ä¼šè¿”å›nullï¼Œåˆ™éœ€è¦ä½¿ç”¨not exists+ç›¸å…³å­æŸ¥è¯¢</p>
<hr>
<h3 id="608-æ ‘èŠ‚ç‚¹"><a href="#608-æ ‘èŠ‚ç‚¹" class="headerlink" title="608.æ ‘èŠ‚ç‚¹"></a>608.æ ‘èŠ‚ç‚¹</h3><p>è¡¨ï¼š<code>Tree</code></p>
<pre><code>+-------------+------+
| Column Name | Type |
+-------------+------+
| id          | int  |
| p_id        | int  |
+-------------+------+
id æ˜¯è¯¥è¡¨ä¸­å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
è¯¥è¡¨çš„æ¯è¡ŒåŒ…å«æ ‘ä¸­èŠ‚ç‚¹çš„ id åŠå…¶çˆ¶èŠ‚ç‚¹çš„ id ä¿¡æ¯ã€‚
ç»™å®šçš„ç»“æ„æ€»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„æ ‘ã€‚
</code></pre>
<p>æ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æ˜¯ä»¥ä¸‹ä¸‰ç§ç±»å‹ä¹‹ä¸€ï¼š</p>
<ul>
<li><strong>â€œLeafâ€</strong>ï¼šèŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ã€‚</li>
<li><strong>â€œRootâ€</strong>ï¼šèŠ‚ç‚¹æ˜¯æ ‘çš„æ ¹èŠ‚ç‚¹ã€‚</li>
<li><strong>â€œlnnerâ€</strong>ï¼šèŠ‚ç‚¹æ—¢ä¸æ˜¯å¶å­èŠ‚ç‚¹ä¹Ÿä¸æ˜¯æ ¹èŠ‚ç‚¹ã€‚</li>
</ul>
<p>ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆæ¥æŠ¥å‘Šæ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„ç±»å‹ã€‚</p>
<p>ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Tree table:
+----+------+
| id | p_id |
+----+------+
| 1  | null |
| 2  | 1    |
| 3  | 1    |
| 4  | 2    |
| 5  | 2    |
+----+------+
è¾“å‡ºï¼š
+----+-------+
| id | type  |
+----+-------+
| 1  | Root  |
| 2  | Inner |
| 3  | Leaf  |
| 4  | Leaf  |
| 5  | Leaf  |
+----+-------+
è§£é‡Šï¼š
èŠ‚ç‚¹ 1 æ˜¯æ ¹èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒçš„çˆ¶èŠ‚ç‚¹ä¸ºç©ºï¼Œå¹¶ä¸”å®ƒæœ‰å­èŠ‚ç‚¹ 2 å’Œ 3ã€‚
èŠ‚ç‚¹ 2 æ˜¯ä¸€ä¸ªå†…éƒ¨èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒæœ‰çˆ¶èŠ‚ç‚¹ 1 å’Œå­èŠ‚ç‚¹ 4 å’Œ 5ã€‚
èŠ‚ç‚¹ 3ã€4 å’Œ 5 æ˜¯å¶å­èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒä»¬æœ‰çˆ¶èŠ‚ç‚¹è€Œæ²¡æœ‰å­èŠ‚ç‚¹ã€‚
</code></pre>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Tree table:
+----+------+
| id | p_id |
+----+------+
| 1  | null |
+----+------+
è¾“å‡ºï¼š
+----+-------+
| id | type  |
+----+-------+
| 1  | Root  |
+----+-------+
è§£é‡Šï¼šå¦‚æœæ ‘ä¸­åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåˆ™åªéœ€è¦è¾“å‡ºå…¶æ ¹å±æ€§ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">
select id, case when p_id is null then &#39;Root&#39; 
when id in (select p_id from Tree where p_id is not null) then &#39;Inner&#39;
else &#39;Leaf&#39; end as type from Tree;
</code></pre>
<hr>
<h3 id="534-æ¸¸æˆç©æ³•åˆ†æ"><a href="#534-æ¸¸æˆç©æ³•åˆ†æ" class="headerlink" title="534.æ¸¸æˆç©æ³•åˆ†æ |||"></a>534.æ¸¸æˆç©æ³•åˆ†æ |||</h3><p>è¡¨ï¼š<code>Activity</code></p>
<pre><code>+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| player_id    | int     |
| device_id    | int     |
| event_date   | date    |
| games_played | int     |
+--------------+---------+
ï¼ˆplayer_idï¼Œevent_dateï¼‰æ˜¯æ­¤è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
è¿™å¼ è¡¨æ˜¾ç¤ºäº†æŸäº›æ¸¸æˆçš„ç©å®¶çš„æ´»åŠ¨æƒ…å†µã€‚
æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç©å®¶çš„è®°å½•ï¼Œä»–åœ¨æŸä¸€å¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡æ³¨é”€ä¹‹å‰ç™»å½•å¹¶ç©äº†å¾ˆå¤šæ¸¸æˆï¼ˆå¯èƒ½æ˜¯ 0 ï¼‰ã€‚
</code></pre>
<p>ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼ŒåŒæ—¶æŠ¥å‘Šæ¯ç»„ç©å®¶å’Œæ—¥æœŸï¼Œä»¥åŠç©å®¶åˆ° <strong>ç›®å‰ä¸ºæ­¢</strong> ç©äº†å¤šå°‘æ¸¸æˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç©å®¶åœ¨è¯¥æ—¥æœŸä¹‹å‰æ‰€ç©çš„æ¸¸æˆæ€»æ•°ã€‚è¯¦ç»†æƒ…å†µè¯·æŸ¥çœ‹ç¤ºä¾‹ã€‚</p>
<p>ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Activity table:
+-----------+-----------+------------+--------------+
| player_id | device_id | event_date | games_played |
+-----------+-----------+------------+--------------+
| 1         | 2         | 2016-03-01 | 5            |
| 1         | 2         | 2016-05-02 | 6            |
| 1         | 3         | 2017-06-25 | 1            |
| 3         | 1         | 2016-03-02 | 0            |
| 3         | 4         | 2018-07-03 | 5            |
+-----------+-----------+------------+--------------+
è¾“å‡ºï¼š
+-----------+------------+---------------------+
| player_id | event_date | games_played_so_far |
+-----------+------------+---------------------+
| 1         | 2016-03-01 | 5                   |
| 1         | 2016-05-02 | 11                  |
| 1         | 2017-06-25 | 12                  |
| 3         | 2016-03-02 | 0                   |
| 3         | 2018-07-03 | 5                   |
+-----------+------------+---------------------+
è§£é‡Šï¼š
å¯¹äº ID ä¸º 1 çš„ç©å®¶ï¼Œ2016-05-02 å…±ç©äº† 5+6=11 ä¸ªæ¸¸æˆï¼Œ2017-06-25 å…±ç©äº† 5+6+1=12 ä¸ªæ¸¸æˆã€‚
å¯¹äº ID ä¸º 3 çš„ç©å®¶ï¼Œ2018-07-03 å…±ç©äº† 0+5=5 ä¸ªæ¸¸æˆã€‚
è¯·æ³¨æ„ï¼Œå¯¹äºæ¯ä¸ªç©å®¶ï¼Œæˆ‘ä»¬åªå…³å¿ƒç©å®¶çš„ç™»å½•æ—¥æœŸã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">select player_id, event_date, sum(games_played)over (partition by player_id order by event_date)as games_played_so_far from Activity;
</code></pre>
<hr>
<h3 id="1783-å¤§æ»¡è´¯æ•°é‡"><a href="#1783-å¤§æ»¡è´¯æ•°é‡" class="headerlink" title="1783.å¤§æ»¡è´¯æ•°é‡"></a>1783.å¤§æ»¡è´¯æ•°é‡</h3><p>è¡¨ï¼š<code>Players</code></p>
<pre><code>+----------------+---------+
| Column Name    | Type    |
+----------------+---------+
| player_id      | int     |
| player_name    | varchar |
+----------------+---------+
player_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰
è¿™ä¸ªè¡¨çš„æ¯ä¸€è¡Œç»™å‡ºä¸€ä¸ªç½‘çƒè¿åŠ¨å‘˜çš„ ID å’Œ å§“å
</code></pre>
<p>è¡¨ï¼š<code>Championships</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| year          | int     |
| Wimbledon     | int     |
| Fr_open       | int     |
| US_open       | int     |
| Au_open       | int     |
+---------------+---------+
year æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½åŒ…å«åœ¨æ¯åœºå¤§æ»¡è´¯ç½‘çƒæ¯”èµ›ä¸­èµ¢å¾—æ¯”èµ›çš„çƒå‘˜çš„ ID
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ¯ä¸€ä¸ªçƒå‘˜èµ¢å¾—å¤§æ»¡è´¯æ¯”èµ›çš„æ¬¡æ•°ã€‚ç»“æœä¸åŒ…å«æ²¡æœ‰èµ¢å¾—æ¯”èµ›çš„çƒå‘˜çš„ID ã€‚</p>
<p>ç»“æœé›† <strong>æ— é¡ºåºè¦æ±‚</strong> ã€‚</p>
<p>ç»“æœçš„æ ¼å¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Players è¡¨ï¼š
+-----------+-------------+
| player_id | player_name |
+-----------+-------------+
| 1         | Nadal       |
| 2         | Federer     |
| 3         | Novak       |
+-----------+-------------+
Championships è¡¨ï¼š
+------+-----------+---------+---------+---------+
| year | Wimbledon | Fr_open | US_open | Au_open |
+------+-----------+---------+---------+---------+
| 2018 | 1         | 1       | 1       | 1       |
| 2019 | 1         | 1       | 2       | 2       |
| 2020 | 2         | 1       | 2       | 2       |
+------+-----------+---------+---------+---------+
è¾“å‡ºï¼š
+-----------+-------------+-------------------+
| player_id | player_name | grand_slams_count |
+-----------+-------------+-------------------+
| 2         | Federer     | 5                 |
| 1         | Nadal       | 7                 |
+-----------+-------------+-------------------+
è§£é‡Šï¼š
Player 1 (Nadal) è·å¾—äº† 7 æ¬¡å¤§æ»¡è´¯ï¼šå…¶ä¸­æ¸©ç½‘ 2 æ¬¡(2018, 2019), æ³•å›½å…¬å¼€èµ› 3 æ¬¡ (2018, 2019, 2020), ç¾å›½å…¬å¼€èµ› 1 æ¬¡ (2018)ä»¥åŠæ¾³ç½‘å…¬å¼€èµ› 1 æ¬¡ (2018) ã€‚
Player 2 (Federer) è·å¾—äº† 5 æ¬¡å¤§æ»¡è´¯ï¼šå…¶ä¸­æ¸©ç½‘ 1 æ¬¡ (2020), ç¾å›½å…¬å¼€èµ› 2 æ¬¡ (2019, 2020) ä»¥åŠæ¾³ç½‘å…¬å¼€èµ› 2 æ¬¡ (2019, 2020) ã€‚
Player 3 (Novak)  æ²¡æœ‰èµ¢å¾—ï¼Œå› æ­¤ä¸åŒ…å«åœ¨ç»“æœé›†ä¸­ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<p>æˆ‘ç”¨çš„æ˜¯åˆ—è½¬è¡Œçš„æ€è·¯è¿›è¡Œè§£ç­”ï¼ŒæŠŠæ¯”èµ›åè¿™å‡ åˆ—è½¬ä¸ºæ–°åˆ—competitionçš„ä¸åŒè¡Œï¼ŒæŠŠä¸åŒæ¯”èµ›çš„è·èƒœidè½¬ä¸ºplayer_idçš„ä¸åŒè¡Œã€‚</p>
<pre><code class="language-sql">select a.player_id , a.player_name, count(b.player_id) as grand_slams_count from Players a right join(
select Wimbledon as player_id, &#39;Wimbledon&#39; as competition from Championships  
union all
select Fr_open as player_id, &#39;Fr_open&#39; as competition from Championships  
union all
select US_open as player_id, &#39;US_open&#39; as competition from Championships  
union all
select Au_open as player_id, &#39;Au_open&#39; as competition from Championships )b 
on a.player_id = b.player_id group by b.player_id;
</code></pre>
<hr>
<h3 id="1747-åº”è¯¥è¢«ç¦æ­¢çš„Leetflexè´¦æˆ·"><a href="#1747-åº”è¯¥è¢«ç¦æ­¢çš„Leetflexè´¦æˆ·" class="headerlink" title="1747..åº”è¯¥è¢«ç¦æ­¢çš„Leetflexè´¦æˆ·"></a>1747..åº”è¯¥è¢«ç¦æ­¢çš„Leetflexè´¦æˆ·</h3><p>è¡¨: <code>LogInfo</code></p>
<pre><code>+-------------+----------+
| Column Name | Type     |
+-------------+----------+
| account_id  | int      |
| ip_address  | int      |
| login       | datetime |
| logout      | datetime |
+-------------+----------+
è¯¥è¡¨å¯èƒ½åŒ…å«é‡å¤é¡¹ã€‚
è¯¥è¡¨åŒ…å«æœ‰å…³Leetflexå¸æˆ·çš„ç™»å½•å’Œæ³¨é”€æ—¥æœŸçš„ä¿¡æ¯ã€‚ å®ƒè¿˜åŒ…å«äº†è¯¥è´¦æˆ·ç”¨äºç™»å½•å’Œæ³¨é”€çš„ç½‘ç»œåœ°å€çš„ä¿¡æ¯ã€‚
é¢˜ç›®ç¡®ä¿æ¯ä¸€ä¸ªæ³¨é”€æ—¶é—´éƒ½åœ¨ç™»å½•æ—¶é—´ä¹‹åã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼ŒæŸ¥æ‰¾é‚£äº›åº”è¯¥è¢«ç¦æ­¢çš„Leetflexå¸æˆ·ç¼–å· <code>account_id</code> ã€‚ å¦‚æœæŸä¸ªå¸æˆ·åœ¨æŸä¸€æ—¶åˆ»ä»ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œåœ°å€ç™»å½•äº†ï¼Œåˆ™è¿™ä¸ªå¸æˆ·åº”è¯¥è¢«ç¦æ­¢ã€‚</p>
<p>å¯ä»¥ä»¥ <strong>ä»»ä½•é¡ºåº</strong> è¿”å›ç»“æœã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
LogInfo table:
+------------+------------+---------------------+---------------------+
| account_id | ip_address | login               | logout              |
+------------+------------+---------------------+---------------------+
| 1          | 1          | 2021-02-01 09:00:00 | 2021-02-01 09:30:00 |
| 1          | 2          | 2021-02-01 08:00:00 | 2021-02-01 11:30:00 |
| 2          | 6          | 2021-02-01 20:30:00 | 2021-02-01 22:00:00 |
| 2          | 7          | 2021-02-02 20:30:00 | 2021-02-02 22:00:00 |
| 3          | 9          | 2021-02-01 16:00:00 | 2021-02-01 16:59:59 |
| 3          | 13         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |
| 4          | 10         | 2021-02-01 16:00:00 | 2021-02-01 17:00:00 |
| 4          | 11         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |
+------------+------------+---------------------+---------------------+
è¾“å‡ºï¼š
+------------+
| account_id |
+------------+
| 1          |
| 4          |
+------------+
è§£é‡Šï¼š
Account ID 1 --&gt; è¯¥è´¦æˆ·ä» &quot;2021-02-01 09:00:00&quot; åˆ° &quot;2021-02-01 09:30:00&quot; åœ¨ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œåœ°å€(1 and 2)ä¸Šæ¿€æ´»äº†ã€‚å®ƒåº”è¯¥è¢«ç¦æ­¢.
Account ID 2 --&gt; è¯¥è´¦æˆ·åœ¨ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œåœ°å€ (6, 7) æ¿€æ´»äº†ï¼Œä½†åœ¨ä¸åŒçš„æ—¶é—´ä¸Š.
Account ID 3 --&gt; è¯¥è´¦æˆ·åœ¨ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œåœ°å€ (9, 13) æ¿€æ´»äº†ï¼Œè™½ç„¶æ˜¯åŒä¸€å¤©ï¼Œä½†æ—¶é—´ä¸Šæ²¡æœ‰äº¤é›†.
Account ID 4 --&gt; è¯¥è´¦æˆ·ä» &quot;2021-02-01 17:00:00&quot; åˆ° &quot;2021-02-01 17:00:00&quot; åœ¨ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œåœ°å€ (10 and 11)ä¸Šæ¿€æ´»äº†ã€‚å®ƒåº”è¯¥è¢«ç¦æ­¢.
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<p>åŒä¸€ä¸ªidçš„ä¸åŒåˆ—æ•°å€¼è¿›è¡Œå¯¹æ¯”â€”â€”&gt;ä½¿ç”¨è‡ªè¿æ¥ã€‚</p>
<p>æ³¨æ„ï¼šä½¿ç”¨joinæ—¶onçš„æ¡ä»¶è¶Šå°‘æ•ˆç‡è¶Šé«˜ã€‚</p>
<pre><code class="language-sql">select account_id from (
select max(case when b.login &gt; a.login and b.login &lt;= a.logout then a.account_id else 0 end) as account_id
from LogInfo a join LogInfo b on a.account_id = b.account_id where a.ip_address != b.ip_address group by a.account_id)t where account_id &gt; 0;
</code></pre>
<p>è‹¥æŠŠa.ip_address !&#x3D; b.ip_addresså†™åˆ°onä¸­åˆ™ä¼šæŠ¥è¶…æ—¶</p>
<pre><code class="language-sql">from LogInfo a join LogInfo b on a.account_id = b.account_id and a.ip_address != b.ip_address group by a.account_id)t where account_id &gt; 0;
</code></pre>
<hr>
<h3 id="184-éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥"><a href="#184-éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥" class="headerlink" title="184.éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥"></a>184.éƒ¨é—¨å·¥èµ„æœ€é«˜çš„å‘˜å·¥</h3><p>è¡¨ï¼š <code>Employee</code></p>
<pre><code>+--------------+---------+
| åˆ—å          | ç±»å‹    |
+--------------+---------+
| id           | int     |
| name         | varchar |
| salary       | int     |
| departmentId | int     |
+--------------+---------+
åœ¨ SQL ä¸­ï¼Œidæ˜¯æ­¤è¡¨çš„ä¸»é”®ã€‚
departmentId æ˜¯ Department è¡¨ä¸­ id çš„å¤–é”®ï¼ˆåœ¨ Pandas ä¸­ç§°ä¸º join keyï¼‰ã€‚
æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºå‘˜å·¥çš„ idã€å§“åå’Œå·¥èµ„ã€‚å®ƒè¿˜åŒ…å«ä»–ä»¬æ‰€åœ¨éƒ¨é—¨çš„ idã€‚
</code></pre>
<p>è¡¨ï¼š <code>Department</code></p>
<pre><code>+-------------+---------+
| åˆ—å         | ç±»å‹    |
+-------------+---------+
| id          | int     |
| name        | varchar |
+-------------+---------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯æ­¤è¡¨çš„ä¸»é”®åˆ—ã€‚
æ­¤è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºä¸€ä¸ªéƒ¨é—¨çš„ d åŠå…¶åç§°ã€‚
</code></pre>
<p>æŸ¥æ‰¾å‡ºæ¯ä¸ªéƒ¨é—¨ä¸­è–ªèµ„æœ€é«˜çš„å‘˜å·¥ã€‚<br>æŒ‰ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚<br>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Employee è¡¨:
+----+-------+--------+--------------+
| id | name  | salary | departmentId |
+----+-------+--------+--------------+
| 1  | Joe   | 70000  | 1            |
| 2  | Jim   | 90000  | 1            |
| 3  | Henry | 80000  | 2            |
| 4  | Sam   | 60000  | 2            |
| 5  | Max   | 90000  | 1            |
+----+-------+--------+--------------+
Department è¡¨:
+----+-------+
| id | name  |
+----+-------+
| 1  | IT    |
| 2  | Sales |
+----+-------+
è¾“å‡ºï¼š
+------------+----------+--------+
| Department | Employee | Salary |
+------------+----------+--------+
| IT         | Jim      | 90000  |
| Sales      | Henry    | 80000  |
| IT         | Max      | 90000  |
+------------+----------+--------+
è§£é‡Šï¼šMax å’Œ Jim åœ¨ IT éƒ¨é—¨çš„å·¥èµ„éƒ½æ˜¯æœ€é«˜çš„ï¼ŒHenry åœ¨é”€å”®éƒ¨çš„å·¥èµ„æœ€é«˜ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">select b.name as Department, a.name as Employee, a.salary as Salary from (select *, RANK() over(partition by departmentId order by salary DESC) as rk from Employee) a join Department b on a.departmentId = b.id where a.rk = 1;
</code></pre>
<hr>
<h3 id="1549-æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å•"><a href="#1549-æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å•" class="headerlink" title="1549.æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å•"></a>1549.æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å•</h3><p>è¡¨: <code>Customers</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| customer_id   | int     |
| name          | varchar |
+---------------+---------+
customer_id æ˜¯è¯¥è¡¨ä¸»é”®.
è¯¥è¡¨åŒ…å«æ¶ˆè´¹è€…çš„ä¿¡æ¯.
</code></pre>
<p>è¡¨: <code>Orders</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| order_id      | int     |
| order_date    | date    |
| customer_id   | int     |
| product_id    | int     |
+---------------+---------+
order_id æ˜¯è¯¥è¡¨ä¸»é”®.
è¯¥è¡¨åŒ…å«æ¶ˆè´¹è€…customer_idäº§ç”Ÿçš„è®¢å•.
ä¸ä¼šæœ‰å•†å“è¢«ç›¸åŒçš„ç”¨æˆ·åœ¨ä¸€å¤©å†…ä¸‹å•è¶…è¿‡ä¸€æ¬¡.
</code></pre>
<p>è¡¨: <code>Products</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| product_id    | int     |
| product_name  | varchar |
| price         | int     |
+---------------+---------+
product_id æ˜¯è¯¥è¡¨ä¸»é”®.
è¯¥è¡¨åŒ…å«æ‰€æœ‰å•†å“çš„ä¿¡æ¯.
</code></pre>
<p>å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆ, æ‰¾åˆ°æ¯ä»¶å•†å“çš„æœ€æ–°è®¢å•(å¯èƒ½æœ‰å¤šä¸ª).</p>
<p>è¿”å›çš„ç»“æœä»¥ <code>product_name</code> <strong>å‡åºæ’åˆ—</strong>, å¦‚æœæœ‰æ’åºç›¸åŒ, å†ä»¥ <code>product_id</code> <strong>å‡åº</strong>æ’åˆ—. å¦‚æœè¿˜æœ‰æ’åºç›¸åŒ, å†ä»¥ <code>order_id</code> <strong>å‡åº</strong>æ’åˆ—.</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥:
Customersè¡¨ï¼š
+-------------+-----------+
| customer_id | name      |
+-------------+-----------+
| 1           | Winston   |
| 2           | Jonathan  |
| 3           | Annabelle |
| 4           | Marwan    |
| 5           | Khaled    |
+-------------+-----------+
Ordersè¡¨ï¼š
+----------+------------+-------------+------------+
| order_id | order_date | customer_id | product_id |
+----------+------------+-------------+------------+
| 1        | 2020-07-31 | 1           | 1          |
| 2        | 2020-07-30 | 2           | 2          |
| 3        | 2020-08-29 | 3           | 3          |
| 4        | 2020-07-29 | 4           | 1          |
| 5        | 2020-06-10 | 1           | 2          |
| 6        | 2020-08-01 | 2           | 1          |
| 7        | 2020-08-01 | 3           | 1          |
| 8        | 2020-08-03 | 1           | 2          |
| 9        | 2020-08-07 | 2           | 3          |
| 10       | 2020-07-15 | 1           | 2          |
+----------+------------+-------------+------------+
Productsè¡¨ï¼š
+------------+--------------+-------+
| product_id | product_name | price |
+------------+--------------+-------+
| 1          | keyboard     | 120   |
| 2          | mouse        | 80    |
| 3          | screen       | 600   |
| 4          | hard disk    | 450   |
+------------+--------------+-------+
è¾“å‡ºï¼š
+--------------+------------+----------+------------+
| product_name | product_id | order_id | order_date |
+--------------+------------+----------+------------+
| keyboard     | 1          | 6        | 2020-08-01 |
| keyboard     | 1          | 7        | 2020-08-01 |
| mouse        | 2          | 8        | 2020-08-03 |
| screen       | 3          | 3        | 2020-08-29 |
+--------------+------------+----------+------------+
è§£é‡Šï¼š
keyboard çš„æœ€æ–°è®¢å•åœ¨2020-08-01, åœ¨è¿™å¤©æœ‰ä¸¤æ¬¡ä¸‹å•.
mouse çš„æœ€æ–°è®¢å•åœ¨2020-08-03, åœ¨è¿™å¤©åªæœ‰ä¸€æ¬¡ä¸‹å•.
screen çš„æœ€æ–°è®¢å•åœ¨2020-08-29, åœ¨è¿™å¤©åªæœ‰ä¸€æ¬¡ä¸‹å•.
hard disk æ²¡æœ‰è¢«ä¸‹å•, æˆ‘ä»¬ä¸æŠŠå®ƒåŒ…å«åœ¨ç»“æœè¡¨ä¸­.
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">select a.product_name, a.product_id, b.order_id, b.order_date from Products a left join (select order_date, order_id, product_id, max(order_date) over(partition by product_id) as max_order from Orders)b on a.product_id = b.product_id where b.order_date = b.max_order order by product_name, product_id, order_id;
</code></pre>
<hr>
<h3 id="1532-æœ€è¿‘çš„ä¸‰ç¬”è®¢å•"><a href="#1532-æœ€è¿‘çš„ä¸‰ç¬”è®¢å•" class="headerlink" title="1532.æœ€è¿‘çš„ä¸‰ç¬”è®¢å•"></a>1532.æœ€è¿‘çš„ä¸‰ç¬”è®¢å•</h3><p>è¡¨ï¼š<code>Customers</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| customer_id   | int     |
| name          | varchar |
+---------------+---------+
customer_id æ˜¯è¯¥è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—
è¯¥è¡¨åŒ…å«æ¶ˆè´¹è€…çš„ä¿¡æ¯
</code></pre>
<p>è¡¨ï¼š<code>Orders</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| order_id      | int     |
| order_date    | date    |
| customer_id   | int     |
| cost          | int     |
+---------------+---------+
order_id æ˜¯è¯¥è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—
è¯¥è¡¨åŒ…å« id ä¸º customer_id çš„æ¶ˆè´¹è€…çš„è®¢å•ä¿¡æ¯
æ¯ä¸€ä¸ªæ¶ˆè´¹è€… æ¯å¤©ä¸€ç¬”è®¢å•
</code></pre>
<p>å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ‰¾åˆ°æ¯ä¸ªç”¨æˆ·çš„æœ€è¿‘ä¸‰ç¬”è®¢å•ã€‚å¦‚æœç”¨æˆ·çš„è®¢å•å°‘äº 3 ç¬”ï¼Œåˆ™è¿”å›ä»–çš„å…¨éƒ¨è®¢å•ã€‚</p>
<p>è¿”å›çš„ç»“æœæŒ‰ç…§ <code>customer_name</code> <strong>å‡åº</strong> æ’åˆ—ã€‚å¦‚æœæœ‰ç›¸åŒçš„æ’åï¼Œåˆ™æŒ‰ç…§ <code>customer_id</code> <strong>å‡åº</strong> æ’åˆ—ã€‚å¦‚æœæ’åè¿˜æœ‰ç›¸åŒï¼Œåˆ™æŒ‰ç…§ <code>order_date</code> <strong>é™åº</strong> æ’åˆ—ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Customers
+-------------+-----------+
| customer_id | name      |
+-------------+-----------+
| 1           | Winston   |
| 2           | Jonathan  |
| 3           | Annabelle |
| 4           | Marwan    |
| 5           | Khaled    |
+-------------+-----------+

Orders
+----------+------------+-------------+------+
| order_id | order_date | customer_id | cost |
+----------+------------+-------------+------+
| 1        | 2020-07-31 | 1           | 30   |
| 2        | 2020-07-30 | 2           | 40   |
| 3        | 2020-07-31 | 3           | 70   |
| 4        | 2020-07-29 | 4           | 100  |
| 5        | 2020-06-10 | 1           | 1010 |
| 6        | 2020-08-01 | 2           | 102  |
| 7        | 2020-08-01 | 3           | 111  |
| 8        | 2020-08-03 | 1           | 99   |
| 9        | 2020-08-07 | 2           | 32   |
| 10       | 2020-07-15 | 1           | 2    |
+----------+------------+-------------+------+
è¾“å‡ºï¼š
+---------------+-------------+----------+------------+
| customer_name | customer_id | order_id | order_date |
+---------------+-------------+----------+------------+
| Annabelle     | 3           | 7        | 2020-08-01 |
| Annabelle     | 3           | 3        | 2020-07-31 |
| Jonathan      | 2           | 9        | 2020-08-07 |
| Jonathan      | 2           | 6        | 2020-08-01 |
| Jonathan      | 2           | 2        | 2020-07-30 |
| Marwan        | 4           | 4        | 2020-07-29 |
| Winston       | 1           | 8        | 2020-08-03 |
| Winston       | 1           | 1        | 2020-07-31 |
| Winston       | 1           | 10       | 2020-07-15 |
+---------------+-------------+----------+------------+
è§£é‡Šï¼š
Winston æœ‰ 4 ç¬”è®¢å•, æ’é™¤äº† &quot;2020-06-10&quot; çš„è®¢å•, å› ä¸ºå®ƒæ˜¯æœ€è€çš„è®¢å•ã€‚
Annabelle åªæœ‰ 2 ç¬”è®¢å•, å…¨éƒ¨è¿”å›ã€‚
Jonathan æ°å¥½æœ‰ 3 ç¬”è®¢å•ã€‚
Marwan åªæœ‰ 1 ç¬”è®¢å•ã€‚
ç»“æœè¡¨æˆ‘ä»¬æŒ‰ç…§ customer_name å‡åºæ’åˆ—ï¼Œcustomer_id å‡åºæ’åˆ—ï¼Œorder_date é™åºæ’åˆ—ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">select a.name as customer_name, a.customer_id, b.order_id, b.order_date from Customers a left join (
select *, rank() over(partition by customer_id order by order_date DESC)as rk from Orders )b on 
a.customer_id = b.customer_id where rk &lt;= 3 order by customer_name, customer_id, order_date DESC;
</code></pre>
<hr>
<h3 id="1831-æ¯å¤©çš„æœ€å¤§äº¤æ˜“"><a href="#1831-æ¯å¤©çš„æœ€å¤§äº¤æ˜“" class="headerlink" title="1831.æ¯å¤©çš„æœ€å¤§äº¤æ˜“"></a>1831.æ¯å¤©çš„æœ€å¤§äº¤æ˜“</h3><p>è¡¨ï¼š<code>Transactions</code></p>
<pre><code>+----------------+----------+
| Column Name    | Type     |
+----------------+----------+
| transaction_id | int      |
| day            | datetime |
| amount         | int      |
+----------------+----------+
transaction_id æ˜¯è¯¥è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
æ¯è¡ŒåŒ…æ‹¬äº†è¯¥æ¬¡äº¤æ˜“çš„ä¿¡æ¯ã€‚
</code></pre>
<p>ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼ŒæŠ¥å‘Šæ¯å¤©äº¤æ˜“é‡‘é¢ <code>amount</code> <strong>æœ€å¤§</strong> çš„äº¤æ˜“ ID ã€‚å¦‚æœä¸€å¤©ä¸­æœ‰å¤šä¸ªè¿™æ ·çš„äº¤æ˜“ï¼Œè¿”å›è¿™äº›äº¤æ˜“çš„ ID ã€‚</p>
<p>è¿”å›ç»“æœæ ¹æ® <code>transaction_id</code> <strong>å‡åºæ’åˆ—</strong>ã€‚</p>
<p>è¿”å›æ ¼å¼å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Transactions table:
+----------------+--------------------+--------+
| transaction_id | day                | amount |
+----------------+--------------------+--------+
| 8              | 2021-4-3 15:57:28  | 57     |
| 9              | 2021-4-28 08:47:25 | 21     |
| 1              | 2021-4-29 13:28:30 | 58     |
| 5              | 2021-4-28 16:39:59 | 40     |
| 6              | 2021-4-29 23:39:28 | 58     |
+----------------+--------------------+--------+
è¾“å‡ºï¼š
+----------------+
| transaction_id |
+----------------+
| 1              |
| 5              |
| 6              |
| 8              |
+----------------+
è§£é‡Šï¼š
&quot;2021-4-3&quot;  --&gt; æœ‰ä¸€ä¸ª id æ˜¯ 8 çš„äº¤æ˜“ï¼Œå› æ­¤ï¼ŒæŠŠå®ƒåŠ å…¥ç»“æœè¡¨ã€‚ 
&quot;2021-4-28&quot; --&gt; æœ‰ä¸¤ä¸ªäº¤æ˜“ï¼Œid æ˜¯ 5 å’Œ 9 ï¼Œäº¤æ˜“ 5 çš„é‡‘é¢æ˜¯ 40 ï¼Œè€Œäº¤æ˜“ 9 çš„æ•°é‡æ˜¯ 21 ã€‚åªéœ€è¦å°†äº¤æ˜“ 5 åŠ å…¥ç»“æœè¡¨ï¼Œå› ä¸ºå®ƒæ˜¯å½“å¤©é‡‘é¢æœ€å¤§çš„äº¤æ˜“ã€‚
&quot;2021-4-29&quot; --&gt; æœ‰ä¸¤ä¸ªäº¤æ˜“ï¼Œid æ˜¯ 1 å’Œ 6 ï¼Œè¿™ä¸¤ä¸ªäº¤æ˜“çš„é‡‘é¢éƒ½æ˜¯ 58 ï¼Œå› æ­¤éœ€è¦æŠŠå®ƒä»¬éƒ½å†™å…¥ç»“æœè¡¨ã€‚
æœ€åï¼ŒæŠŠäº¤æ˜“ id æŒ‰ç…§å‡åºæ’åˆ—ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">select transaction_id from (
select *, rank() over(partition by DAY(day) order by amount DESC) as rk from Transactions)t 
where rk = 1 order by transaction_id;
</code></pre>
<hr>
<h3 id="1285-æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—"><a href="#1285-æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—" class="headerlink" title="1285.æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—"></a>1285.æ‰¾åˆ°è¿ç»­åŒºé—´çš„å¼€å§‹å’Œç»“æŸæ•°å­—</h3><p>è¡¨ï¼š<code>Logs</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| log_id        | int     |
+---------------+---------+
id æ˜¯ä¸Šè¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
ä¸Šè¡¨çš„æ¯ä¸€è¡ŒåŒ…å«æ—¥å¿—è¡¨ä¸­çš„ä¸€ä¸ª IDã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œå¾—åˆ° <code>Logs</code> è¡¨ä¸­çš„è¿ç»­åŒºé—´çš„å¼€å§‹æ•°å­—å’Œç»“æŸæ•°å­—ã€‚</p>
<p>è¿”å›ç»“æœè¡¨æŒ‰ç…§ <code>start_id</code> æ’åºã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Logs è¡¨ï¼š
+------------+
| log_id     |
+------------+
| 1          |
| 2          |
| 3          |
| 7          |
| 8          |
| 10         |
+------------+
è¾“å‡ºï¼š
+------------+--------------+
| start_id   | end_id       |
+------------+--------------+
| 1          | 3            |
| 7          | 8            |
| 10         | 10           |
+------------+--------------+
è§£é‡Šï¼š
ç»“æœè¡¨åº”åŒ…å« Logs è¡¨ä¸­çš„æ‰€æœ‰åŒºé—´ã€‚
ä» 1 åˆ° 3 åœ¨è¡¨ä¸­ã€‚
ä» 4 åˆ° 6 ä¸åœ¨è¡¨ä¸­ã€‚
ä» 7 åˆ° 8 åœ¨è¡¨ä¸­ã€‚
9 ä¸åœ¨è¡¨ä¸­ã€‚
10 åœ¨è¡¨ä¸­ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<p>è¿ç»­åŒºé—´ï¼šç”¨row_numberæ„é€ æ’åºæ•°å­—rkï¼Œç”¨log_idå‡å»rkå¾—å·®å€¼diffï¼Œç›¸åŒå·®å€¼diffä»£è¡¨åŒä¸€è¿ç»­åŒºé—´</p>
<pre><code class="language-sql">with base as(
    select *, row_number() over (order by log_id) as rk from Logs 
),
seq as(
    select log_id, log_id - rk as diff from base 
)
select distinct min(log_id)over (partition by diff) as start_id, max(log_id) over(partition by diff)as end_id from
seq; 
</code></pre>
<hr>
<h3 id="1596-æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“ï¼ˆæ˜“ï¼‰"><a href="#1596-æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“ï¼ˆæ˜“ï¼‰" class="headerlink" title="1596. æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“ï¼ˆæ˜“ï¼‰"></a>1596. æ¯ä½é¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“ï¼ˆæ˜“ï¼‰</h3><p>è¡¨ï¼š<code>Customers</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| customer_id   | int     |
| name          | varchar |
+---------------+---------+
customer_id æ˜¯è¯¥è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—
è¯¥è¡¨åŒ…å«æ‰€æœ‰é¡¾å®¢çš„ä¿¡æ¯
</code></pre>
<p>è¡¨ï¼š<code>Orders</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| order_id      | int     |
| order_date    | date    |
| customer_id   | int     |
| product_id    | int     |
+---------------+---------+
order_id æ˜¯è¯¥è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—
è¯¥è¡¨åŒ…å«é¡¾å®¢ customer_id çš„è®¢å•ä¿¡æ¯
æ²¡æœ‰é¡¾å®¢ä¼šåœ¨ä¸€å¤©å†…è®¢è´­ç›¸åŒçš„å•†å“ å¤šäºä¸€æ¬¡
</code></pre>
<p>è¡¨ï¼š<code>Products</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| product_id    | int     |
| product_name  | varchar |
| price         | int     |
+---------------+---------+
product_id æ˜¯è¯¥è¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—
è¯¥è¡¨åŒ…å«äº†æ‰€æœ‰å•†å“çš„ä¿¡æ¯
</code></pre>
<p>å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ‰¾åˆ°æ¯ä¸€ä¸ªé¡¾å®¢æœ€ç»å¸¸è®¢è´­çš„å•†å“ã€‚</p>
<p>ç»“æœè¡¨å•åº”è¯¥æœ‰æ¯ä¸€ä½è‡³å°‘ä¸‹è¿‡ä¸€æ¬¡å•çš„é¡¾å®¢ <code>customer_id</code> , ä»–æœ€ç»å¸¸è®¢è´­çš„å•†å“çš„ <code>product_id</code> å’Œ <code>product_name</code>ã€‚</p>
<p>è¿”å›ç»“æœ <strong>æ²¡æœ‰é¡ºåºè¦æ±‚</strong>ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Customersè¡¨ï¼š
+-------------+-------+
| customer_id | name  |
+-------------+-------+
| 1           | Alice |
| 2           | Bob   |
| 3           | Tom   |
| 4           | Jerry |
| 5           | John  |
+-------------+-------+
Ordersè¡¨ï¼š
+----------+------------+-------------+------------+
| order_id | order_date | customer_id | product_id |
+----------+------------+-------------+------------+
| 1        | 2020-07-31 | 1           | 1          |
| 2        | 2020-07-30 | 2           | 2          |
| 3        | 2020-08-29 | 3           | 3          |
| 4        | 2020-07-29 | 4           | 1          |
| 5        | 2020-06-10 | 1           | 2          |
| 6        | 2020-08-01 | 2           | 1          |
| 7        | 2020-08-01 | 3           | 3          |
| 8        | 2020-08-03 | 1           | 2          |
| 9        | 2020-08-07 | 2           | 3          |
| 10       | 2020-07-15 | 1           | 2          |
+----------+------------+-------------+------------+
Productsè¡¨ï¼š
+------------+--------------+-------+
| product_id | product_name | price |
+------------+--------------+-------+
| 1          | keyboard     | 120   |
| 2          | mouse        | 80    |
| 3          | screen       | 600   |
| 4          | hard disk    | 450   |
+------------+--------------+-------+
è¾“å‡ºï¼š
+-------------+------------+--------------+
| customer_id | product_id | product_name |
+-------------+------------+--------------+
| 1           | 2          | mouse        |
| 2           | 1          | keyboard     |
| 2           | 2          | mouse        |
| 2           | 3          | screen       |
| 3           | 3          | screen       |
| 4           | 1          | keyboard     |
+-------------+------------+--------------+
è§£é‡Šï¼š
Alice (customer 1) ä¸‰æ¬¡è®¢è´­é¼ æ ‡, ä¸€æ¬¡è®¢è´­é”®ç›˜, æ‰€ä»¥é¼ æ ‡æ˜¯ Alice æœ€ç»å¸¸è®¢è´­çš„å•†å“.
Bob (customer 2) ä¸€æ¬¡è®¢è´­é”®ç›˜, ä¸€æ¬¡è®¢è´­é¼ æ ‡, ä¸€æ¬¡è®¢è´­æ˜¾ç¤ºå™¨, æ‰€ä»¥è¿™äº›éƒ½æ˜¯ Bob æœ€ç»å¸¸è®¢è´­çš„å•†å“.
Tom (customer 3) åªä¸¤æ¬¡è®¢è´­æ˜¾ç¤ºå™¨, æ‰€ä»¥æ˜¾ç¤ºå™¨æ˜¯ Tom æœ€ç»å¸¸è®¢è´­çš„å•†å“.
Jerry (customer 4) åªä¸€æ¬¡è®¢è´­é”®ç›˜, æ‰€ä»¥é”®ç›˜æ˜¯ Jerry æœ€ç»å¸¸è®¢è´­çš„å•†å“.
John (customer 5) æ²¡æœ‰è®¢è´­è¿‡å•†å“, æ‰€ä»¥æˆ‘ä»¬å¹¶æ²¡æœ‰æŠŠ John åŒ…å«åœ¨ç»“æœè¡¨ä¸­.
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">
with base as(
    select customer_id, product_id, count(*) as ct from Orders group by customer_id, product_id
),
seq as(
    select *, rank() over (partition by customer_id order by ct DESC) as rk from base 
)
select a.customer_id, a.product_id, b.product_name from seq a left join Products b on a.product_id = b.product_id where rk = 1;
</code></pre>
<hr>
<h3 id="1709-è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ"><a href="#1709-è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ" class="headerlink" title="1709. è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ"></a>1709. è®¿é—®æ—¥æœŸä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸ</h3><p>è¡¨ï¼š <code>UserVisits</code></p>
<pre><code>+-------------+------+
| Column Name | Type |
+-------------+------+
| user_id     | int  |
| visit_date  | date |
+-------------+------+
è¯¥è¡¨æ²¡æœ‰ä¸»é”®ï¼Œå®ƒå¯èƒ½æœ‰é‡å¤çš„è¡Œ
è¯¥è¡¨åŒ…å«ç”¨æˆ·è®¿é—®æŸç‰¹å®šé›¶å”®å•†çš„æ—¥æœŸæ—¥å¿—ã€‚
</code></pre>
<p>å‡è®¾ä»Šå¤©çš„æ—¥æœŸæ˜¯ <code>&#39;2021-1-1&#39;</code> ã€‚</p>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œå¯¹äºæ¯ä¸ª <code>user_id</code> ï¼Œæ±‚å‡ºæ¯æ¬¡è®¿é—®åŠå…¶ä¸‹ä¸€ä¸ªè®¿é—®ï¼ˆè‹¥è¯¥æ¬¡è®¿é—®æ˜¯æœ€åä¸€æ¬¡ï¼Œåˆ™ä¸ºä»Šå¤©ï¼‰ä¹‹é—´æœ€å¤§çš„ç©ºæ¡£æœŸå¤©æ•° <code>window</code> ã€‚</p>
<p>è¿”å›ç»“æœè¡¨ï¼ŒæŒ‰ç”¨æˆ·ç¼–å· <code>user_id</code> æ’åºã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
UserVisits è¡¨ï¼š
+---------+------------+
| user_id | visit_date |
+---------+------------+
| 1       | 2020-11-28 |
| 1       | 2020-10-20 |
| 1       | 2020-12-3  |
| 2       | 2020-10-5  |
| 2       | 2020-12-9  |
| 3       | 2020-11-11 |
+---------+------------+
è¾“å‡ºï¼š
+---------+---------------+
| user_id | biggest_window|
+---------+---------------+
| 1       | 39            |
| 2       | 65            |
| 3       | 51            |
+---------+---------------+
è§£é‡Šï¼š
å¯¹äºç¬¬ä¸€ä¸ªç”¨æˆ·ï¼Œé—®é¢˜ä¸­çš„ç©ºæ¡£æœŸåœ¨ä»¥ä¸‹æ—¥æœŸä¹‹é—´ï¼š
    - 2020-10-20 è‡³ 2020-11-28 ï¼Œå…±è®¡ 39 å¤©ã€‚
    - 2020-11-28 è‡³ 2020-12-3 ï¼Œå…±è®¡ 5 å¤©ã€‚
    - 2020-12-3 è‡³ 2021-1-1 ï¼Œå…±è®¡ 29 å¤©ã€‚
ç”±æ­¤å¾—å‡ºï¼Œæœ€å¤§çš„ç©ºæ¡£æœŸä¸º 39 å¤©ã€‚
å¯¹äºç¬¬äºŒä¸ªç”¨æˆ·ï¼Œé—®é¢˜ä¸­çš„ç©ºæ¡£æœŸåœ¨ä»¥ä¸‹æ—¥æœŸä¹‹é—´ï¼š
    - 2020-10-5 è‡³ 2020-12-9 ï¼Œå…±è®¡ 65 å¤©ã€‚
    - 2020-12-9 è‡³ 2021-1-1 ï¼Œå…±è®¡ 23 å¤©ã€‚
ç”±æ­¤å¾—å‡ºï¼Œæœ€å¤§çš„ç©ºæ¡£æœŸä¸º 65 å¤©ã€‚
å¯¹äºç¬¬ä¸‰ä¸ªç”¨æˆ·ï¼Œé—®é¢˜ä¸­çš„å”¯ä¸€ç©ºæ¡£æœŸåœ¨ 2020-11-11 è‡³ 2021-1-1 ä¹‹é—´ï¼Œå…±è®¡ 51 å¤©ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">with base as(
    select user_id, visit_date, IFNULL(lead(visit_date, 1) over (partition by user_id order by visit_date), &#39;2021-1-1&#39;)as next_date from UserVisits 
),
seq as (
    select *, datediff(next_date, visit_date) as diff from base 
)
select distinct user_id, diff as biggest_window from (
    select user_id, diff, max(diff) over(partition by user_id) as mx_diff from seq)t where diff = mx_diff;
</code></pre>
<hr>
<h3 id="1270-å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº"><a href="#1270-å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº" class="headerlink" title="1270. å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº"></a>1270. å‘å…¬å¸CEOæ±‡æŠ¥å·¥ä½œçš„æ‰€æœ‰äºº</h3><p>å‘˜å·¥è¡¨ï¼š<code>Employees</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| employee_id   | int     |
| employee_name | varchar |
| manager_id    | int     |
+---------------+---------+
employee_id æ˜¯è¿™ä¸ªè¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
è¿™ä¸ªè¡¨ä¸­æ¯ä¸€è¡Œä¸­ï¼Œemployee_id è¡¨ç¤ºèŒå·¥çš„ IDï¼Œemployee_name è¡¨ç¤ºèŒå·¥çš„åå­—ï¼Œmanager_id è¡¨ç¤ºè¯¥èŒå·¥æ±‡æŠ¥å·¥ä½œçš„ç›´çº¿ç»ç†ã€‚
è¿™ä¸ªå…¬å¸ CEO æ˜¯ employee_id = 1 çš„äººã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ‰€æœ‰ç›´æ¥æˆ–é—´æ¥å‘å…¬å¸ CEO æ±‡æŠ¥å·¥ä½œçš„èŒå·¥çš„ <code>employee_id</code> ã€‚</p>
<p>ç”±äºå…¬å¸è§„æ¨¡è¾ƒå°ï¼Œç»ç†ä¹‹é—´çš„é—´æ¥å…³ç³» <strong>ä¸è¶…è¿‡ 3 ä¸ªç»ç†</strong> ã€‚</p>
<p>å¯ä»¥ä»¥ <strong>ä»»ä½•é¡ºåº</strong> è¿”å›æ— é‡å¤é¡¹çš„ç»“æœã€‚</p>
<p>è¿”å›ç»“æœç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Employees table:
+-------------+---------------+------------+
| employee_id | employee_name | manager_id |
+-------------+---------------+------------+
| 1           | Boss          | 1          |
| 3           | Alice         | 3          |
| 2           | Bob           | 1          |
| 4           | Daniel        | 2          |
| 7           | Luis          | 4          |
| 8           | Jhon          | 3          |
| 9           | Angela        | 8          |
| 77          | Robert        | 1          |
+-------------+---------------+------------+
è¾“å‡ºï¼š
+-------------+
| employee_id |
+-------------+
| 2           |
| 77          |
| 4           |
| 7           |
+-------------+
è§£é‡Šï¼š
å…¬å¸ CEO çš„ employee_id æ˜¯ 1.
employee_id æ˜¯ 2 å’Œ 77 çš„èŒå‘˜ç›´æ¥æ±‡æŠ¥ç»™å…¬å¸ CEOã€‚
employee_id æ˜¯ 4 çš„èŒå‘˜é—´æ¥æ±‡æŠ¥ç»™å…¬å¸ CEO 4 --&gt; 2 --&gt; 1 ã€‚
employee_id æ˜¯ 7 çš„èŒå‘˜é—´æ¥æ±‡æŠ¥ç»™å…¬å¸ CEO 7 --&gt; 4 --&gt; 2 --&gt; 1 ã€‚
employee_id æ˜¯ 3, 8 ï¼Œ9 çš„èŒå‘˜ä¸ä¼šç›´æ¥æˆ–é—´æ¥çš„æ±‡æŠ¥ç»™å…¬å¸ CEOã€‚ 
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">with base1 as (
    select employee_id from Employees where manager_id = 1 and employee_id != 1
),
base as(
    select a.employee_id from Employees a join base1 b on a.manager_id = b.employee_id
)
select c.employee_id from Employees c join base d on c.manager_id = d.employee_id
union all 
select * from base
union all 
select * from base1;
</code></pre>
<p>è¡¥å……ï¼š</p>
<p>å°†nullè½¬åŒ–ä¸º0â€”â€”&gt;IFNULL(a.column, 0)</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        <span class="icon">
            <i class="fa-solid fa-tags fa-fw"></i>
        </span>
        
        
        
        <span class="tag">
            
            <a href="/tags/Leetcode/" style="color: #03a9f4">Leetcode</a>
        </span>
        
    </div>
    <a href="/2021/09/09/Leetcode%20%20sql%E9%A2%98%E7%9B%AE%E8%AE%B0%E5%BD%952/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>


        <div class="page-current">
    
    <a class="page-num" href="/">
        <i class="fa-solid fa-caret-left fa-fw"></i>
    </a>
    <a class="page-num" href="/">1</a>
    <span class="page-omit">...</span>
    
    <span class="current">2</span>
    
    
    
    
</div>

    </div>
    
    <div id="home-card">
        <div id="card-style">
    <div id="card-div">
        <div class="avatar">
            <img src="/images/pic.jpg" alt="avatar" />
        </div>
        <div class="name">KING BOB</div>
        <div class="description">
            <p>Description<br>â€¦</p>

        </div>
        
        
        <div class="friend-links">
            
            <div class="friend-link">
                <a target="_blank" rel="noopener" href="https://argvchs.github.io">Argvchs</a>
            </div>
            
        </div>
        
    </div>
</div>

    </div>
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2025 - 2025 KING!BOB!
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;KING BOB
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    <canvas
    id="fireworks"
    style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767"
></canvas>
<script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<script src="/js/fireworks.min.js"></script>
    <canvas
    id="background"
    style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1"
></canvas>
<script src="/js/background.min.js"></script>
    
<!-- hexo injector body_end start --><script data-pjax src="https://unpkg.com/oh-my-live2d"></script><script>const oml2d = OML2D.loadOml2d({dockedPosition:"right",mobileDisplay:true,models:[{"path":"https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json","mobilePosition":[-10,23],"mobileScale":0.1,"mobileStageStyle":{"width":180,"height":166},"motionPreloadStrategy":"IDLE","position":[-10,35],"scale":0.15,"stageStyle":{"width":250,"height":250}},{"path":"https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json","scale":0.12,"position":[0,0],"stageStyle":{"width":250},"mobileScale":0.08,"mobilePosition":[0,0],"mobileStageStyle":{"width":180}},{"path":"https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json","scale":0.12,"position":[0,0],"mobileScale":0.08,"mobilePosition":[0,0],"mobileStageStyle":{"width":180},"stageStyle":{"width":250}}],parentElement:document.body,primaryColor:"var(--btn-bg)",sayHello:false,tips:{style: {"width":230,"height":120,"left":"calc(50% - 20px)","top":"-100px"},mobileStyle: {"width":180,"height":80,"left":"calc(50% - 30px)","top":"-100px"},idleTips:{interval:15000,message:function(){
  return axios.get('https://v1.hitokoto.cn?c=i')
    .then(function (response) {
      return response.data.hitokoto ;
    })
    .catch(function (error) {
      console.error(error);
    });
}
}}});</script><!-- hexo injector body_end end --></body>
</html>
