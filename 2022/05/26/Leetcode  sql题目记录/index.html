
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>Leetcode sqlé¢˜ç›®è®°å½• | KING!BOB!</title>
    <meta name="author" content="KING BOB" />
    <meta name="description" content="LET'S MAKE IT HAPPEN" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/pic.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜ æµè§ˆå™¨é»˜è®¤å¼€å¯</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>KING!BOB!</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;KING!BOB!</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1>Leetcode sqlé¢˜ç›®è®°å½•</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2022/5/26
        </span>
        
        <span class="category">
            <a href="/categories/Leetcode/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Leetcode
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/Leetcode/" style="color: #03a9f4">
                    Leetcode
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/SQL/" style="color: #ffa2c4">
                    SQL
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <h2 id="Leetcode-sqlé¢˜ç›®è®°å½•"><a href="#Leetcode-sqlé¢˜ç›®è®°å½•" class="headerlink" title="Leetcode  sqlé¢˜ç›®è®°å½•"></a>Leetcode  sqlé¢˜ç›®è®°å½•</h2><p>æœ¬åšå®¢ä»…è®°å½•**é«˜é¢‘ SQL 50 é¢˜ï¼ˆåŸºç¡€ç‰ˆï¼‰**ä¸­çš„ä¸­ç­‰éš¾åº¦é¢˜ç›®ï¼Œåç»­ä¸å®šæœŸæ›´æ–°</p>
<h3 id="570-è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†"><a href="#570-è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†" class="headerlink" title="570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†"></a>570. è‡³å°‘æœ‰5åç›´æ¥ä¸‹å±çš„ç»ç†</h3><p>è¡¨: <code>Employee</code></p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| name        | varchar |
| department  | varchar |
| managerId   | int     |
+-------------+---------+
id æ˜¯æ­¤è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œè¡¨ç¤ºé›‡å‘˜çš„åå­—ã€ä»–ä»¬çš„éƒ¨é—¨å’Œä»–ä»¬çš„ç»ç†çš„idã€‚
å¦‚æœmanagerIdä¸ºç©ºï¼Œåˆ™è¯¥å‘˜å·¥æ²¡æœ‰ç»ç†ã€‚
æ²¡æœ‰å‘˜å·¥ä¼šæˆä¸ºè‡ªå·±çš„ç®¡ç†è€…ã€‚
</code></pre>
<p>ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºè‡³å°‘æœ‰<strong>äº”ä¸ªç›´æ¥ä¸‹å±</strong>çš„ç»ç†ã€‚</p>
<p>ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥: 
Employee è¡¨:
+-----+-------+------------+-----------+
| id  | name  | department | managerId |
+-----+-------+------------+-----------+
| 101 | John  | A          | Null      |
| 102 | Dan   | A          | 101       |
| 103 | James | A          | 101       |
| 104 | Amy   | A          | 101       |
| 105 | Anne  | A          | 101       |
| 106 | Ron   | B          | 101       |
+-----+-------+------------+-----------+
è¾“å‡º: 
+------+
| name |
+------+
| John |
+------+
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">select a.name from Employee a join Employee b on a.id = b.managerId group by a.id having count(*) &gt;= 5;
</code></pre>
<p>æ²¡æœ‰ <code>GROUP BY</code><br> <code>HAVING</code> æ˜¯å¯¹<strong>åˆ†ç»„åçš„ç»“æœ</strong>è¿‡æ»¤çš„ã€‚ä½ æ²¡åˆ†ç»„æ—¶ï¼ŒMySQLæŠŠæ•´å¼ ç»“æœé›†å½“æˆ<strong>ä¸€ä¸ªå¤§ç»„</strong>ï¼Œ<code>COUNT(a.id)</code> ç»Ÿè®¡çš„æ˜¯<strong>æ‰€æœ‰ç»ç†â€“ä¸‹å±é…å¯¹çš„æ€»è¡Œæ•°</strong>ï¼Œä¸æ˜¯â€œæ¯ä¸ªç»ç†çš„ä¸‹å±æ•°â€ã€‚å› æ­¤å½“æµ‹è¯•æ•°æ®é‡Œåªæœ‰ä¸€ä¸ªç»ç†ä¸”åˆšå¥½æœ‰ 5 ä¸ªä¸‹å±æ—¶çœ‹èµ·æ¥â€œæ­£ç¡®â€ï¼Œä½†åªè¦æœ‰ä¸¤ä¸ªç»ç†ï¼Œåˆè®¡è¡Œæ•° â‰¥5ï¼Œä½ è¿™å¥å°±ä¼šæŠŠä¸¤ä½ç»ç†éƒ½æ”¾è¿›ç»“æœé‡Œï¼Œç”šè‡³è¿˜ä¼šé‡å¤å¤šè¡Œã€‚</p>
<hr>
<h3 id="1934-ç¡®è®¤ç‡"><a href="#1934-ç¡®è®¤ç‡" class="headerlink" title="1934. ç¡®è®¤ç‡"></a>1934. ç¡®è®¤ç‡</h3><p>è¡¨: <code>Signups</code></p>
<pre><code>+----------------+----------+
| Column Name    | Type     |
+----------------+----------+
| user_id        | int      |
| time_stamp     | datetime |
+----------------+----------+
User_idæ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
æ¯ä¸€è¡Œéƒ½åŒ…å«IDä¸ºuser_idçš„ç”¨æˆ·çš„æ³¨å†Œæ—¶é—´ä¿¡æ¯ã€‚
</code></pre>
<p>è¡¨: <code>Confirmations</code></p>
<pre><code>+----------------+----------+
| Column Name    | Type     |
+----------------+----------+
| user_id        | int      |
| time_stamp     | datetime |
| action         | ENUM     |
+----------------+----------+
(user_id, time_stamp)æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
user_idæ˜¯ä¸€ä¸ªå¼•ç”¨åˆ°æ³¨å†Œè¡¨çš„å¤–é”®ã€‚
actionæ˜¯ç±»å‹ä¸º(&#39;confirmed&#39;ï¼Œ &#39;timeout&#39;)çš„ENUM
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºIDä¸ºuser_idçš„ç”¨æˆ·åœ¨time_stampè¯·æ±‚äº†ä¸€æ¡ç¡®è®¤æ¶ˆæ¯ï¼Œè¯¥ç¡®è®¤æ¶ˆæ¯è¦ä¹ˆè¢«ç¡®è®¤(&#39;confirmed&#39;)ï¼Œè¦ä¹ˆè¢«è¿‡æœŸ(&#39;timeout&#39;)ã€‚
</code></pre>
<p>ç”¨æˆ·çš„ <strong>ç¡®è®¤ç‡</strong> æ˜¯ <code>&#39;confirmed&#39;</code> æ¶ˆæ¯çš„æ•°é‡é™¤ä»¥è¯·æ±‚çš„ç¡®è®¤æ¶ˆæ¯çš„æ€»æ•°ã€‚æ²¡æœ‰è¯·æ±‚ä»»ä½•ç¡®è®¤æ¶ˆæ¯çš„ç”¨æˆ·çš„ç¡®è®¤ç‡ä¸º <code>0</code> ã€‚ç¡®è®¤ç‡å››èˆäº”å…¥åˆ° <strong>å°æ•°ç‚¹åä¸¤ä½</strong> ã€‚</p>
<p>ç¼–å†™ä¸€ä¸ªSQLæŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªç”¨æˆ·çš„ ç¡®è®¤ç‡ ã€‚</p>
<p>ä»¥ ä»»æ„é¡ºåº è¿”å›ç»“æœè¡¨ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Signups è¡¨:
+---------+---------------------+
| user_id | time_stamp          |
+---------+---------------------+
| 3       | 2020-03-21 10:16:13 |
| 7       | 2020-01-04 13:57:59 |
| 2       | 2020-07-29 23:09:44 |
| 6       | 2020-12-09 10:39:37 |
+---------+---------------------+
Confirmations è¡¨:
+---------+---------------------+-----------+
| user_id | time_stamp          | action    |
+---------+---------------------+-----------+
| 3       | 2021-01-06 03:30:46 | timeout   |
| 3       | 2021-07-14 14:00:00 | timeout   |
| 7       | 2021-06-12 11:57:29 | confirmed |
| 7       | 2021-06-13 12:58:28 | confirmed |
| 7       | 2021-06-14 13:59:27 | confirmed |
| 2       | 2021-01-22 00:00:00 | confirmed |
| 2       | 2021-02-28 23:59:59 | timeout   |
+---------+---------------------+-----------+
è¾“å‡º: 
+---------+-------------------+
| user_id | confirmation_rate |
+---------+-------------------+
| 6       | 0.00              |
| 3       | 0.00              |
| 7       | 1.00              |
| 2       | 0.50              |
+---------+-------------------+
è§£é‡Š:
ç”¨æˆ· 6 æ²¡æœ‰è¯·æ±‚ä»»ä½•ç¡®è®¤æ¶ˆæ¯ã€‚ç¡®è®¤ç‡ä¸º 0ã€‚
ç”¨æˆ· 3 è¿›è¡Œäº† 2 æ¬¡è¯·æ±‚ï¼Œéƒ½è¶…æ—¶äº†ã€‚ç¡®è®¤ç‡ä¸º 0ã€‚
ç”¨æˆ· 7 æå‡ºäº† 3 ä¸ªè¯·æ±‚ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¾—åˆ°äº†ç¡®è®¤ã€‚ç¡®è®¤ç‡ä¸º 1ã€‚
ç”¨æˆ· 2 åšäº† 2 ä¸ªè¯·æ±‚ï¼Œå…¶ä¸­ä¸€ä¸ªè¢«ç¡®è®¤ï¼Œå¦ä¸€ä¸ªè¶…æ—¶ã€‚ç¡®è®¤ç‡ä¸º 1 / 2 = 0.5ã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">WITH base AS (
  SELECT 
    user_id,
    COUNT(*) AS total,
    SUM(CASE WHEN action = &#39;confirmed&#39; THEN 1 ELSE 0 END) AS confirmed
  FROM Confirmations
  GROUP BY user_id
)
SELECT 
  s.user_id,
  ROUND(IFNULL(b.confirmed / b.total, 0), 2) AS confirmation_rate
FROM Signups s
LEFT JOIN base b
  ON s.user_id = b.user_id;
</code></pre>
<hr>
<h3 id="1193-æ¯æœˆäº¤æ˜“I"><a href="#1193-æ¯æœˆäº¤æ˜“I" class="headerlink" title="1193. æ¯æœˆäº¤æ˜“I"></a>1193. æ¯æœˆäº¤æ˜“I</h3><p>è¡¨ï¼š<code>Transactions</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| id            | int     |
| country       | varchar |
| state         | enum    |
| amount        | int     |
| trans_date    | date    |
+---------------+---------+
id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨åŒ…å«æœ‰å…³ä¼ å…¥äº‹åŠ¡çš„ä¿¡æ¯ã€‚
state åˆ—ç±»å‹ä¸º [&quot;approved&quot;, &quot;declined&quot;] ä¹‹ä¸€ã€‚
</code></pre>
<p>ç¼–å†™ä¸€ä¸ª sql æŸ¥è¯¢æ¥æŸ¥æ‰¾æ¯ä¸ªæœˆå’Œæ¯ä¸ªå›½å®¶&#x2F;åœ°åŒºçš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€å·²æ‰¹å‡†çš„äº‹åŠ¡æ•°åŠå…¶æ€»é‡‘é¢ã€‚</p>
<p>ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Transactions table:
+------+---------+----------+--------+------------+
| id   | country | state    | amount | trans_date |
+------+---------+----------+--------+------------+
| 121  | US      | approved | 1000   | 2018-12-18 |
| 122  | US      | declined | 2000   | 2018-12-19 |
| 123  | US      | approved | 2000   | 2019-01-01 |
| 124  | DE      | approved | 2000   | 2019-01-07 |
+------+---------+----------+--------+------------+
è¾“å‡ºï¼š
+----------+---------+-------------+----------------+--------------------+-----------------------+
| month    | country | trans_count | approved_count | trans_total_amount | approved_total_amount |
+----------+---------+-------------+----------------+--------------------+-----------------------+
| 2018-12  | US      | 2           | 1              | 3000               | 1000                  |
| 2019-01  | US      | 1           | 1              | 2000               | 2000                  |
| 2019-01  | DE      | 1           | 1              | 2000               | 2000                  |
+----------+---------+-------------+----------------+--------------------+-----------------------+
</code></pre>
<p>è§£ç­”ï¼š</p>
<p>å¤šä¸ª CTE ç”¨ <code>WITH a AS (...), b AS (...)</code>ã€‚</p>
<p>æŒ‰ <code>monthã€country</code> åˆ†ç»„ï¼›<code>approved</code> ç›¸å…³ç”¨ <code>CASE WHEN</code> è®¡æ•°&#x2F;æ±‚å’Œã€‚</p>
<p>å–æœˆä»½ç”¨ <code>DATE_FORMAT(trans_date, &#39;%Y-%m&#39;)</code> æ›´ç¨³å¦¥ã€‚</p>
<p><strong>DATE_FORMAT(â€¦, â€˜%y-%mâ€™)ï¼šç»“æœæ˜¯20-02ï¼Œè‹¥æ˜¯â€™%Y-%mï¼Œç»“æœæ˜¯2020-02ï¼Œè‹¥æ˜¯â€™%Y-%Mï¼Œç»“æœæ˜¯2020-Febraryâ€™</strong></p>
<pre><code class="language-sql">WITH base AS (
  SELECT
    DATE_FORMAT(trans_date, &#39;%Y-%m&#39;) AS month,
    country,
    state,
    amount
  FROM Transactions
),
seq AS (
  SELECT
    month,
    country,
    COUNT(*) AS trans_count,
    SUM(CASE WHEN state = &#39;approved&#39; THEN 1 ELSE 0 END) AS approved_count,
    SUM(amount) AS trans_total_amount,
    SUM(CASE WHEN state = &#39;approved&#39; THEN amount ELSE 0 END) AS approved_total_amount
  FROM base
  GROUP BY month, country
)
SELECT *
FROM seq;
</code></pre>
<hr>
<h3 id="1174-å³æ—¶é£Ÿç‰©é…é€II"><a href="#1174-å³æ—¶é£Ÿç‰©é…é€II" class="headerlink" title="1174. å³æ—¶é£Ÿç‰©é…é€II"></a>1174. å³æ—¶é£Ÿç‰©é…é€II</h3><p>é…é€è¡¨: <code>Delivery</code></p>
<pre><code>+-----------------------------+---------+
| Column Name                 | Type    |
+-----------------------------+---------+
| delivery_id                 | int     |
| customer_id                 | int     |
| order_date                  | date    |
| customer_pref_delivery_date | date    |
+-----------------------------+---------+
delivery_id æ˜¯è¯¥è¡¨ä¸­å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
è¯¥è¡¨ä¿å­˜ç€é¡¾å®¢çš„é£Ÿç‰©é…é€ä¿¡æ¯ï¼Œé¡¾å®¢åœ¨æŸä¸ªæ—¥æœŸä¸‹äº†è®¢å•ï¼Œå¹¶æŒ‡å®šäº†ä¸€ä¸ªæœŸæœ›çš„é…é€æ—¥æœŸï¼ˆå’Œä¸‹å•æ—¥æœŸç›¸åŒæˆ–è€…åœ¨é‚£ä¹‹åï¼‰ã€‚
</code></pre>
<p>å¦‚æœé¡¾å®¢æœŸæœ›çš„é…é€æ—¥æœŸå’Œä¸‹å•æ—¥æœŸç›¸åŒï¼Œåˆ™è¯¥è®¢å•ç§°ä¸º ã€Œ<strong>å³æ—¶è®¢å•</strong>ã€ï¼Œå¦åˆ™ç§°ä¸ºã€Œ<strong>è®¡åˆ’è®¢å•</strong>ã€ã€‚</p>
<p>ã€Œ<strong>é¦–æ¬¡è®¢å•</strong>ã€æ˜¯é¡¾å®¢æœ€æ—©åˆ›å»ºçš„è®¢å•ã€‚æˆ‘ä»¬ä¿è¯ä¸€ä¸ªé¡¾å®¢åªä¼šæœ‰ä¸€ä¸ªã€Œé¦–æ¬¡è®¢å•ã€ã€‚</p>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆä»¥è·å–å³æ—¶è®¢å•åœ¨æ‰€æœ‰ç”¨æˆ·çš„é¦–æ¬¡è®¢å•ä¸­çš„æ¯”ä¾‹ã€‚<strong>ä¿ç•™ä¸¤ä½å°æ•°ã€‚</strong></p>
<p>ç»“æœç¤ºä¾‹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Delivery è¡¨ï¼š
+-------------+-------------+------------+-----------------------------+
| delivery_id | customer_id | order_date | customer_pref_delivery_date |
+-------------+-------------+------------+-----------------------------+
| 1           | 1           | 2019-08-01 | 2019-08-02                  |
| 2           | 2           | 2019-08-02 | 2019-08-02                  |
| 3           | 1           | 2019-08-11 | 2019-08-12                  |
| 4           | 3           | 2019-08-24 | 2019-08-24                  |
| 5           | 3           | 2019-08-21 | 2019-08-22                  |
| 6           | 2           | 2019-08-11 | 2019-08-13                  |
| 7           | 4           | 2019-08-09 | 2019-08-09                  |
+-------------+-------------+------------+-----------------------------+
è¾“å‡ºï¼š
+----------------------+
| immediate_percentage |
+----------------------+
| 50.00                |
+----------------------+
è§£é‡Šï¼š
1 å·é¡¾å®¢çš„ 1 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯è®¡åˆ’è®¢å•ã€‚
2 å·é¡¾å®¢çš„ 2 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯å³æ—¶è®¢å•ã€‚
3 å·é¡¾å®¢çš„ 5 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯è®¡åˆ’è®¢å•ã€‚
4 å·é¡¾å®¢çš„ 7 å·è®¢å•æ˜¯é¦–æ¬¡è®¢å•ï¼Œå¹¶ä¸”æ˜¯å³æ—¶è®¢å•ã€‚
å› æ­¤ï¼Œä¸€åŠé¡¾å®¢çš„é¦–æ¬¡è®¢å•æ˜¯å³æ—¶çš„ã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">with base as (
select *, row_number() over(partition by customer_id order by order_date) as rn 
from Delivery),
seq as (
    select round((sum(case when customer_pref_delivery_date = order_date then 1 else 0 end) / count(*)) * 100, 2) as immediate_percentage from base where rn = 1
)
select * from seq;
</code></pre>
<hr>
<h3 id="176-ç¬¬äºŒé«˜çš„è–ªæ°´"><a href="#176-ç¬¬äºŒé«˜çš„è–ªæ°´" class="headerlink" title="176. ç¬¬äºŒé«˜çš„è–ªæ°´"></a>176. ç¬¬äºŒé«˜çš„è–ªæ°´</h3><p><code>Employee</code> è¡¨ï¼š</p>
<pre><code>+-------------+------+
| Column Name | Type |
+-------------+------+
| id          | int  |
| salary      | int  |
+-------------+------+
id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
è¡¨çš„æ¯ä¸€è¡ŒåŒ…å«å‘˜å·¥çš„å·¥èµ„ä¿¡æ¯ã€‚
</code></pre>
<p>æŸ¥è¯¢å¹¶è¿”å› <code>Employee</code> è¡¨ä¸­ç¬¬äºŒé«˜çš„ <strong>ä¸åŒ</strong> è–ªæ°´ ã€‚å¦‚æœä¸å­˜åœ¨ç¬¬äºŒé«˜çš„è–ªæ°´ï¼ŒæŸ¥è¯¢åº”è¯¥è¿”å› <code>null(Pandas åˆ™è¿”å› None)</code> ã€‚</p>
<p>æŸ¥è¯¢ç»“æœå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Employee è¡¨ï¼š
+----+--------+
| id | salary |
+----+--------+
| 1  | 100    |
| 2  | 200    |
| 3  | 300    |
+----+--------+
è¾“å‡ºï¼š
+---------------------+
| SecondHighestSalary |
+---------------------+
| 200                 |
+---------------------+
</code></pre>
<p><strong>ç¤ºä¾‹ 2ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Employee è¡¨ï¼š
+----+--------+
| id | salary |
+----+--------+
| 1  | 100    |
+----+--------+
è¾“å‡ºï¼š
+---------------------+
| SecondHighestSalary |
+---------------------+
| null                |
+---------------------+
</code></pre>
<p>è§£ç­”</p>
<pre><code class="language-sql">SELECT MAX(salary) AS SecondHighestSalary
FROM (
  SELECT DISTINCT salary,
         DENSE_RANK() OVER (ORDER BY salary DESC) AS rk
  FROM Employee
) t
WHERE rk = 2;
</code></pre>
<h4 id="ï¼ˆ1ï¼‰-å­æŸ¥è¯¢ä¸ºç©ºä½†å¤–å±‚ç”¨äº†èšåˆå‡½æ•°"><a href="#ï¼ˆ1ï¼‰-å­æŸ¥è¯¢ä¸ºç©ºä½†å¤–å±‚ç”¨äº†èšåˆå‡½æ•°" class="headerlink" title="ï¼ˆ1ï¼‰ å­æŸ¥è¯¢ä¸ºç©ºä½†å¤–å±‚ç”¨äº†èšåˆå‡½æ•°"></a>ï¼ˆ1ï¼‰ å­æŸ¥è¯¢ä¸ºç©ºä½†å¤–å±‚ç”¨äº†èšåˆå‡½æ•°</h4><p>SQL çš„å®šä¹‰æ˜¯ï¼šèšåˆå‡½æ•°å¯¹ç©ºè¾“å…¥æ—¶ï¼Œè¿”å› <strong>NULL</strong>ã€‚<br> ä¾‹å­ï¼š</p>
<pre><code class="language-sql">SELECT MAX(salary) FROM (SELECT 1 AS salary WHERE 1=0) t;
</code></pre>
<p><code>(SELECT 1 WHERE 1=0)</code> ä¸ºç©ºè¡¨ â†’ <code>MAX</code> æ²¡æœ‰ä»»ä½•å€¼å¯æ¯”è¾ƒ â†’ è¿”å› <code>NULL</code>ã€‚</p>
<p>æ‰€ä»¥è¿™å°±æ˜¯ä¸ºä»€ä¹ˆâ€œç¬¬äºŒé«˜è–ªæ°´ä¸å­˜åœ¨â€æ—¶ <code>MAX</code> å¯ä»¥å¸®æˆ‘ä»¬è‡ªåŠ¨è¿”å› <code>NULL</code>ã€‚</p>
<hr>
<h4 id="ï¼ˆ2ï¼‰å­æŸ¥è¯¢ä¸ºç©ºè€Œå¤–å±‚æ²¡æœ‰èšåˆå‡½æ•°"><a href="#ï¼ˆ2ï¼‰å­æŸ¥è¯¢ä¸ºç©ºè€Œå¤–å±‚æ²¡æœ‰èšåˆå‡½æ•°" class="headerlink" title="ï¼ˆ2ï¼‰å­æŸ¥è¯¢ä¸ºç©ºè€Œå¤–å±‚æ²¡æœ‰èšåˆå‡½æ•°"></a>ï¼ˆ2ï¼‰å­æŸ¥è¯¢ä¸ºç©ºè€Œå¤–å±‚æ²¡æœ‰èšåˆå‡½æ•°</h4><p>å¦‚æœä½ ç›´æ¥ï¼š</p>
<pre><code class="language-sql">SELECT salary 
FROM (SELECT salary WHERE 1=0) t;
</code></pre>
<p>é‚£ç»“æœå°±æ˜¯ <strong>0 è¡Œ</strong>ï¼ˆå³ç›´æ¥è¿”å›ç©ºç»“æœé›†ï¼Œä¸ä¼šè‡ªåŠ¨ç»™ä½ ä¸€è¡Œ <code>NULL</code>ï¼‰ã€‚</p>
<hr>
<h3 id="550-æ¸¸æˆç©æ³•åˆ†æIV"><a href="#550-æ¸¸æˆç©æ³•åˆ†æIV" class="headerlink" title="550. æ¸¸æˆç©æ³•åˆ†æIV"></a>550. æ¸¸æˆç©æ³•åˆ†æIV</h3><p>Table: <code>Activity</code></p>
<pre><code>+--------------+---------+
| Column Name  | Type    |
+--------------+---------+
| player_id    | int     |
| device_id    | int     |
| event_date   | date    |
| games_played | int     |
+--------------+---------+
ï¼ˆplayer_idï¼Œevent_dateï¼‰æ˜¯æ­¤è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆï¼‰ã€‚
è¿™å¼ è¡¨æ˜¾ç¤ºäº†æŸäº›æ¸¸æˆçš„ç©å®¶çš„æ´»åŠ¨æƒ…å†µã€‚
æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªç©å®¶çš„è®°å½•ï¼Œä»–åœ¨æŸä¸€å¤©ä½¿ç”¨æŸä¸ªè®¾å¤‡æ³¨é”€ä¹‹å‰ç™»å½•å¹¶ç©äº†å¾ˆå¤šæ¸¸æˆï¼ˆå¯èƒ½æ˜¯ 0ï¼‰ã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼ŒæŠ¥å‘Šåœ¨é¦–æ¬¡ç™»å½•çš„ç¬¬äºŒå¤©å†æ¬¡ç™»å½•çš„ç©å®¶çš„ <strong>æ¯”ç‡</strong>ï¼Œ<strong>å››èˆäº”å…¥åˆ°å°æ•°ç‚¹åä¸¤ä½</strong>ã€‚æ¢å¥è¯è¯´ï¼Œä½ éœ€è¦è®¡ç®—ä»é¦–æ¬¡ç™»å½•åçš„ç¬¬äºŒå¤©ç™»å½•çš„ç©å®¶æ•°é‡ï¼Œå¹¶å°†å…¶é™¤ä»¥æ€»ç©å®¶æ•°ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Activity table:
+-----------+-----------+------------+--------------+
| player_id | device_id | event_date | games_played |
+-----------+-----------+------------+--------------+
| 1         | 2         | 2016-03-01 | 5            |
| 1         | 2         | 2016-03-02 | 6            |
| 2         | 3         | 2017-06-25 | 1            |
| 3         | 1         | 2016-03-02 | 0            |
| 3         | 4         | 2018-07-03 | 5            |
+-----------+-----------+------------+--------------+
è¾“å‡ºï¼š
+-----------+
| fraction  |
+-----------+
| 0.33      |
+-----------+
è§£é‡Šï¼š
åªæœ‰ ID ä¸º 1 çš„ç©å®¶åœ¨ç¬¬ä¸€å¤©ç™»å½•åæ‰é‡æ–°ç™»å½•ï¼Œæ‰€ä»¥ç­”æ¡ˆæ˜¯ 1/3 = 0.33
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql"># Write your MySQL query statement below
with base as(
    select *,min(event_date) over(partition by player_id)as first from Activity
),
seq as(
    select player_id, sum(case when datediff(event_date, first) = 1 then 1 else 0 end) as rn from base
    group by player_id
)
select round(IFNULL((sum(rn) / count(distinct player_id)), 0), 2) as fraction from seq;
</code></pre>
<p>æ³¨æ„ï¼š</p>
<ol>
<li>åœ¨ä½¿ç”¨with base as(), seq as() select from seqæ—¶ï¼Œè¦è®°å¾—æ¯ä¸ªåµŒå¥—å†…éƒ¨çš„selectå¾ˆé‡è¦ï¼Œå‰ä¸€ä¸ªselectéœ€è¦åŒ…å«åä¸€ä¸ªselectçš„å†…å®¹ã€‚</li>
<li>ä½¿ç”¨èšåˆå‡½æ•°min,max,countåç»“æœä¼šè¢«å‹ç¼©ï¼Œå¦‚æœåç»­è¦åŒè¡Œå¯¹æœ€å¤§ã€æœ€å°è¿›è¡Œæ¯”è¾ƒï¼Œè¦ä½¿ç”¨çª—å£å‡½æ•°å½¢å¼çš„max,minâ€¦</li>
</ol>
<hr>
<h3 id="1045-ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·"><a href="#1045-ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·" class="headerlink" title="1045. ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·"></a>1045. ä¹°ä¸‹æ‰€æœ‰äº§å“çš„å®¢æˆ·</h3><p><code>Customer</code> è¡¨ï¼š</p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| customer_id | int     |
| product_key | int     |
+-------------+---------+
è¯¥è¡¨å¯èƒ½åŒ…å«é‡å¤çš„è¡Œã€‚
customer_id ä¸ä¸º NULLã€‚
product_key æ˜¯ Product è¡¨çš„å¤–é”®(reference åˆ—)ã€‚
</code></pre>
<p><code>Product</code> è¡¨ï¼š</p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| product_key | int     |
+-------------+---------+
product_key æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ï¼‰ã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼ŒæŠ¥å‘Š <code>Customer</code> è¡¨ä¸­è´­ä¹°äº† <code>Product</code> è¡¨ä¸­æ‰€æœ‰äº§å“çš„å®¢æˆ·çš„ idã€‚</p>
<p>è¿”å›ç»“æœè¡¨ <strong>æ— é¡ºåºè¦æ±‚</strong> ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Customer è¡¨ï¼š
+-------------+-------------+
| customer_id | product_key |
+-------------+-------------+
| 1           | 5           |
| 2           | 6           |
| 3           | 5           |
| 3           | 6           |
| 1           | 6           |
+-------------+-------------+
Product è¡¨ï¼š
+-------------+
| product_key |
+-------------+
| 5           |
| 6           |
+-------------+
è¾“å‡ºï¼š
+-------------+
| customer_id |
+-------------+
| 1           |
| 3           |
+-------------+
è§£é‡Šï¼š
è´­ä¹°äº†æ‰€æœ‰äº§å“ï¼ˆ5 å’Œ 6ï¼‰çš„å®¢æˆ·çš„ id æ˜¯ 1 å’Œ 3 ã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<ol>
<li><strong><code>WHERE DISTINCT</code> æ˜¯éæ³•è¯­æ³•</strong>ã€‚<code>DISTINCT</code> åªèƒ½æ”¾åœ¨ <code>SELECT</code> æˆ– <code>COUNT(DISTINCT ...)</code> é‡Œé¢ï¼Œä¸èƒ½ç›´æ¥æ”¾åœ¨ <code>WHERE</code>ã€‚</li>
<li>é¢˜ç›®è¦æ±‚çš„æ˜¯â€œä¹°äº†æ‰€æœ‰äº§å“çš„é¡¾å®¢â€ï¼Œæ‰€ä»¥åº”è¯¥æ¯”è¾ƒé¡¾å®¢ä¹°åˆ°çš„ <strong>å»é‡åäº§å“æ•°</strong> å’Œ <strong>Product è¡¨é‡Œçš„äº§å“æ€»æ•°</strong>ã€‚</li>
</ol>
<pre><code class="language-sql">SELECT customer_id
FROM Customer
GROUP BY customer_id
HAVING COUNT(DISTINCT product_key) = (
    SELECT COUNT(*) FROM Product
);
</code></pre>
<p>è§£é‡Šä¸€ä¸‹ï¼š</p>
<ul>
<li><code>GROUP BY customer_id</code>ï¼šæŒ‰é¡¾å®¢åˆ†ç»„ã€‚</li>
<li><code>COUNT(DISTINCT product_key)</code>ï¼šç»Ÿè®¡è¯¥é¡¾å®¢ä¹°äº†å¤šå°‘ç§ä¸åŒçš„äº§å“ã€‚</li>
<li>å­æŸ¥è¯¢ <code>(SELECT COUNT(*) FROM Product)</code>ï¼šç»Ÿè®¡æ€»å…±æœ‰å¤šå°‘ç§äº§å“ã€‚</li>
<li><code>HAVING ... = ...</code>ï¼šç­›é€‰å‡ºä¹°å…¨æ‰€æœ‰äº§å“çš„é¡¾å®¢ã€‚</li>
</ul>
<hr>
<h3 id="180-è¿ç»­å‡ºç°çš„æ•°å­—"><a href="#180-è¿ç»­å‡ºç°çš„æ•°å­—" class="headerlink" title="180. è¿ç»­å‡ºç°çš„æ•°å­—"></a>180. è¿ç»­å‡ºç°çš„æ•°å­—</h3><p>è¡¨ï¼š<code>Logs</code></p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| num         | varchar |
+-------------+---------+
åœ¨ SQL ä¸­ï¼Œid æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
id æ˜¯ä¸€ä¸ªè‡ªå¢åˆ—ã€‚
</code></pre>
<p>æ‰¾å‡ºæ‰€æœ‰è‡³å°‘è¿ç»­å‡ºç°ä¸‰æ¬¡çš„æ•°å­—ã€‚</p>
<p>è¿”å›çš„ç»“æœè¡¨ä¸­çš„æ•°æ®å¯ä»¥æŒ‰ <strong>ä»»æ„é¡ºåº</strong> æ’åˆ—ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤ºï¼š</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Logs è¡¨ï¼š
+----+-----+
| id | num |
+----+-----+
| 1  | 1   |
| 2  | 1   |
| 3  | 1   |
| 4  | 2   |
| 5  | 1   |
| 6  | 2   |
| 7  | 2   |
+----+-----+
è¾“å‡ºï¼š
Result è¡¨ï¼š
+-----------------+
| ConsecutiveNums |
+-----------------+
| 1               |
+-----------------+
è§£é‡Šï¼š1 æ˜¯å”¯ä¸€è¿ç»­å‡ºç°è‡³å°‘ä¸‰æ¬¡çš„æ•°å­—ã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">with base as(
    select *, row_number() over(partition by num order by id) as rn from Logs
),
seq as(
    select *, id - rn as diff from base 
),
rpq as (
    select num, count(*) as ct from seq group by num, diff having count(*) &gt;= 3
)
select distinct num as ConsecutiveNums from rpq;
</code></pre>
<p><strong>æœ‰æ—¶å€™ä¸è¦å¿˜è®°distinct</strong></p>
<hr>
<h3 id="1164-æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼"><a href="#1164-æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼" class="headerlink" title="1164. æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼"></a>1164. æŒ‡å®šæ—¥æœŸçš„äº§å“ä»·æ ¼</h3><p>äº§å“æ•°æ®è¡¨: <code>Products</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| product_id    | int     |
| new_price     | int     |
| change_date   | date    |
+---------------+---------+
(product_id, change_date) æ˜¯æ­¤è¡¨çš„ä¸»é”®ï¼ˆå…·æœ‰å”¯ä¸€å€¼çš„åˆ—ç»„åˆï¼‰ã€‚
è¿™å¼ è¡¨çš„æ¯ä¸€è¡Œåˆ†åˆ«è®°å½•äº† æŸäº§å“ åœ¨æŸä¸ªæ—¥æœŸ æ›´æ”¹å çš„æ–°ä»·æ ¼ã€‚
</code></pre>
<p>ä¸€å¼€å§‹ï¼Œæ‰€æœ‰äº§å“ä»·æ ¼éƒ½ä¸º 10ã€‚</p>
<p>ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºåœ¨ <code>2019-08-16</code> æ‰€æœ‰äº§å“çš„ä»·æ ¼ã€‚</p>
<p>ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Products è¡¨:
+------------+-----------+-------------+
| product_id | new_price | change_date |
+------------+-----------+-------------+
| 1          | 20        | 2019-08-14  |
| 2          | 50        | 2019-08-14  |
| 1          | 30        | 2019-08-15  |
| 1          | 35        | 2019-08-16  |
| 2          | 65        | 2019-08-17  |
| 3          | 20        | 2019-08-18  |
+------------+-----------+-------------+
è¾“å‡ºï¼š
+------------+-------+
| product_id | price |
+------------+-------+
| 2          | 50    |
| 1          | 35    |
| 3          | 10    |
+------------+-------+
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">with base as(
    select *, row_number()over (partition by product_id order by change_date DESC) as rn from Products where change_date &lt;= &#39;2019-08-16&#39;
),
seq as (
    select product_id, new_price as price from base where rn = 1
)
select product_id, price from seq union all select distinct product_id, 10 as price from (
    select product_id, min(change_date) as mi from Products group by product_id
)t  where mi &gt; &#39;2019-08-16&#39;;
</code></pre>
<p>å½’çº³ï¼š<br>æƒ³è¦å¾—åˆ°æŸä¸€åˆ—çš„æœ€å¤§æœ€å°å€¼ï¼Œå¹¶ç”¨å…¶ä¸æŸä¸ªæ•°è¿›è¡Œæ¯”è¾ƒï¼Œéœ€è¦å…ˆmaxã€minï¼ˆçª—å£æˆ–è€…èšåˆå‡½æ•°ï¼‰ï¼Œç„¶åå†ç­‰å€¼æŸ¥è¯¢ï¼Œæˆ–è€…rownumberé…åˆASCã€DESCï¼Œç„¶åå†åç»­æŸ¥è¯¢ä¸­ä½¿ç”¨rn&#x3D;1ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨order by+limit</p>
<h4 id="ï¼ˆ1ï¼‰éç›¸å…³å­æŸ¥è¯¢-ç­‰å€¼æ¯”è¾ƒ"><a href="#ï¼ˆ1ï¼‰éç›¸å…³å­æŸ¥è¯¢-ç­‰å€¼æ¯”è¾ƒ" class="headerlink" title="ï¼ˆ1ï¼‰éç›¸å…³å­æŸ¥è¯¢ + ç­‰å€¼æ¯”è¾ƒ"></a>ï¼ˆ1ï¼‰éç›¸å…³å­æŸ¥è¯¢ + ç­‰å€¼æ¯”è¾ƒ</h4><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<strong>å…¨å±€åªæœ‰ä¸€ä¸ªæœ€å€¼</strong>ï¼ˆæ•´ä¸ªè¡¨çš„æœ€å¤§å€¼&#x2F;æœ€å°å€¼ï¼‰ï¼Œä¸ä¾èµ–åˆ†ç»„ã€‚</p>
<ul>
<li>ç‰¹ç‚¹ï¼šå­æŸ¥è¯¢è¿”å›å•è¡Œï¼Œå¯ä»¥ç›´æ¥ç”¨ <code>=</code> æ¯”è¾ƒã€‚</li>
<li>ç¤ºä¾‹ï¼šæ‰¾å‡ºå·¥èµ„æœ€é«˜çš„å‘˜å·¥</li>
</ul>
<pre><code class="language-sql">select *
from Employee
where salary = (select max(salary) from Employee);
</code></pre>
<hr>
<h4 id="ï¼ˆ2ï¼‰ç›¸å…³å­æŸ¥è¯¢"><a href="#ï¼ˆ2ï¼‰ç›¸å…³å­æŸ¥è¯¢" class="headerlink" title="ï¼ˆ2ï¼‰ç›¸å…³å­æŸ¥è¯¢"></a>ï¼ˆ2ï¼‰ç›¸å…³å­æŸ¥è¯¢</h4><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<strong>åˆ†ç»„åçš„æœ€å€¼</strong>ï¼ˆæ¯ä¸ªå®¢æˆ·&#x2F;éƒ¨é—¨çš„æœ€å°&#x2F;æœ€å¤§æ—¥æœŸï¼‰ï¼Œå¤–å±‚è¡¨çš„æ¡ä»¶ä¾èµ–å­æŸ¥è¯¢ã€‚</p>
<ul>
<li>ç‰¹ç‚¹ï¼šå­æŸ¥è¯¢é‡Œéœ€è¦å¼•ç”¨å¤–å±‚çš„åˆ—ï¼Œæ¯è¡Œæ‰§è¡Œä¸€æ¬¡ï¼Œä¿è¯è¿”å›å•è¡Œã€‚</li>
<li>ç¤ºä¾‹ï¼šæ‰¾æ¯ä¸ªå®¢æˆ·çš„é¦–å•</li>
</ul>
<pre><code class="language-sql">select *
from Delivery d1
where order_date = (
  select min(order_date)
  from Delivery d2
  where d2.customer_id = d1.customer_id
);
</code></pre>
<p>è¿™é‡Œå­æŸ¥è¯¢é‡Œçš„ <code>d2.customer_id = d1.customer_id</code> ç»‘å®šäº†å¤–å±‚æŸ¥è¯¢çš„ <code>d1.customer_id</code>ã€‚</p>
<p>æ¯æ¬¡å¤–å±‚å–ä¸€è¡Œï¼Œå­æŸ¥è¯¢å°±åªè®¡ç®—è¯¥å®¢æˆ·çš„æœ€å°è®¢å•æ—¥æœŸã€‚</p>
<p>ä¹Ÿå¯ä»¥å†™æˆè¿™ç§å½¢å¼ï¼š</p>
<pre><code class="language-sql">select *
from (
  select customer_id, min(order_date)
  from Delivery 
  group by customer_id
)t ;
</code></pre>
<hr>
<h4 id="ï¼ˆ3ï¼‰çª—å£å‡½æ•°-æ¡ä»¶ç­›é€‰"><a href="#ï¼ˆ3ï¼‰çª—å£å‡½æ•°-æ¡ä»¶ç­›é€‰" class="headerlink" title="ï¼ˆ3ï¼‰çª—å£å‡½æ•° + æ¡ä»¶ç­›é€‰"></a>ï¼ˆ3ï¼‰çª—å£å‡½æ•° + æ¡ä»¶ç­›é€‰</h4><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼šæ•°æ®åº“æ”¯æŒçª—å£å‡½æ•°ï¼ˆMySQL 8+ &#x2F; PostgreSQL &#x2F; Oracle &#x2F; SQL Serverï¼‰ï¼Œ<strong>éœ€è¦æŒ‰ç»„å–å‰å‡ å&#x2F;æœ€å€¼ã€‚</strong></p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨maxã€minçš„çª—å£å‡½æ•°å½¢å¼æ¥è·å–æ¯ä¸ªç»„åˆ«çš„æœ€å€¼</p>
<ul>
<li>ç‰¹ç‚¹ï¼šå†™æ³•ç®€æ´ï¼Œå¯åŒæ—¶ä¿ç•™åˆ†ç»„å†…æ’åºä¿¡æ¯ã€‚</li>
<li>ç¤ºä¾‹ï¼šæ‰¾æ¯ä¸ªå®¢æˆ·çš„é¦–å•</li>
</ul>
<pre><code class="language-sql">with t as (
  select *,
         row_number() over(partition by customer_id order by order_date) as rn
  from Delivery
)
select *
from t
where rn = 1;
</code></pre>
<ul>
<li>å¦‚æœè¦å¤„ç†å¹¶åˆ—æƒ…å†µï¼Œå¯ä»¥ç”¨ <code>rank()</code> æˆ– <code>dense_rank()</code>ã€‚</li>
</ul>
<hr>
<h4 id="ï¼ˆ4ï¼‰ORDER-BY-LIMIT"><a href="#ï¼ˆ4ï¼‰ORDER-BY-LIMIT" class="headerlink" title="ï¼ˆ4ï¼‰ORDER BY + LIMIT"></a>ï¼ˆ4ï¼‰ORDER BY + LIMIT</h4><p><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<strong>åªéœ€è¦å…¨è¡¨èŒƒå›´å†…çš„æœ€å€¼</strong>ï¼Œä¸”åªå–å‰ N æ¡ï¼ˆä¸åˆ†ç»„ï¼‰ã€‚</p>
<ul>
<li>ç‰¹ç‚¹ï¼šç®€å•é«˜æ•ˆï¼Œä½†æ— æ³•ç›´æ¥åº”å¯¹ã€Œæ¯ç»„æœ€å€¼ã€é—®é¢˜ã€‚</li>
<li>ç¤ºä¾‹ï¼šæ‰¾å·¥èµ„æœ€é«˜çš„å‘˜å·¥ï¼ˆTop 1ï¼‰</li>
</ul>
<pre><code class="language-sql">select *
from Employee
order by salary desc
limit 1;
</code></pre>
<ul>
<li>å¦‚æœéœ€è¦æ¯ç»„æœ€å€¼ï¼Œå°±ä¸é€‚åˆï¼Œåªèƒ½é…åˆçª—å£å‡½æ•°æˆ–å­æŸ¥è¯¢ã€‚</li>
</ul>
<hr>
<h4 id="å¯¹æ¯”æ€»ç»“"><a href="#å¯¹æ¯”æ€»ç»“" class="headerlink" title="å¯¹æ¯”æ€»ç»“"></a>å¯¹æ¯”æ€»ç»“</h4><table>
<thead>
<tr>
<th>æ–¹æ³•</th>
<th>é€‚ç”¨åœºæ™¯</th>
<th>ä¼˜ç‚¹</th>
<th>å±€é™</th>
</tr>
</thead>
<tbody><tr>
<td><strong>éç›¸å…³å­æŸ¥è¯¢</strong></td>
<td>å…¨è¡¨å”¯ä¸€æœ€å€¼</td>
<td>ç®€å•</td>
<td>åªèƒ½å¤„ç†å•ä¸ªå…¨å±€æœ€å€¼</td>
</tr>
<tr>
<td><strong>ç›¸å…³å­æŸ¥è¯¢</strong></td>
<td>æ¯ç»„æœ€å€¼ï¼ˆéœ€è¦ä¾èµ–å¤–å±‚æ¡ä»¶ï¼‰</td>
<td>é€šç”¨ï¼Œä¸è¦æ±‚çª—å£å‡½æ•°</td>
<td>å­æŸ¥è¯¢å¤šæ¬¡æ‰§è¡Œï¼Œæ€§èƒ½è¾ƒå·®</td>
</tr>
<tr>
<td><strong>çª—å£å‡½æ•°</strong></td>
<td>æ¯ç»„æœ€å€¼&#x2F;å‰ N ä¸ª</td>
<td>é«˜æ•ˆç®€æ´ï¼Œç°ä»£ SQL æ¨è</td>
<td>éœ€è¦æ•°æ®åº“æ”¯æŒçª—å£å‡½æ•°</td>
</tr>
<tr>
<td><strong>ORDER BY + LIMIT</strong></td>
<td>å…¨è¡¨å‰ N ä¸ª</td>
<td>ç®€æ´é«˜æ•ˆ</td>
<td>ä¸èƒ½åˆ†ç»„ï¼Œåªèƒ½å¤„ç†å…¨å±€æœ€å€¼</td>
</tr>
</tbody></table>
<hr>
<p>ğŸ‘‰ å¿«é€Ÿè®°å¿†ï¼š</p>
<ul>
<li><strong>å…¨å±€æœ€å€¼</strong> â†’ éç›¸å…³å­æŸ¥è¯¢ æˆ– <code>order by + limit</code></li>
<li><strong>åˆ†ç»„æœ€å€¼</strong> â†’ ç›¸å…³å­æŸ¥è¯¢ æˆ– çª—å£å‡½æ•°</li>
<li><strong>è¦å‰ N å&#x2F;å¹¶åˆ—æƒ…å†µ</strong> â†’ çª—å£å‡½æ•°æœ€ä½³</li>
</ul>
<hr>
<h3 id="1204-æœ€åä¸€ä¸ªèƒ½è¿›å…¥å·´å£«çš„äºº"><a href="#1204-æœ€åä¸€ä¸ªèƒ½è¿›å…¥å·´å£«çš„äºº" class="headerlink" title="1204.æœ€åä¸€ä¸ªèƒ½è¿›å…¥å·´å£«çš„äºº"></a>1204.æœ€åä¸€ä¸ªèƒ½è¿›å…¥å·´å£«çš„äºº</h3><p>è¡¨: <code>Queue</code></p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| person_id   | int     |
| person_name | varchar |
| weight      | int     |
| turn        | int     |
+-------------+---------+
person_id æ˜¯è¿™ä¸ªè¡¨å…·æœ‰å”¯ä¸€å€¼çš„åˆ—ã€‚
è¯¥è¡¨å±•ç¤ºäº†æ‰€æœ‰å€™è½¦ä¹˜å®¢çš„ä¿¡æ¯ã€‚
è¡¨ä¸­ person_id å’Œ turn åˆ—å°†åŒ…å«ä» 1 åˆ° n çš„æ‰€æœ‰æ•°å­—ï¼Œå…¶ä¸­ n æ˜¯è¡¨ä¸­çš„è¡Œæ•°ã€‚
turn å†³å®šäº†å€™è½¦ä¹˜å®¢ä¸Šå·´å£«çš„é¡ºåºï¼Œå…¶ä¸­ turn=1 è¡¨ç¤ºç¬¬ä¸€ä¸ªä¸Šå·´å£«ï¼Œturn=n è¡¨ç¤ºæœ€åä¸€ä¸ªä¸Šå·´å£«ã€‚
weight è¡¨ç¤ºå€™è½¦ä¹˜å®¢çš„ä½“é‡ï¼Œä»¥åƒå…‹ä¸ºå•ä½ã€‚
</code></pre>
<p>æœ‰ä¸€é˜Ÿä¹˜å®¢åœ¨ç­‰ç€ä¸Šå·´å£«ã€‚ç„¶è€Œï¼Œå·´å£«æœ‰<code>1000</code> <strong>åƒå…‹</strong> çš„é‡é‡é™åˆ¶ï¼Œæ‰€ä»¥å…¶ä¸­ä¸€éƒ¨åˆ†ä¹˜å®¢å¯èƒ½æ— æ³•ä¸Šå·´å£«ã€‚</p>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆæ‰¾å‡º <strong>æœ€åä¸€ä¸ª</strong> ä¸Šå·´å£«ä¸”ä¸è¶…è¿‡é‡é‡é™åˆ¶çš„ä¹˜å®¢ï¼Œå¹¶æŠ¥å‘Š <code>person_name</code> ã€‚é¢˜ç›®æµ‹è¯•ç”¨ä¾‹ç¡®ä¿é¡ºä½ç¬¬ä¸€çš„äººå¯ä»¥ä¸Šå·´å£«ä¸”ä¸ä¼šè¶…é‡ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Queue è¡¨
+-----------+-------------+--------+------+
| person_id | person_name | weight | turn |
+-----------+-------------+--------+------+
| 5         | Alice       | 250    | 1    |
| 4         | Bob         | 175    | 5    |
| 3         | Alex        | 350    | 2    |
| 6         | John Cena   | 400    | 3    |
| 1         | Winston     | 500    | 6    |
| 2         | Marie       | 200    | 4    |
+-----------+-------------+--------+------+
è¾“å‡ºï¼š
+-------------+
| person_name |
+-------------+
| John Cena   |
+-------------+
è§£é‡Šï¼š
ä¸ºäº†ç®€åŒ–ï¼ŒQueue è¡¨æŒ‰ turn åˆ—ç”±å°åˆ°å¤§æ’åºã€‚
+------+----+-----------+--------+--------------+
| Turn | ID | Name      | Weight | Total Weight |
+------+----+-----------+--------+--------------+
| 1    | 5  | Alice     | 250    | 250          |
| 2    | 3  | Alex      | 350    | 600          |
| 3    | 6  | John Cena | 400    | 1000         | (æœ€åä¸€ä¸ªä¸Šå·´å£«)
| 4    | 2  | Marie     | 200    | 1200         | (æ— æ³•ä¸Šå·´å£«)
| 5    | 4  | Bob       | 175    | ___          |
| 6    | 1  | Winston   | 500    | ___          |
+------+----+-----------+--------+--------------+
</code></pre>
<p>è§£ç­”ï¼š</p>
<p><strong>PSï¼šSQL èšåˆå‡½æ•°ï¼ˆå¦‚ <code>MAX()</code>ï¼‰å’Œæ™®é€šåˆ—ä¹‹é—´æ²¡æœ‰è‡ªåŠ¨çš„â€œè¡Œå¯¹é½â€å…³ç³»ã€‚</strong></p>
<p>ä¸èƒ½ç›´æ¥å†™æˆï¼ï¼š</p>
<pre><code class="language-sql">select person_name, max(total_weight) from (
    select * , sum(weight)over (order by turn) as total_weight from Queue
)t where total_weight &lt;= 1000;

-- ç»“æœåªä¼šè¿”å›
| person_id | person_name | weight | turn |
| --------- | ----------- | ------ | ---- |
| 5         | Alice       | 250    | 1    |
| 4         | Bob         | 175    | 5    |
| 3         | Alex        | 350    | 2    |
| 6         | John Cena   | 400    | 3    |
| 1         | Winston     | 500    | 6    |
| 2         | Marie       | 200    | 4    |

| person_name | max(total_weight) |
| ----------- | ----------------- |
| Alice       | 1000              |

-- è€Œä¸æ˜¯æ­£ç¡®è¾“å‡º
| person_name |
| ----------- |
| John Cena   |
</code></pre>
<h4 id="ï¼ˆ1ï¼‰å­æŸ¥è¯¢-ç­‰å€¼è¿‡æ»¤"><a href="#ï¼ˆ1ï¼‰å­æŸ¥è¯¢-ç­‰å€¼è¿‡æ»¤" class="headerlink" title="ï¼ˆ1ï¼‰å­æŸ¥è¯¢+ç­‰å€¼è¿‡æ»¤"></a>ï¼ˆ1ï¼‰å­æŸ¥è¯¢+ç­‰å€¼è¿‡æ»¤</h4><pre><code class="language-sql"># Write your MySQL query statement below
with base as(
    select * , sum(weight)over (order by turn) as total_weight from Queue
)
select person_name from base where total_weight = (
    select max(total_weight) as mx from base where total_weight &lt;= 1000
);
</code></pre>
<hr>
<h4 id="ï¼ˆ2ï¼‰ORDER-BY-LIMIT"><a href="#ï¼ˆ2ï¼‰ORDER-BY-LIMIT" class="headerlink" title="ï¼ˆ2ï¼‰ORDER BY+LIMIT"></a>ï¼ˆ2ï¼‰ORDER BY+LIMIT</h4><pre><code class="language-sql"># Write your MySQL query statement below
select person_name from (
    select * , sum(weight)over (order by turn) as total_weight from Queue
)t where total_weight &lt;= 1000 order by total_weight DESC limit 1;
</code></pre>
<hr>
<h3 id="1907-æŒ‰åˆ†ç±»ç»Ÿè®¡è–ªæ°´"><a href="#1907-æŒ‰åˆ†ç±»ç»Ÿè®¡è–ªæ°´" class="headerlink" title="1907. æŒ‰åˆ†ç±»ç»Ÿè®¡è–ªæ°´"></a>1907. æŒ‰åˆ†ç±»ç»Ÿè®¡è–ªæ°´</h3><p>è¡¨: <code>Accounts</code></p>
<pre><code>+-------------+------+
| åˆ—å        | ç±»å‹  |
+-------------+------+
| account_id  | int  |
| income      | int  |
+-------------+------+
åœ¨ SQL ä¸­ï¼Œaccount_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®ã€‚
æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€ä¸ªé“¶è¡Œå¸æˆ·çš„æœˆæ”¶å…¥çš„ä¿¡æ¯ã€‚
</code></pre>
<p>æŸ¥è¯¢æ¯ä¸ªå·¥èµ„ç±»åˆ«çš„é“¶è¡Œè´¦æˆ·æ•°é‡ã€‚ å·¥èµ„ç±»åˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>&quot;Low Salary&quot;</code>ï¼šæ‰€æœ‰å·¥èµ„ <strong>ä¸¥æ ¼ä½äº</strong> <code>20000</code> ç¾å…ƒã€‚</li>
<li><code>&quot;Average Salary&quot;</code>ï¼š <strong>åŒ…å«</strong> èŒƒå›´å†…çš„æ‰€æœ‰å·¥èµ„ <code>[$20000, $50000]</code> ã€‚</li>
<li><code>&quot;High Salary&quot;</code>ï¼šæ‰€æœ‰å·¥èµ„ <strong>ä¸¥æ ¼å¤§äº</strong> <code>50000</code> ç¾å…ƒã€‚</li>
</ul>
<p>ç»“æœè¡¨ <strong>å¿…é¡»</strong> åŒ…å«æ‰€æœ‰ä¸‰ä¸ªç±»åˆ«ã€‚ å¦‚æœæŸä¸ªç±»åˆ«ä¸­æ²¡æœ‰å¸æˆ·ï¼Œåˆ™æŠ¥å‘Š <code>0</code> ã€‚</p>
<p>æŒ‰ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ç»“æœè¡¨ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ç¤ºä¾‹ã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Accounts è¡¨:
+------------+--------+
| account_id | income |
+------------+--------+
| 3          | 108939 |
| 2          | 12747  |
| 8          | 87709  |
| 6          | 91796  |
+------------+--------+
è¾“å‡ºï¼š
+----------------+----------------+
| category       | accounts_count |
+----------------+----------------+
| Low Salary     | 1              |
| Average Salary | 0              |
| High Salary    | 3              |
+----------------+----------------+
è§£é‡Šï¼š
ä½è–ª: æœ‰ä¸€ä¸ªè´¦æˆ· 2.
ä¸­ç­‰è–ªæ°´: æ²¡æœ‰.
é«˜è–ª: æœ‰ä¸‰ä¸ªè´¦æˆ·ï¼Œä»–ä»¬æ˜¯ 3, 6å’Œ 8.
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">select &#39;Low Salary&#39; as category, sum(case when income &lt; 20000 then 1 else 0 end) as accounts_count
from Accounts
Union all
select &#39;Average Salary&#39; as category, sum(case when income &gt;= 20000 and income &lt;= 50000 then 1 else 0 end) as accounts_count
from Accounts
Union all
select &#39;High Salary&#39; as category, sum(case when income &gt; 50000 then 1 else 0 end) as accounts_count
from Accounts;
</code></pre>
<hr>
<h3 id="626-æ¢åº§ä½"><a href="#626-æ¢åº§ä½" class="headerlink" title="626. æ¢åº§ä½"></a>626. æ¢åº§ä½</h3><p>è¡¨: <code>Seat</code></p>
<pre><code>+-------------+---------+
| Column Name | Type    |
+-------------+---------+
| id          | int     |
| student     | varchar |
+-------------+---------+
id æ˜¯è¯¥è¡¨çš„ä¸»é”®ï¼ˆå”¯ä¸€å€¼ï¼‰åˆ—ã€‚
è¯¥è¡¨çš„æ¯ä¸€è¡Œéƒ½è¡¨ç¤ºå­¦ç”Ÿçš„å§“åå’Œ IDã€‚
ID åºåˆ—å§‹ç»ˆä» 1 å¼€å§‹å¹¶è¿ç»­å¢åŠ ã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆæ¥äº¤æ¢æ¯ä¸¤ä¸ªè¿ç»­çš„å­¦ç”Ÿçš„åº§ä½å·ã€‚å¦‚æœå­¦ç”Ÿçš„æ•°é‡æ˜¯å¥‡æ•°ï¼Œåˆ™æœ€åä¸€ä¸ªå­¦ç”Ÿçš„idä¸äº¤æ¢ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥: 
Seat è¡¨:
+----+---------+
| id | student |
+----+---------+
| 1  | Abbot   |
| 2  | Doris   |
| 3  | Emerson |
| 4  | Green   |
| 5  | Jeames  |
+----+---------+
è¾“å‡º: 
+----+---------+
| id | student |
+----+---------+
| 1  | Doris   |
| 2  | Abbot   |
| 3  | Green   |
| 4  | Emerson |
| 5  | Jeames  |
+----+---------+
è§£é‡Š:
è¯·æ³¨æ„ï¼Œå¦‚æœå­¦ç”Ÿäººæ•°ä¸ºå¥‡æ•°ï¼Œåˆ™ä¸éœ€è¦æ›´æ¢æœ€åä¸€åå­¦ç”Ÿçš„åº§ä½ã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<h4 id="ï¼ˆ1ï¼‰åµŒå¥—æŸ¥è¯¢"><a href="#ï¼ˆ1ï¼‰åµŒå¥—æŸ¥è¯¢" class="headerlink" title="ï¼ˆ1ï¼‰åµŒå¥—æŸ¥è¯¢"></a>ï¼ˆ1ï¼‰åµŒå¥—æŸ¥è¯¢</h4><pre><code class="language-sql"># Write your MySQL query statement below
with base as(
    select *, lead(student, 1)over (order by id) as exchange_nxt, lag(student, 1)over (order by id) as exchange_pre from Seat
)
select id, IFNULL((case when (id % 2) != 0 then exchange_nxt else exchange_pre end), student) as student from base;
</code></pre>
<h4 id="ï¼ˆ2ï¼‰CASE-WHEN"><a href="#ï¼ˆ2ï¼‰CASE-WHEN" class="headerlink" title="ï¼ˆ2ï¼‰CASE WHEN"></a>ï¼ˆ2ï¼‰CASE WHEN</h4><pre><code class="language-sql"># Write your MySQL query statement below
select case 
        when id % 2 = 1 and id &lt; (select max(id) from Seat)
            then id + 1
        when id % 2 = 0 
            then id - 1
        else id
        end as id, student
    from Seat
order by id;
</code></pre>
<p>åœ¨ SQL é‡Œï¼Œ<code>CASE</code> å¯ä»¥å†™ä¸¤ç§å½¢å¼ï¼š</p>
<h5 id="a-ç®€å•-CASE"><a href="#a-ç®€å•-CASE" class="headerlink" title="a. ç®€å• CASE"></a>a. ç®€å• CASE</h5><p>ç›´æ¥å¯¹æŸä¸ªè¡¨è¾¾å¼çš„å€¼åšåŒ¹é…ï¼š</p>
<pre><code class="language-sql">CASE column_name
    WHEN &#39;A&#39; THEN &#39;ç±»å‹1&#39;
    WHEN &#39;B&#39; THEN &#39;ç±»å‹2&#39;
    ELSE &#39;å…¶ä»–&#39;
END
</code></pre>
<h5 id="b-æœç´¢-CASE-ï¼ˆæœ€å¸¸ç”¨ï¼‰"><a href="#b-æœç´¢-CASE-ï¼ˆæœ€å¸¸ç”¨ï¼‰" class="headerlink" title="b. æœç´¢ CASE ï¼ˆæœ€å¸¸ç”¨ï¼‰"></a>b. æœç´¢ CASE ï¼ˆæœ€å¸¸ç”¨ï¼‰</h5><p>æ¡ä»¶åˆ¤æ–­çµæ´»ï¼Œå¯ä»¥å†™æ¯”è¾ƒã€èŒƒå›´ç­‰ï¼š</p>
<pre><code class="language-sql">CASE
    WHEN score &gt;= 90 THEN &#39;ä¼˜ç§€&#39;
    WHEN score &gt;= 60 THEN &#39;åŠæ ¼&#39;
    ELSE &#39;ä¸åŠæ ¼&#39;
END
</code></pre>
<h5 id="c-ä½œä¸ºä¸€ä¸ªå­—æ®µè¾“å‡º"><a href="#c-ä½œä¸ºä¸€ä¸ªå­—æ®µè¾“å‡º" class="headerlink" title="c. ä½œä¸ºä¸€ä¸ªå­—æ®µè¾“å‡º"></a>c. ä½œä¸ºä¸€ä¸ªå­—æ®µè¾“å‡º</h5><pre><code class="language-sql">SELECT name,
       CASE WHEN age &lt; 18 THEN &#39;æœªæˆå¹´&#39;
            WHEN age &lt; 60 THEN &#39;æˆå¹´äºº&#39;
            ELSE &#39;è€å¹´äºº&#39;
       END AS age_group
FROM users;
</code></pre>
<h5 id="d-åœ¨èšåˆå‡½æ•°é‡Œåšæ¡ä»¶ç»Ÿè®¡"><a href="#d-åœ¨èšåˆå‡½æ•°é‡Œåšæ¡ä»¶ç»Ÿè®¡" class="headerlink" title="d. åœ¨èšåˆå‡½æ•°é‡Œåšæ¡ä»¶ç»Ÿè®¡"></a>d. åœ¨èšåˆå‡½æ•°é‡Œåšæ¡ä»¶ç»Ÿè®¡</h5><pre><code class="language-sql">SELECT
    SUM(CASE WHEN status = &#39;success&#39; THEN 1 ELSE 0 END) AS success_count,
    SUM(CASE WHEN status = &#39;fail&#39; THEN 1 ELSE 0 END)    AS fail_count
FROM logs;
</code></pre>
<p>å¸¸ç”¨äº <strong>æ¡ä»¶è®¡æ•°</strong>ã€‚</p>
<h5 id="e-æ’åºï¼ˆORDER-BYï¼‰"><a href="#e-æ’åºï¼ˆORDER-BYï¼‰" class="headerlink" title="e. æ’åºï¼ˆORDER BYï¼‰"></a>e. æ’åºï¼ˆORDER BYï¼‰</h5><pre><code class="language-sql">SELECT *
FROM orders
ORDER BY
  CASE 
    WHEN status = &#39;vip&#39; THEN 1
    WHEN status = &#39;normal&#39; THEN 2
    ELSE 3
  END;
</code></pre>
<hr>
<h3 id="1341-ç”µå½±è¯„åˆ†"><a href="#1341-ç”µå½±è¯„åˆ†" class="headerlink" title="1341. ç”µå½±è¯„åˆ†"></a>1341. ç”µå½±è¯„åˆ†</h3><p>è¡¨ï¼š<code>Movies</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| movie_id      | int     |
| title         | varchar |
+---------------+---------+
movie_id æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
title æ˜¯ç”µå½±çš„åå­—ã€‚
</code></pre>
<p>è¡¨ï¼š<code>Users</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| user_id       | int     |
| name          | varchar |
+---------------+---------+
user_id æ˜¯è¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
&#39;name&#39; åˆ—å…·æœ‰å”¯ä¸€å€¼ã€‚
</code></pre>
<p>è¡¨ï¼š<code>MovieRating</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| movie_id      | int     |
| user_id       | int     |
| rating        | int     |
| created_at    | date    |
+---------------+---------+
(movie_id, user_id) æ˜¯è¿™ä¸ªè¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆ)ã€‚
è¿™ä¸ªè¡¨åŒ…å«ç”¨æˆ·åœ¨å…¶è¯„è®ºä¸­å¯¹ç”µå½±çš„è¯„åˆ† rating ã€‚
created_at æ˜¯ç”¨æˆ·çš„ç‚¹è¯„æ—¥æœŸã€‚ 
</code></pre>
<p>è¯·ä½ ç¼–å†™ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>æŸ¥æ‰¾è¯„è®ºç”µå½±æ•°é‡æœ€å¤šçš„ç”¨æˆ·åã€‚å¦‚æœå‡ºç°å¹³å±€ï¼Œè¿”å›å­—å…¸åºè¾ƒå°çš„ç”¨æˆ·åã€‚</li>
<li>æŸ¥æ‰¾åœ¨ <code>February 2020</code> <strong>å¹³å‡è¯„åˆ†æœ€é«˜</strong> çš„ç”µå½±åç§°ã€‚å¦‚æœå‡ºç°å¹³å±€ï¼Œè¿”å›å­—å…¸åºè¾ƒå°çš„ç”µå½±åç§°ã€‚</li>
</ul>
<p><strong>å­—å…¸åº</strong> ï¼Œå³æŒ‰å­—æ¯åœ¨å­—å…¸ä¸­å‡ºç°é¡ºåºå¯¹å­—ç¬¦ä¸²æ’åºï¼Œå­—å…¸åºè¾ƒå°åˆ™æ„å‘³ç€æ’åºé å‰ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Movies è¡¨ï¼š
+-------------+--------------+
| movie_id    |  title       |
+-------------+--------------+
| 1           | Avengers     |
| 2           | Frozen 2     |
| 3           | Joker        |
+-------------+--------------+
Users è¡¨ï¼š
+-------------+--------------+
| user_id     |  name        |
+-------------+--------------+
| 1           | Daniel       |
| 2           | Monica       |
| 3           | Maria        |
| 4           | James        |
+-------------+--------------+
MovieRating è¡¨ï¼š
+-------------+--------------+--------------+-------------+
| movie_id    | user_id      | rating       | created_at  |
+-------------+--------------+--------------+-------------+
| 1           | 1            | 3            | 2020-01-12  |
| 1           | 2            | 4            | 2020-02-11  |
| 1           | 3            | 2            | 2020-02-12  |
| 1           | 4            | 1            | 2020-01-01  |
| 2           | 1            | 5            | 2020-02-17  | 
| 2           | 2            | 2            | 2020-02-01  | 
| 2           | 3            | 2            | 2020-03-01  |
| 3           | 1            | 3            | 2020-02-22  | 
| 3           | 2            | 4            | 2020-02-25  | 
+-------------+--------------+--------------+-------------+
è¾“å‡ºï¼š
Result è¡¨ï¼š
+--------------+
| results      |
+--------------+
| Daniel       |
| Frozen 2     |
+--------------+
è§£é‡Šï¼š
Daniel å’Œ Monica éƒ½ç‚¹è¯„äº† 3 éƒ¨ç”µå½±ï¼ˆ&quot;Avengers&quot;, &quot;Frozen 2&quot; å’Œ &quot;Joker&quot;ï¼‰ ä½†æ˜¯ Daniel å­—å…¸åºæ¯”è¾ƒå°ã€‚
Frozen 2 å’Œ Joker åœ¨ 2 æœˆçš„è¯„åˆ†éƒ½æ˜¯ 3.5ï¼Œä½†æ˜¯ Frozen 2 çš„å­—å…¸åºæ¯”è¾ƒå°ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">with base as(
    select *, avg(rating) as avg_rate from (
        select *, date_format(created_at, &#39;%Y-%m&#39;) as created_month from MovieRating 
        where date_format(created_at, &#39;%Y-%m&#39;) = &#39;2020-02&#39;
    )a group by movie_id
),
seq as (
    select movie_id from base where avg_rate = (
        select max(avg_rate) from base 
    )
),
base2 as(
    select s.user_id from(
        select t.user_id, rank() over(order by ct DESC) as rk from(
            select user_id, count(*) as ct from  MovieRating group by user_id
        )t
    )s where s.rk = 1
)
select min(a.name) as results from Users a join base2 b on a.user_id = b.user_id union all
    select min(a.title) as results from Movies a join seq b on a.movie_id = b.movie_id;
</code></pre>
<p><strong>PS:</strong></p>
<p>ï¼ˆ1ï¼‰å¦‚æœéœ€è¦è·å–æŸä¸€åˆ—ä¸­ä¸åŒå€¼çš„æ€»æ•°ï¼Œeg:idåˆ—1,2,3å‡ºç°çš„æ¬¡æ•°ï¼Œå¯ä»¥</p>
<pre><code class="language-sql">select count(*) from emp group by id
</code></pre>
<p>ï¼ˆ2ï¼‰ç­‰å€¼å­æŸ¥è¯¢åªèƒ½è¿”å›ä¸€ä¸ªç»“æœï¼Œå­æŸ¥è¯¢é‡Œselectçš„æ•°å€¼ä¸èƒ½è¶…è¿‡ä¸€è¡Œ</p>
<hr>
<h3 id="1321-é¤å…è¥ä¸šé¢å˜åŒ–å¢é•¿"><a href="#1321-é¤å…è¥ä¸šé¢å˜åŒ–å¢é•¿" class="headerlink" title="1321. é¤å…è¥ä¸šé¢å˜åŒ–å¢é•¿"></a>1321. é¤å…è¥ä¸šé¢å˜åŒ–å¢é•¿</h3><p>è¡¨: <code>Customer</code></p>
<pre><code>+---------------+---------+
| Column Name   | Type    |
+---------------+---------+
| customer_id   | int     |
| name          | varchar |
| visited_on    | date    |
| amount        | int     |
+---------------+---------+
åœ¨ SQL ä¸­ï¼Œ(customer_id, visited_on) æ˜¯è¯¥è¡¨çš„ä¸»é”®ã€‚
è¯¥è¡¨åŒ…å«ä¸€å®¶é¤é¦†çš„é¡¾å®¢äº¤æ˜“æ•°æ®ã€‚
visited_on è¡¨ç¤º (customer_id) çš„é¡¾å®¢åœ¨ visited_on é‚£å¤©è®¿é—®äº†é¤é¦†ã€‚
amount æ˜¯ä¸€ä¸ªé¡¾å®¢æŸä¸€å¤©çš„æ¶ˆè´¹æ€»é¢ã€‚
</code></pre>
<p>ä½ æ˜¯é¤é¦†çš„è€æ¿ï¼Œç°åœ¨ä½ æƒ³åˆ†æä¸€ä¸‹å¯èƒ½çš„è¥ä¸šé¢å˜åŒ–å¢é•¿ï¼ˆæ¯å¤©è‡³å°‘æœ‰ä¸€ä½é¡¾å®¢ï¼‰ã€‚</p>
<p>è®¡ç®—ä»¥ 7 å¤©ï¼ˆæŸæ—¥æœŸ + è¯¥æ—¥æœŸå‰çš„ 6 å¤©ï¼‰ä¸ºä¸€ä¸ªæ—¶é—´æ®µçš„é¡¾å®¢æ¶ˆè´¹å¹³å‡å€¼ã€‚<code>average_amount</code> è¦ <strong>ä¿ç•™ä¸¤ä½å°æ•°ã€‚</strong></p>
<p>ç»“æœæŒ‰ <code>visited_on</code> <strong>å‡åºæ’åº</strong>ã€‚</p>
<p>è¿”å›ç»“æœæ ¼å¼çš„ä¾‹å­å¦‚ä¸‹ã€‚</p>
<p><strong>ç¤ºä¾‹ 1:</strong></p>
<pre><code>è¾“å…¥ï¼š
Customer è¡¨:
+-------------+--------------+--------------+-------------+
| customer_id | name         | visited_on   | amount      |
+-------------+--------------+--------------+-------------+
| 1           | Jhon         | 2019-01-01   | 100         |
| 2           | Daniel       | 2019-01-02   | 110         |
| 3           | Jade         | 2019-01-03   | 120         |
| 4           | Khaled       | 2019-01-04   | 130         |
| 5           | Winston      | 2019-01-05   | 110         | 
| 6           | Elvis        | 2019-01-06   | 140         | 
| 7           | Anna         | 2019-01-07   | 150         |
| 8           | Maria        | 2019-01-08   | 80          |
| 9           | Jaze         | 2019-01-09   | 110         | 
| 1           | Jhon         | 2019-01-10   | 130         | 
| 3           | Jade         | 2019-01-10   | 150         | 
+-------------+--------------+--------------+-------------+
è¾“å‡ºï¼š
+--------------+--------------+----------------+
| visited_on   | amount       | average_amount |
+--------------+--------------+----------------+
| 2019-01-07   | 860          | 122.86         |
| 2019-01-08   | 840          | 120            |
| 2019-01-09   | 840          | 120            |
| 2019-01-10   | 1000         | 142.86         |
+--------------+--------------+----------------+
è§£é‡Šï¼š
ç¬¬ä¸€ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-01 åˆ° 2019-01-07 æ˜¯restaurant-growth/restaurant-growth/ (100 + 110 + 120 + 130 + 110 + 140 + 150)/7 = 122.86
ç¬¬äºŒä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-02 åˆ° 2019-01-08 æ˜¯ (110 + 120 + 130 + 110 + 140 + 150 + 80)/7 = 120
ç¬¬ä¸‰ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-03 åˆ° 2019-01-09 æ˜¯ (120 + 130 + 110 + 140 + 150 + 80 + 110)/7 = 120
ç¬¬å››ä¸ªä¸ƒå¤©æ¶ˆè´¹å¹³å‡å€¼ä» 2019-01-04 åˆ° 2019-01-10 æ˜¯ (130 + 110 + 140 + 150 + 80 + 110 + 130 + 150)/7 = 142.86
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">select visited_on, total_amount as amount, round(total_amount / 7, 2) as average_amount from( 
    select visited_on, sum(new_amount)over (order by visited_on ROWS 6 PRECEDING) total_amount from (
        select visited_on, sum(amount) new_amount from Customer group by visited_on
    )s
)t where visited_on &gt;= (
    select min(visited_on) + 6 from Customer
);
</code></pre>
<p>çª—å£å‡½æ•°å¯ä»¥é€‰æ‹©æ“ä½œæ•°æ®çš„èŒƒå›´</p>
<p>egï¼š</p>
<pre><code class="language-sql">å–å½“å‰è¡Œå’Œå‰äº”è¡Œï¼šROWS between 5 preceding and current row --å…±6è¡Œ
å–å½“å‰è¡Œå’Œåäº”è¡Œï¼šROWS between current row and 5 following --å…±6è¡Œ
å–å‰äº”è¡Œå’Œåäº”è¡Œï¼šROWS between 5 preceding and 5 folowing --å…±11è¡Œ
</code></pre>
<hr>
<h3 id="602-å¥½å‹ç”³è¯·llï¼šè°æœ‰æœ€å¤šçš„å¥½å‹"><a href="#602-å¥½å‹ç”³è¯·llï¼šè°æœ‰æœ€å¤šçš„å¥½å‹" class="headerlink" title="602.å¥½å‹ç”³è¯·llï¼šè°æœ‰æœ€å¤šçš„å¥½å‹"></a>602.å¥½å‹ç”³è¯·llï¼šè°æœ‰æœ€å¤šçš„å¥½å‹</h3><p><code>RequestAccepted</code> è¡¨ï¼š</p>
<pre><code>+----------------+---------+
| Column Name    | Type    |
+----------------+---------+
| requester_id   | int     |
| accepter_id    | int     |
| accept_date    | date    |
+----------------+---------+
(requester_id, accepter_id) æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—çš„ç»„åˆ)ã€‚
è¿™å¼ è¡¨åŒ…å«å‘é€å¥½å‹è¯·æ±‚çš„äººçš„ ID ï¼Œæ¥æ”¶å¥½å‹è¯·æ±‚çš„äººçš„ ID ï¼Œä»¥åŠå¥½å‹è¯·æ±‚é€šè¿‡çš„æ—¥æœŸã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆï¼Œæ‰¾å‡ºæ‹¥æœ‰æœ€å¤šçš„å¥½å‹çš„äººå’Œä»–æ‹¥æœ‰çš„å¥½å‹æ•°ç›®ã€‚</p>
<p>ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ä¿è¯æ‹¥æœ‰æœ€å¤šå¥½å‹æ•°ç›®çš„åªæœ‰ 1 ä¸ªäººã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
RequestAccepted è¡¨ï¼š
+--------------+-------------+-------------+
| requester_id | accepter_id | accept_date |
+--------------+-------------+-------------+
| 1            | 2           | 2016/06/03  |
| 1            | 3           | 2016/06/08  |
| 2            | 3           | 2016/06/08  |
| 3            | 4           | 2016/06/09  |
+--------------+-------------+-------------+
è¾“å‡ºï¼š
+----+-----+
| id | num |
+----+-----+
| 3  | 3   |
+----+-----+
è§£é‡Šï¼š
ç¼–å·ä¸º 3 çš„äººæ˜¯ç¼–å·ä¸º 1 ï¼Œ2 å’Œ 4 çš„äººçš„å¥½å‹ï¼Œæ‰€ä»¥ä»–æ€»å…±æœ‰ 3 ä¸ªå¥½å‹ï¼Œæ¯”å…¶ä»–äººéƒ½å¤šã€‚
</code></pre>
<p>è§£ç­”ï¼š</p>
<pre><code class="language-sql">with base as (
    select accepter_id, count(*) as accepted_num 
    from RequestAccepted 
    group by accepter_id
),
seq as (
    select requester_id, count(*) as requested_num 
    from RequestAccepted 
    group by requester_id
),
seq1 as (
    -- å·¦è¿æ¥
    select a.accepter_id as id, 
           ifnull(a.accepted_num,0) + ifnull(b.requested_num,0) as num
    from base a 
    left join seq b on a.accepter_id = b.requester_id
    
    union
    
    -- å³è¿æ¥ï¼ˆè¡¥é½å³è¾¹ç‹¬æœ‰çš„è¡Œï¼‰
    select b.requester_id as id, 
           ifnull(a.accepted_num,0) + ifnull(b.requested_num,0) as num
    from base a 
    right join seq b on a.accepter_id = b.requester_id
)
select id, num
from seq1
where num = (select max(num) from seq1);
</code></pre>
<ul>
<li><code>union</code> ä¿è¯æŠŠä¸¤è¾¹ç‹¬æœ‰çš„ id éƒ½ä¿ç•™ä¸‹æ¥ï¼Œç­‰ä»·äº FULL OUTER JOINã€‚</li>
<li><code>ifnull(...,0)</code> æ˜¯é¿å… NULL ç›¸åŠ å¯¼è‡´ç»“æœä¸º NULLã€‚</li>
<li>æœ€åå–æœ€å¤§å€¼å³å¯ã€‚</li>
</ul>
<hr>
<h3 id="585-2016å¹´çš„æŠ•èµ„"><a href="#585-2016å¹´çš„æŠ•èµ„" class="headerlink" title="585.2016å¹´çš„æŠ•èµ„"></a>585.2016å¹´çš„æŠ•èµ„</h3><p><code>Insurance</code> è¡¨ï¼š</p>
<pre><code>+-------------+-------+
| Column Name | Type  |
+-------------+-------+
| pid         | int   |
| tiv_2015    | float |
| tiv_2016    | float |
| lat         | float |
| lon         | float |
+-------------+-------+
pid æ˜¯è¿™å¼ è¡¨çš„ä¸»é”®(å…·æœ‰å”¯ä¸€å€¼çš„åˆ—)ã€‚
è¡¨ä¸­çš„æ¯ä¸€è¡Œéƒ½åŒ…å«ä¸€æ¡ä¿é™©ä¿¡æ¯ï¼Œå…¶ä¸­ï¼š
pid æ˜¯æŠ•ä¿äººçš„æŠ•ä¿ç¼–å·ã€‚
tiv_2015 æ˜¯è¯¥æŠ•ä¿äººåœ¨ 2015 å¹´çš„æ€»æŠ•ä¿é‡‘é¢ï¼Œtiv_2016 æ˜¯è¯¥æŠ•ä¿äººåœ¨ 2016 å¹´çš„æ€»æŠ•ä¿é‡‘é¢ã€‚
lat æ˜¯æŠ•ä¿äººæ‰€åœ¨åŸå¸‚çš„çº¬åº¦ã€‚é¢˜ç›®æ•°æ®ç¡®ä¿ lat ä¸ä¸ºç©ºã€‚
lon æ˜¯æŠ•ä¿äººæ‰€åœ¨åŸå¸‚çš„ç»åº¦ã€‚é¢˜ç›®æ•°æ®ç¡®ä¿ lon ä¸ä¸ºç©ºã€‚
</code></pre>
<p>ç¼–å†™è§£å†³æ–¹æ¡ˆæŠ¥å‘Š 2016 å¹´ (<code>tiv_2016</code>) æ‰€æœ‰æ»¡è¶³ä¸‹è¿°æ¡ä»¶çš„æŠ•ä¿äººçš„æŠ•ä¿é‡‘é¢ä¹‹å’Œï¼š</p>
<ul>
<li>ä»–åœ¨ 2015 å¹´çš„æŠ•ä¿é¢ (<code>tiv_2015</code>) è‡³å°‘è·Ÿä¸€ä¸ªå…¶ä»–æŠ•ä¿äººåœ¨ 2015 å¹´çš„æŠ•ä¿é¢ç›¸åŒã€‚</li>
<li>ä»–æ‰€åœ¨çš„åŸå¸‚å¿…é¡»ä¸å…¶ä»–æŠ•ä¿äººéƒ½ä¸åŒï¼ˆä¹Ÿå°±æ˜¯è¯´ (<code>lat, lon</code>) ä¸èƒ½è·Ÿå…¶ä»–ä»»ä½•ä¸€ä¸ªæŠ•ä¿äººå®Œå…¨ç›¸åŒï¼‰ã€‚</li>
</ul>
<p><code>tiv_2016</code> å››èˆäº”å…¥çš„ <strong>ä¸¤ä½å°æ•°</strong> ã€‚</p>
<p>æŸ¥è¯¢ç»“æœæ ¼å¼å¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚</p>
<p><strong>ç¤ºä¾‹ 1ï¼š</strong></p>
<pre><code>è¾“å…¥ï¼š
Insurance è¡¨ï¼š
+-----+----------+----------+-----+-----+
| pid | tiv_2015 | tiv_2016 | lat | lon |
+-----+----------+----------+-----+-----+
| 1   | 10       | 5        | 10  | 10  |
| 2   | 20       | 20       | 20  | 20  |
| 3   | 10       | 30       | 20  | 20  |
| 4   | 10       | 40       | 40  | 40  |
+-----+----------+----------+-----+-----+
è¾“å‡ºï¼š
+----------+
| tiv_2016 |
+----------+
| 45.00    |
+----------+
è§£é‡Šï¼š
è¡¨ä¸­çš„ç¬¬ä¸€æ¡è®°å½•å’Œæœ€åä¸€æ¡è®°å½•éƒ½æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ã€‚
tiv_2015 å€¼ä¸º 10 ä¸ç¬¬ä¸‰æ¡å’Œç¬¬å››æ¡è®°å½•ç›¸åŒï¼Œä¸”å…¶ä½ç½®æ˜¯å”¯ä¸€çš„ã€‚

ç¬¬äºŒæ¡è®°å½•ä¸ç¬¦åˆä»»ä½•ä¸€ä¸ªæ¡ä»¶ã€‚å…¶ tiv_2015 ä¸å…¶ä»–æŠ•ä¿äººä¸åŒï¼Œå¹¶ä¸”ä½ç½®ä¸ç¬¬ä¸‰æ¡è®°å½•ç›¸åŒï¼Œè¿™ä¹Ÿå¯¼è‡´äº†ç¬¬ä¸‰æ¡è®°å½•ä¸ç¬¦åˆé¢˜ç›®è¦æ±‚ã€‚
å› æ­¤ï¼Œç»“æœæ˜¯ç¬¬ä¸€æ¡è®°å½•å’Œæœ€åä¸€æ¡è®°å½•çš„ tiv_2016 ä¹‹å’Œï¼Œå³ 45 ã€‚
</code></pre>
<p><strong>è§£ç­”ï¼š</strong></p>
<pre><code class="language-sql">select round(sum(tiv_2016), 2) as tiv_2016 from (
    select a.pid, a.tiv_2016 from Insurance a where a.tiv_2015 in (
        select b.tiv_2015 from Insurance b where a.pid &lt;&gt; b.pid
    ) and not exists (
        select 1 
        from Insurance b 
        where a.pid &lt;&gt; b.pid 
        and a.lat = b.lat 
        and a.lon = b.lon
    )
)t;
</code></pre>
<p><strong>ç”¨ <code>in</code> æ›¿ä»£ <code>=</code></strong></p>
<ul>
<li>ä¿è¯å¯ä»¥åŒ¹é…å¤šè¡Œ <code>tiv_2015</code>ï¼Œé¿å…è¯­æ³•é”™è¯¯ã€‚</li>
<li>é€»è¾‘ï¼šåªè¦ <code>a.tiv_2015</code> åœ¨åˆ«çš„è®°å½•ä¸­å‡ºç°è¿‡ï¼Œå°±ç¬¦åˆã€‚</li>
</ul>
<p><strong>ç”¨ <code>not exists</code> æ›¿ä»£ <code>lat != ... or lon != ...</code></strong></p>
<ul>
<li>è‹¥å†™æ³•æ˜¯â€œåªè¦æŸä¸ªçº¬åº¦ä¸åŒå°±é€šè¿‡â€ï¼Œä¼šè¯¯åˆ¤ã€‚</li>
<li><strong><code>not exists</code> çš„é€»è¾‘æ˜¯â€œä¸èƒ½å­˜åœ¨ä¸€æ¡è®°å½•è·Ÿæˆ‘çº¬åº¦å’Œç»åº¦éƒ½ç›¸åŒâ€ã€‚</strong></li>
</ul>
<p><strong>é€»è¾‘æ¸…æ™°ä¸”æ— æ­§ä¹‰</strong></p>
<ul>
<li>ä¿è¯æœ‰ç›¸åŒ <code>tiv_2015</code>ï¼›</li>
<li>ä¿è¯æ²¡æœ‰ç›¸åŒ <code>(lat, lon)</code>ã€‚</li>
</ul>
<hr>
<p>è¡¥å……ï¼š</p>
<p>SQLæ‰§è¡Œé¡ºåºï¼š</p>
<ul>
<li><strong>FROM</strong> Employee</li>
<li><strong>WHERE</strong> salary &gt; 5000 ï¼ˆå…ˆç­›æ‰å·¥èµ„ä¸å¤Ÿçš„è¡Œï¼‰</li>
<li><strong>GROUP BY</strong> dept ï¼ˆæŒ‰éƒ¨é—¨åˆ†ç»„ï¼‰</li>
<li><strong>COUNT(*)</strong> ç»Ÿè®¡æ¯ç»„äººæ•°</li>
<li><strong>HAVING</strong> è¿‡æ»¤å‡ºäººæ•° â‰¥3 çš„éƒ¨é—¨</li>
<li><strong>SELECT</strong> è¾“å‡º dept, cnt</li>
<li><strong>ORDER BY</strong> æŒ‰ cnt é™åº</li>
<li><strong>LIMIT</strong> å–å‰ 5 ä¸ªéƒ¨é—¨</li>
</ul>
<p>char_length(col)è¿”å›è¯¥åˆ—çš„å­—ç¬¦æ•°</p>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2025 - 2025 KING!BOB!
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;KING BOB
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    <canvas
    id="fireworks"
    style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: 32767"
></canvas>
<script src="https://s4.zstatic.net/ajax/libs/animejs/3.2.1/anime.min.js"></script>
<script src="/js/fireworks.min.js"></script>
    <canvas
    id="background"
    style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; pointer-events: none; z-index: -1"
></canvas>
<script src="/js/background.min.js"></script>
    
    
<script
    src="https://giscus.app/client.js"
    data-repo="Jack-Li-Npu/comment"
    data-repo-id="R_kgDOPviQNg"
    data-category="Announcements"
    data-category-id="DIC_kwDOPviQNs4Cva-O"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="preferred_color_scheme"
    data-lang=""
    crossorigin
    async
></script>





    
<!-- hexo injector body_end start --><script data-pjax src="https://unpkg.com/oh-my-live2d"></script><script>const oml2d = OML2D.loadOml2d({dockedPosition:"right",mobileDisplay:true,models:[{"path":"https://unpkg.com/live2d-widget-model-shizuku@1.0.5/assets/shizuku.model.json","mobilePosition":[-10,23],"mobileScale":0.1,"mobileStageStyle":{"width":180,"height":166},"motionPreloadStrategy":"IDLE","position":[-10,35],"scale":0.15,"stageStyle":{"width":250,"height":250}},{"path":"https://unpkg.com/live2d-widget-model-koharu@1.0.5/assets/koharu.model.json","scale":0.12,"position":[0,0],"stageStyle":{"width":250},"mobileScale":0.08,"mobilePosition":[0,0],"mobileStageStyle":{"width":180}},{"path":"https://unpkg.com/live2d-widget-model-haruto@1.0.5/assets/haruto.model.json","scale":0.12,"position":[0,0],"mobileScale":0.08,"mobilePosition":[0,0],"mobileStageStyle":{"width":180},"stageStyle":{"width":250}}],parentElement:document.body,primaryColor:"var(--btn-bg)",sayHello:false,tips:{style: {"width":230,"height":120,"left":"calc(50% - 20px)","top":"-100px"},mobileStyle: {"width":180,"height":80,"left":"calc(50% - 30px)","top":"-100px"},idleTips:{interval:15000,message:function(){
  return axios.get('https://v1.hitokoto.cn?c=i')
    .then(function (response) {
      return response.data.hitokoto ;
    })
    .catch(function (error) {
      console.error(error);
    });
}
}}});</script><!-- hexo injector body_end end --></body>
</html>
